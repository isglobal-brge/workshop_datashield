{
  "hash": "85e7f714d4669920c7f4e80654b17aa8",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"dsOMOP Workshop\"\nformat: \n  html:\n    code-copy: false\nexecute:\n  warning: false\n  message: false\n---\n\n<a href=\"https://github.com/isglobal-brge/workshop_datashield/raw/main/dsomop.R\" class=\"btn btn-primary btn-sm\" download>\n<i class=\"bi bi-download\"></i> Download R Script\n</a>\n\nIn this lesson, we will learn how to:\n\n- Set up the required dependencies and connect to a DataSHIELD server\n- Create an interface object to interact with an OMOP database\n- Explore the available data and identify the concepts of interest\n- Retrieve data from the OMOP database using the interface object\n- Explore the retrieved data and manipulate it using DataSHIELD functions\n- Create cohort definitions using DataSHIELD functions to filter the data\n- Perform a practical example of an analysis integrating the retrieved data into the DataSHIELD workflow\n\n# Recommended background knowledge\n\nBefore using `dsOMOP`, it is recommended to have a basic understanding of:\n\n- The OMOP CDM structure and its standardized clinical data format. You can learn more about OMOP CDM in the [OHDSI Book chapter 'The Common Data Model'](https://ohdsi.github.io/TheBookOfOhdsi/CommonDataModel.html).\n\n- OMOP Vocabularies and how they standardize medical concepts (like diagnoses, medications, procedures) across different coding systems (ICD-9, ICD-10, SNOMED CT, etc.) into a common representation. The [OHDSI Book chapter 'Standardized Vocabularies'](https://ohdsi.github.io/TheBookOfOhdsi/StandardizedVocabularies.html) provides a comprehensive overview of this standardization process.\n\n- Basic DataSHIELD concepts and workflow. The [DataSHIELD Beginner's Tutorial](https://data2knowledge.atlassian.net/wiki/spaces/DSDEV/pages/931069953/Beginners+Tutorial+DataSHIELD+v6.1) is a good starting point.\n\n- For more information about the `dsOMOP` framework, you can visit the [dsOMOP website](https://isglobal-brge.github.io/dsOMOP/).\n\nThis knowledge will help you better understand how to effectively query and work with OMOP CDM data through the DataSHIELD infrastructure.\n\n# Initial setup\n\nFor this exercise, we will use the following libraries:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(DSI)\nlibrary(DSOpal)\nlibrary(dsBaseClient)\nlibrary(dsOMOPClient)\nlibrary(dsOMOPHelper)\nlibrary(dsHelper)\n```\n:::\n\n\nWe will establish a connection to the demo Opal server. In order to use the OMOP packages and have access to the OMOP database resources, we need to specify the `profile = \"omop\"` parameter in the login builder:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbuilder <- newDSLoginBuilder()\nbuilder$append(server=\"opal-demo\",\n              url=\"https://opal-demo.obiba.org/\",\n              user=\"dsuser\",\n              password=\"P@ssw0rd\",\n              driver = \"OpalDriver\",\n              profile = \"omop\")\n\nlogindata <- builder$build()\nconns <- datashield.login(logins=logindata)\n```\n:::\n\n\n# Creating an OMOP database interface object\n\nWe will create an OMOP database interface object using the `ds.omop.helper` function. This interface object provides a set of methods for easily interacting with an OMOP database. \n\nIn our case, we will use the `mimiciv` resource inside the `omop_demo` project, which points to a small sample database formatted in OMOP CDM:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhelper <- ds.omop.helper(\n    connections = conns,\n    resource = \"omop_demo.mimiciv\", \n    symbol = \"mimiciv\"\n)\n```\n:::\n\n\nThis will create both the object `helper` which will assist us in the creation of our desired dataset, and parallely a table in the server side called `mimiciv` (since this is the name we specified in the `symbol` parameter) which will contain the data that we import from the OMOP database.\n\nWe can check the list of objects available in the server side using the `ds.ls` function:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds.ls()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`opal-demo`\n$`opal-demo`$environment.searched\n[1] \"R_GlobalEnv\"\n\n$`opal-demo`$objects.found\n[1] \"mimiciv\"\n```\n\n\n:::\n:::\n\n\nAs we can observe, `mimiciv` has been successfully created in the server side. We can check the current state of the `mimiciv` table in the server side at any time using the `ds.summary` function:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds.summary(\"mimiciv\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`opal-demo`\n$`opal-demo`$class\n[1] \"data.frame\"\n\n$`opal-demo`$`number of rows`\n[1] 100\n\n$`opal-demo`$`number of columns`\n[1] 5\n\n$`opal-demo`$`variables held`\n[1] \"person_id\"            \"gender_concept_id\"    \"year_of_birth\"       \n[4] \"race_concept_id\"      \"ethnicity_concept_id\"\n```\n\n\n:::\n:::\n\n\nThe `mimiciv` table initially contains only the `person` table, as that is the nexus table in the OMOP CDM. This allows us to append data from other tables since all pieces of information are linked to the `person` table, since it is the table that contains the patient identifiers.\n\nNow it is time to retrieve more data and add it to the `mimiciv` object using the `helper` interface object! But first, we need to explore our database to plan the data retrieval.\n\n# Data exploration\n\nThe first step is to identify the data that is available in the OMOP database. We can check the available tables using the `tables` method. The table structure should usually one that matches one version of the OMOP CDM (in our case, the `mimiciv` database is formatted in the [OMOP CDM 5.4](https://ohdsi.github.io/CommonDataModel/cdm54.html). This commonly provides a good starting point to understand the structure of our data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhelper$tables()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`opal-demo`\n [1] \"attribute_definition\" \"care_site\"            \"cdm_source\"          \n [4] \"cohort\"               \"cohort_attribute\"     \"cohort_definition\"   \n [7] \"concept\"              \"concept_relationship\" \"condition_era\"       \n[10] \"condition_occurrence\" \"cost\"                 \"death\"               \n[13] \"device_exposure\"      \"dose_era\"             \"drug_era\"            \n[16] \"drug_exposure\"        \"fact_relationship\"    \"location\"            \n[19] \"measurement\"          \"metadata\"             \"note\"                \n[22] \"note_nlp\"             \"observation\"          \"observation_period\"  \n[25] \"payer_plan_period\"    \"person\"               \"procedure_occurrence\"\n[28] \"provider\"             \"specimen\"             \"visit_detail\"        \n[31] \"visit_occurrence\"     \"vocabulary\"          \n```\n\n\n:::\n:::\n\n\nAs expected, the `mimiciv` database presents the structure of the OMOP CDM 5.4:\n\n![OMOP CDM v5.4 schema](images/cdm54.png)\n\nWe can also check the columns available in each table using the `columns` method. These should match the columns available in the OMOP CDM documentation for the specific version of the CDM that the database is formatted in. This information is also available in the [OMOP CDM documentation](https://ohdsi.github.io/CommonDataModel/cdm54.html), but is a good reminder of the structure of the data. \n\nLet's check the columns available in the `condition_occurrence`, `measurement` and `observation` tables:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhelper$columns(\"condition_occurrence\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`opal-demo`\n$`opal-demo`$condition_occurrence\n [1] \"condition_occurrence_id\"       \"person_id\"                    \n [3] \"condition_concept_id\"          \"condition_start_date\"         \n [5] \"condition_start_datetime\"      \"condition_end_date\"           \n [7] \"condition_end_datetime\"        \"condition_type_concept_id\"    \n [9] \"stop_reason\"                   \"provider_id\"                  \n[11] \"visit_occurrence_id\"           \"visit_detail_id\"              \n[13] \"condition_source_value\"        \"condition_source_concept_id\"  \n[15] \"condition_status_source_value\" \"condition_status_concept_id\"  \n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhelper$columns(\"measurement\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`opal-demo`\n$`opal-demo`$measurement\n [1] \"measurement_id\"                \"person_id\"                    \n [3] \"measurement_concept_id\"        \"measurement_date\"             \n [5] \"measurement_datetime\"          \"measurement_time\"             \n [7] \"measurement_type_concept_id\"   \"operator_concept_id\"          \n [9] \"value_as_number\"               \"value_as_concept_id\"          \n[11] \"unit_concept_id\"               \"range_low\"                    \n[13] \"range_high\"                    \"provider_id\"                  \n[15] \"visit_occurrence_id\"           \"visit_detail_id\"              \n[17] \"measurement_source_value\"      \"measurement_source_concept_id\"\n[19] \"unit_source_value\"             \"value_source_value\"           \n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhelper$columns(\"observation\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`opal-demo`\n$`opal-demo`$observation\n [1] \"observation_id\"                \"person_id\"                    \n [3] \"observation_concept_id\"        \"observation_date\"             \n [5] \"observation_datetime\"          \"observation_type_concept_id\"  \n [7] \"value_as_number\"               \"value_as_string\"              \n [9] \"value_as_concept_id\"           \"qualifier_concept_id\"         \n[11] \"unit_concept_id\"               \"provider_id\"                  \n[13] \"visit_occurrence_id\"           \"visit_detail_id\"              \n[15] \"observation_source_value\"      \"observation_source_concept_id\"\n[17] \"unit_source_value\"             \"qualifier_source_value\"       \n```\n\n\n:::\n:::\n\n\nNow that we have a good understanding of the structure of the data we are working with, we should identify the concepts that we are interested in. Bear in mind that the OMOP CDM is designed to be used in a wide range of contexts, and therefore the concepts that are present in a database will be specific to the context of the database. \n\nConcepts are the building blocks of the OMOP CDM. They are used to represent the entities that are present in the database, and are based on clinical vocabularies. For the sake of standardization, concepts are represented by numerical IDs matched to terms in clinical vocabularies. For example, the concept \"Chronic obstructive lung disease\" is stored as concept ID 255573 in the OMOP CDM, and it is represented by this identifier across the whole database.\n\nWe can explore the concepts available in the OMOP CDM through [Athena](https://athena.ohdsi.org/), the central repository of standardized clinical vocabularies used in the OMOP CDM. Athena provides a web interface to search and browse concepts across different vocabularies and domains.\n\nHowever, we can also use the `concepts` method to retrieve the concepts available in the database. This method will return a list of concept IDs present in a table, linked to the official concept name designed to it. \n\nLet's check the concepts available in the `condition_occurrence`, `measurement` and `observation` tables:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncondition_list <- helper$concepts(\"condition_occurrence\")\ncondition_list\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`opal-demo`\n    concept_id                                                 concept_name\n1        27674                                          Nausea and vomiting\n2        29735                                         Candidiasis of mouth\n3        31317                                                    Dysphagia\n4        73553                                                  Arthropathy\n5        75576                                     Irritable bowel syndrome\n6        75860                                                 Constipation\n7        77670                                                   Chest pain\n8        78232                                          Shoulder joint pain\n9        79864                                           Hematuria syndrome\n10       80180                                               Osteoarthritis\n11       80502                                                 Osteoporosis\n12       80951                               Candidiasis of urogenital site\n13       81611                                Diverticular disease of colon\n14       81902                             Urinary tract infectious disease\n15      132736                                                   Bacteremia\n16      132797                                                       Sepsis\n17      134736                                                     Backache\n18      134765                                                     Cachexia\n19      138384                                      Acquired hypothyroidism\n20      140673                                               Hypothyroidism\n21      192357                                              Paralytic ileus\n22      192450                                           Retention of urine\n23      192671                                  Gastrointestinal hemorrhage\n24      192673                          Vascular insufficiency of intestine\n25      192680                                          Portal hypertension\n26      193688                           Clostridioides difficile infection\n27      193782                                      End-stage renal disease\n28      195306                                             Gastroduodenitis\n29      195562                                                  Hemorrhoids\n30      195581                                          Peritoneal adhesion\n31      196236                                                 Septic shock\n32      196463                                          Alcoholic cirrhosis\n33      196523                                                     Diarrhea\n34      197320                                          Acute kidney injury\n35      197444                        Vascular complication of medical care\n36      197494                                            Viral hepatitis C\n37      197672                                         Urinary incontinence\n38      197925                                Hemorrhage of rectum and anus\n39      197950                              Cellulitis and abscess of trunk\n40      198571                                            Cardiogenic shock\n41      198678                                Intestinal infectious disease\n42      198964                                          Chronic hepatitis C\n43      199074                                           Acute pancreatitis\n44      200219                                               Abdominal pain\n45      200451                          Chronic passive congestion of liver\n46      200528                                                      Ascites\n47      200618                                          Postoperative shock\n48      201061                                         Diaphragmatic hernia\n49      201826                                     Type 2 diabetes mellitus\n50      254061                                             Pleural effusion\n51      255573                             Chronic obstructive lung disease\n52      255848                                                    Pneumonia\n53      259992                              Ventilator associated pneumonia\n54      261600                                        Acute pulmonary edema\n55      261880                                                  Atelectasis\n56      313217                                          Atrial fibrillation\n57      314054                                        Aortic valve disorder\n58      314665                                               Atrial flutter\n59      314666                                    Old myocardial infarction\n60      315078                                                 Palpitations\n61      315286                               Chronic ischemic heart disease\n62      315831                              Chronic pulmonary heart disease\n63      316135                                       Atrioventricular block\n64      316139                                                Heart failure\n65      317002                                           Low blood pressure\n66      317003                                          Compression of vein\n67      317009                                                       Asthma\n68      317576                                    Coronary arteriosclerosis\n69      318736                                                     Migraine\n70      318772                                      Disorder of pericardium\n71      318800                              Gastroesophageal reflux disease\n72      319041                                      Orthostatic hypotension\n73      319049                                    Acute respiratory failure\n74      319835                                     Congestive heart failure\n75      319843                                        Mitral valve disorder\n76      319844                                 Acute ischemic heart disease\n77      320128                                       Essential hypertension\n78      321052                                  Peripheral vascular disease\n79      321462                                         Cardiac complication\n80      321887                                           Disorder of artery\n81      372448                                        Loss of consciousness\n82      372887                                            Disorder of brain\n83      372892                                     Metabolic encephalopathy\n84      373764                                         Toxic encephalopathy\n85      373995                                                     Delirium\n86      375519                                           Alcohol withdrawal\n87      376690                                               Cerebral edema\n88      376713                                          Cerebral hemorrhage\n89      377091                                                      Seizure\n90      378253                                                     Headache\n91      380378                                                     Epilepsy\n92      432545                                 Bacterial infectious disease\n93      432585                                   Blood coagulation disorder\n94      432867                                               Hyperlipidemia\n95      432870                                    Thrombocytopenic disorder\n96      432875                             Anemia due to chronic blood loss\n97      432881                                                 Pancytopenia\n98      433163                                 Deficiency of macronutrients\n99      433736                                                      Obesity\n100     433753                                                Alcohol abuse\n101     433968                                                  Candidiasis\n102     434004                                                 Hypervolemia\n103     434056                      Late effects of cerebrovascular disease\n104     434547                           Complication of surgical procedure\n105     434610                                                 Hyperkalemia\n106     434814        Late effect of medical and surgical care complication\n107     434894                                 Acute posthemorrhagic anemia\n108     435243                                           Alcohol dependence\n109     435515                          Hypo-osmolality and or hyponatremia\n110     435517                                                     Acidosis\n111     435788                            Disorder of phosphorus metabolism\n112     435796                                                  Dehydration\n113     435829                             Rheumatic disease of heart valve\n114     436073                                           Psychotic disorder\n115     436096                                                 Chronic pain\n116     436222                                        Altered mental status\n117     436238 Elevated level of transaminase and lactic acid dehydrogenase\n118     436659                                       Iron deficiency anemia\n119     436676                                Posttraumatic stress disorder\n120     436962                                                     Insomnia\n121     437233                                             Multiple myeloma\n122     437247                                    Anemia of chronic disease\n123     437264                                  Tobacco dependence syndrome\n124     437312                                                     Bleeding\n125     437382                                                Urine finding\n126     437390                                                    Hypoxemia\n127     437474                                      Postoperative infection\n128     437579                           Paroxysmal ventricular tachycardia\n129     437663                                                        Fever\n130     437779                             Streptococcal infectious disease\n131     437827                                    Pure hypercholesterolemia\n132     437833                                                  Hypokalemia\n133     438064                       Bacterial infection due to Pseudomonas\n134     438398                                                 Leukocytosis\n135     438725                             Disorder of magnesium metabolism\n136     438730                                                    Alkalosis\n137     439005                              Chronic alcoholism in remission\n138     439408                                          Graft complications\n139     439696 Hypertensive heart and renal disease with (congestive) he...\n140     439777                                                       Anemia\n141     440320                            Infection due to Escherichia coli\n142     440383                                          Depressive disorder\n143     440424                                                      Aphasia\n144     440530                                      Oropharyngeal dysphagia\n145     440674                                                         Gout\n146     440940        Methicillin resistant Staphylococcus aureus infection\n147     441258                                 Anemia in neoplastic disease\n148     441536                             Mixed acid-base balance disorder\n149     441829                         Hyperosmolality and or hypernatremia\n150     442019                                    Complication of procedure\n151     442077                                             Anxiety disorder\n152     442588                             Obstructive sleep apnea syndrome\n153     443211        Benign prostatic hyperplasia with outflow obstruction\n154     443238                                      Diabetic - poor control\n155     443344                                          Barrett's esophagus\n156     443447                                       Iatrogenic hypotension\n157     443530                                                 Hematochezia\n158     443597                               Chronic kidney disease stage 3\n159     443612                               Chronic kidney disease stage 4\n160     443734                 Ketoacidosis due to type 2 diabetes mellitus\n161     444044                                       Acute tubular necrosis\n162     444070                                                  Tachycardia\n163     444100                                                Mood disorder\n164     444101                                   Hypertensive heart failure\n165     444406                              Acute subendocardial infarction\n166     764123   Atherosclerosis of coronary artery without angina pectoris\n167    4008576                       Diabetes mellitus without complication\n168    4052648                                                   Disability\n169    4064161                                           Cirrhosis of liver\n170    4064452                                     ECG: atrial fibrillation\n171    4065288                                          EKG: atrial flutter\n172    4079687                                         Tumor lysis syndrome\n173    4088998                                 AV sequential pacing pattern\n174    4089488                                        Atrial pacing pattern\n175    4092038                                   Ventricular pacing pattern\n176    4094822                            Foreign body in respiratory tract\n177    4101362                                      Finding of urine output\n178    4126119                                            Toxic nephropathy\n179    4138456                                       ECG: sinus bradycardia\n180    4140598                                       ECG: sinus tachycardia\n181    4141820                                        ECG: sinus arrhythmia\n182    4144111          Gastroesophageal reflux disease without esophagitis\n183    4145510                            EKG: supraventricular tachycardia\n184    4145513                                            ECG: sinus rhythm\n185    4150981                                              Drug resistance\n186    4154290                               Paroxysmal atrial fibrillation\n187    4175154                    Disorder of the peripheral nervous system\n188    4182210                                                     Dementia\n189    4187218                         Pneumonitis due to inhaled substance\n190    4188331                                      Chronic pulmonary edema\n191    4193704                Type 2 diabetes mellitus without complication\n192    4209423                                          Nicotine dependence\n193    4229440                             Chronic congestive heart failure\n194    4232495                                       Primary cardiomyopathy\n195    4233565 Severe protein-calorie malnutrition (Gomez: less than 60 ...\n196    4245975                                              Hepatic failure\n197    4256228                                          Respiratory failure\n198    4268911                                                Disorientated\n199    4270024         Acute non-ST segment elevation myocardial infarction\n200    4282096                             Major depression, single episode\n201    4286201                                     Schizoaffective disorder\n202    4295261                                         Postmenopausal state\n203    4311499              Primary malignant neoplasm of respiratory tract\n204    4322175                    Late effect of complications of procedure\n205    4332246                                                     Aneurysm\n206    4339214                             Secondary pulmonary hypertension\n207    4353709                               Intracerebral vascular finding\n208   36712779                   Chronic total occlusion of coronary artery\n209   36712821                                     Postprocedural infection\n210   36712982 Unstable angina co-occurrent and due to coronary arterios...\n211   37016114               Acute on chronic hypoxemic respiratory failure\n212   37016349                Hyperglycemia due to type 2 diabetes mellitus\n213   37017432               Polyneuropathy due to type 2 diabetes mellitus\n214   37116361                            Accidental wound during procedure\n215   37311319                                                  Hypovolemia\n216   37394658                                                Severe sepsis\n217   37395564                                Hypoxemic respiratory failure\n218   40321716                                   Secondary thrombocytopenia\n219   40479192                               Chronic systolic heart failure\n220   40479576                              Chronic diastolic heart failure\n221   40480602                      Acute on chronic systolic heart failure\n222   40481043                     Acute on chronic diastolic heart failure\n223   40481762         Hemiplegia as late effect of cerebrovascular disease\n224   40481919                                     Coronary atherosclerosis\n225   40482801                       Type II diabetes mellitus uncontrolled\n226   40487064                               Sepsis due to Escherichia coli\n227   42537730                                Coronary artery graft present\n228   42537748                                    Acquired absence of organ\n229   42873170                            Dependence on supplemental oxygen\n230   43022062              Cardiovascular system complication of procedure\n231   43530681                                      Drug abuse in remission\n232   43530690                   Foot ulcer due to type 2 diabetes mellitus\n233   43530742 Paralytic syndrome on one side of the body as late effect...\n234   43531578       Chronic kidney disease due to type 2 diabetes mellitus\n235   44782421              Acute deep venous thrombosis of upper extremity\n236   44782429                   Chronic kidney disease due to hypertension\n237   44784217                                           Cardiac arrhythmia\n238   44784439         Benign hypertensive renal disease with renal failure\n239   44784631                               Pain due to neoplastic disease\n240   45757363                 Hypoglycemia due to type 2 diabetes mellitus\n241   45766207       Non-rheumatic mitral valve stenosis with regurgitation\n242   45768812                             Anemia in chronic kidney disease\n243   45768910                                         Uncomplicated asthma\n244   46271022                                       Chronic kidney disease\n245   46271075                          Acute hypoxemic respiratory failure\n246   46273390                                     Dependence on respirator\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmeasurement_list <- helper$concepts(\"measurement\")\nmeasurement_list\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`opal-demo`\n    concept_id                                                 concept_name\n1            0                                          No matching concept\n2      1175625                                      Breath rate spontaneous\n3      3000067           Parathyrin.intact [Mass/volume] in Serum or Plasma\n4      3000068                                oxyCODONE [Presence] in Urine\n5      3000099            Nuclear Ab [Units/volume] in Serum by Immunoassay\n6      3000285                               Sodium [Moles/volume] in Blood\n7      3000330                      Specific gravity of Urine by Test strip\n8      3000348         Leukocyte esterase [Presence] in Urine by Test strip\n9      3000456           Dacrocytes [Presence] in Blood by Light microscopy\n10     3000461                          Pressure support setting Ventilator\n11     3000483                               Glucose [Mass/volume] in Blood\n12     3000593     Cobalamin (Vitamin B12) [Mass/volume] in Serum or Plasma\n13     3000764                          Benzodiazepines [Presence] in Urine\n14     3000941            Linezolid [Susceptibility] by Disk diffusion (KB)\n15     3000963                            Hemoglobin [Mass/volume] in Blood\n16     3001122                    Ferritin [Mass/volume] in Serum or Plasma\n17     3001308         Cholesterol in LDL [Moles/volume] in Serum or Plasma\n18     3001318            Cholesterol.total/Cholesterol in HDL [Percentile]\n19     3001494 Erythrocytes [#/volume] in Urine sediment by Microscopy h...\n20     3001582                     Protein/Creatinine [Mass Ratio] in Urine\n21     3001893                  Eosinophils/100 leukocytes in Pleural fluid\n22     3001950             Amikacin [Susceptibility] by Disk diffusion (KB)\n23     3002020                             Barbiturates [Presence] in Urine\n24     3002091         Choriogonadotropin [Moles/volume] in Serum or Plasma\n25     3002113  Variant lymphocytes [Presence] in Blood by Light microscopy\n26     3002179                       Metamyelocytes/100 leukocytes in Blood\n27     3002331                    Protein [Mass/volume] in Peritoneal fluid\n28     3002400                        Iron [Mass/volume] in Serum or Plasma\n29     3002827        Microalbumin/Creatinine [Mass Ratio] in 24 hour Urine\n30     3002850         Tetracycline [Susceptibility] by Disk diffusion (KB)\n31     3002888              Erythrocyte distribution width [Entitic volume]\n32     3003105           Gentamicin [Susceptibility] by Disk diffusion (KB)\n33     3003132            Barbiturates [Presence] in Serum, Plasma or Blood\n34     3003181                               Sodium [Moles/volume] in Urine\n35     3003282               Leukocytes [#/volume] in Blood by Manual count\n36     3003396                 Base excess in Arterial blood by calculation\n37     3003403                       Glucose [Mass/volume] in Pleural fluid\n38     3003434                       Protein [Mass/volume] in Pleural fluid\n39     3003709                  Acetaminophen [Presence] in Serum or Plasma\n40     3003785         Carcinoembryonic Ag [Mass/volume] in Serum or Plasma\n41     3003906            Oxacillin [Susceptibility] by Disk diffusion (KB)\n42     3004249                                      Systolic blood pressure\n43     3004295                         Urea nitrogen [Mass/volume] in Blood\n44     3004297                                      Temperature Inhaled gas\n45     3004327           Lymphocytes [#/volume] in Blood by Automated count\n46     3004354            ceFAZolin [Susceptibility] by Disk diffusion (KB)\n47     3004410                     Hemoglobin A1c/Hemoglobin.total in Blood\n48     3004501                     Glucose [Mass/volume] in Serum or Plasma\n49     3004588              Protein electrophoresis panel - Serum or Plasma\n50     3004698                                     QRS duration in lead III\n51     3004905        Lipase [Enzymatic activity/volume] in Serum or Plasma\n52     3004921                                  Ventilation mode Ventilator\n53     3005087     Macrophages/100 leukocytes in Body fluid by Manual count\n54     3005131 Glucose mean value [Mass/volume] in Blood Estimated from ...\n55     3005158          Clindamycin [Susceptibility] by Disk diffusion (KB)\n56     3005309                    Salicylates [Presence] in Serum or Plasma\n57     3005456                            Potassium [Moles/volume] in Blood\n58     3005481          Spherocytes [Presence] in Blood by Light microscopy\n59     3005555                              Left ventricular Cardiac output\n60     3005606                     Pulmonary artery Systolic blood pressure\n61     3005629                                     Inhaled oxygen flow rate\n62     3005686           Bite cells [Presence] in Blood by Light microscopy\n63     3005715                  Vancomycin [Mass/volume] in Serum or Plasma\n64     3005719                         IgG [Mass/volume] in Serum or Plasma\n65     3005854           Burr cells [Presence] in Blood by Light microscopy\n66     3005897                 Protein [Mass/volume] in Urine by Test strip\n67     3006122            Meropenem [Susceptibility] by Disk diffusion (KB)\n68     3006135   Nucleated erythrocytes [#/volume] in Blood by Manual count\n69     3006175       Mucus [Presence] in Urine sediment by Light microscopy\n70     3006490 Calcium oxalate crystals [Presence] in Urine sediment by ...\n71     3006923 Alanine aminotransferase [Enzymatic activity/volume] in S...\n72     3007070          Cholesterol in HDL [Mass/volume] in Serum or Plasma\n73     3007124   Reticulocytes/100 erythrocytes in Blood by Automated count\n74     3007164                         IgA [Mass/volume] in Serum or Plasma\n75     3007220 Creatine kinase [Enzymatic activity/volume] in Serum or P...\n76     3007350 Amorphous sediment [Presence] in Urine sediment by Light ...\n77     3007359          Bilirubin.indirect [Mass/volume] in Serum or Plasma\n78     3007469                               Breath rate setting Ventilator\n79     3007733                             Chloride [Moles/volume] in Urine\n80     3007794                                                 P-R Interval\n81     3007876                                          Appearance of Urine\n82     3007913         Alveolar-arterial oxygen Partial pressure difference\n83     3008223                                     Glasgow coma score motor\n84     3008251                          Bicarbonate [Moles/volume] in Urine\n85     3008295                                Osmolality of Serum or Plasma\n86     3008308         Erythromycin [Susceptibility] by Disk diffusion (KB)\n87     3008449                                 S wave amplitude in lead III\n88     3008504           Vancomycin [Susceptibility] by Disk diffusion (KB)\n89     3008598         Thyroxine (T4) free [Mass/volume] in Serum or Plasma\n90     3008691      Amylase [Enzymatic activity/volume] in Peritoneal fluid\n91     3008855          Leukocytes other/100 leukocytes in Peritoneal fluid\n92     3008939    Band form neutrophils [#/volume] in Blood by Manual count\n93     3009094                                    Glasgow coma score verbal\n94     3009201                Thyrotropin [Units/volume] in Serum or Plasma\n95     3009306         Alpha-1-Fetoprotein [Mass/volume] in Serum or Plasma\n96     3009314             Cefepime [Susceptibility] by Disk diffusion (KB)\n97     3009497                                              Type of GI tube\n98     3009542                        Hematocrit [Volume Fraction] of Blood\n99     3009613                  Erythrocytes [#/volume] in Peritoneal fluid\n100    3009682                    Cortisol [Mass/volume] in Serum or Plasma\n101    3009744                        MCHC [Mass/volume] by Automated count\n102    3010189 Epithelial cells [#/area] in Urine sediment by Microscopy...\n103    3010321                              Right eye Pupil diameter Manual\n104    3010340       Triiodothyronine (T3) [Mass/volume] in Serum or Plasma\n105    3010421                                                  pH of Blood\n106    3010834                Platelets [#/volume] in Blood by Manual count\n107    3011335                     Digoxin [Mass/volume] in Serum or Plasma\n108    3011368       Poikilocytosis [Presence] in Blood by Light microscopy\n109    3011397                 Hemoglobin [Presence] in Urine by Test strip\n110    3011483 Granular casts [#/area] in Urine sediment by Microscopy l...\n111    3011544                       Albumin [Mass/volume] in Pleural fluid\n112    3011589                                 T wave amplitude in lead III\n113    3011904                   Phosphate [Mass/volume] in Serum or Plasma\n114    3011965                         Urea nitrogen [Mass/volume] in Urine\n115    3011987        Polychromasia [Presence] in Blood by Light microscopy\n116    3012030                        MCH [Entitic mass] by Automated count\n117    3012095                  Magnesium [Moles/volume] in Serum or Plasma\n118    3012222 Trimethoprim+Sulfamethoxazole [Susceptibility] by Disk di...\n119    3012336                 Haptoglobin [Mass/volume] in Serum or Plasma\n120    3012410                              Tidal volume setting Ventilator\n121    3012501                          Base excess in Blood by calculation\n122    3012516                               Albumin [Mass/volume] in Urine\n123    3012888                                     Diastolic blood pressure\n124    3012986 Erythrocytes [#/volume] in Cerebral spinal fluid by Autom...\n125    3013290                   Carbon dioxide [Partial pressure] in Blood\n126    3013429             Basophils [#/volume] in Blood by Automated count\n127    3013466                           aPTT in Blood by Coagulation assay\n128    3013502                                   Oxygen saturation in Blood\n129    3013603        Prostate specific Ag [Mass/volume] in Serum or Plasma\n130    3013650           Neutrophils [#/volume] in Blood by Automated count\n131    3013678 Triglyceride [Mass/volume] in Serum or Plasma --12 hours ...\n132    3013682               Urea nitrogen [Mass/volume] in Serum or Plasma\n133    3013707          Erythrocyte sedimentation rate by Westergren method\n134    3013721 Aspartate aminotransferase [Enzymatic activity/volume] in...\n135    3013731 Hepatitis B virus surface Ab [Units/volume] in Serum or P...\n136    3014080                       Oxygen gas flow Oxygen delivery system\n137    3014576                   Chloride [Moles/volume] in Serum or Plasma\n138    3014886           Neutrophils [#/volume] in Urine by Automated count\n139    3015273                                         Consistency of Stool\n140    3015280                   Blasts [#/volume] in Blood by Manual count\n141    3015377                    Calcium [Moles/volume] in Serum or Plasma\n142    3015536                          ST amplitude.J point+80 ms Lead III\n143    3015862         levoFLOXacin [Susceptibility] by Disk diffusion (KB)\n144    3016038                            Potassium [Moles/volume] in Urine\n145    3016242 Piperacillin+Tazobactam [Susceptibility] by Disk diffusio...\n146    3016251              Hemoglobin.gastrointestinal [Presence] in Stool\n147    3016293                Bicarbonate [Moles/volume] in Serum or Plasma\n148    3016311  Creatine kinase.MB/Creatine kinase.total in Serum or Plasma\n149    3016335                               Glasgow coma score eye opening\n150    3016407 Fibrinogen [Mass/volume] in Platelet poor plasma by Coagu...\n151    3016502                          Oxygen saturation in Arterial blood\n152    3016557 Hepatitis B virus core Ab [Units/volume] in Serum by Immu...\n153    3016573 Ampicillin+Sulbactam [Susceptibility] by Disk diffusion (KB)\n154    3016723                  Creatinine [Mass/volume] in Serum or Plasma\n155    3016750                                 Collection duration of Urine\n156    3016771       Amylase [Enzymatic activity/volume] in Serum or Plasma\n157    3016879                                  Cocaine [Presence] in Urine\n158    3016991              Thyroxine (T4) [Mass/volume] in Serum or Plasma\n159    3017143                     Hepatitis C virus Ab [Presence] in Serum\n160    3017181                           Myelocytes/100 leukocytes in Blood\n161    3017188                    Pulmonary artery Diastolic blood pressure\n162    3017250                            Creatinine [Mass/volume] in Urine\n163    3017400                            Magnesium [Moles/volume] in Urine\n164    3017594                     Tidal volume.spontaneous --on ventilator\n165    3017595           Ampicillin [Susceptibility] by Disk diffusion (KB)\n166    3018053                                  S wave duration in lead III\n167    3018405                     Lactate [Moles/volume] in Arterial blood\n168    3018465                      Oxygen saturation in Mixed venous blood\n169    3018572                             Chloride [Moles/volume] in Blood\n170    3018672                                             pH of Body fluid\n171    3018760 Blood smear finding [Identifier] in Blood by Light micros...\n172    3018834            Bilirubin.total [Presence] in Urine by Test strip\n173    3018954      Choriogonadotropin (pregnancy test) [Presence] in Urine\n174    3019298               Eosinophils/100 leukocytes in Peritoneal fluid\n175    3019351                           QRS terminal amplitude in lead III\n176    3019416         Acanthocytes [Presence] in Blood by Light microscopy\n177    3019473               Protein [Mass/volume] in Cerebral spinal fluid\n178    3019510 Hepatitis B virus surface Ag [Presence] in Serum or Plasm...\n179    3019550                     Sodium [Moles/volume] in Serum or Plasma\n180    3019634 Microscopic observation [Identifier] in Tissue by Wright ...\n181    3019761  Pappenheimer bodies [Presence] in Blood by Light microscopy\n182    3019800          Troponin T.cardiac [Mass/volume] in Serum or Plasma\n183    3019880         Schistocytes [Presence] in Blood by Light microscopy\n184    3019897    Erythrocyte distribution width [Ratio] by Automated count\n185    3019977                                         pH of Arterial blood\n186    3020149        25-hydroxyvitamin D3 [Mass/volume] in Serum or Plasma\n187    3020153        Ciprofloxacin [Susceptibility] by Disk diffusion (KB)\n188    3020416          Erythrocytes [#/volume] in Blood by Automated count\n189    3020460          C reactive protein [Mass/volume] in Serum or Plasma\n190    3020481                                           Respiration rhythm\n191    3020630                     Protein [Mass/volume] in Serum or Plasma\n192    3020716                                 Inhaled oxygen concentration\n193    3020891                                             Body temperature\n194    3021044       Iron binding capacity [Mass/volume] in Serum or Plasma\n195    3021119                      Calcium.ionized [Moles/volume] in Blood\n196    3021200 Thyroglobulin Ab [Units/volume] in Serum by Radioimmunoas...\n197    3021303          Hypochromia [Presence] in Blood by Light microscopy\n198    3021453                     Eosinophils/100 leukocytes in Body fluid\n199    3021502           Macrocytes [Presence] in Blood by Light microscopy\n200    3021595                      Phenytoin [Presence] in Serum or Plasma\n201    3021601                    Nitrite [Presence] in Urine by Test strip\n202    3021886                              Globulin [Mass/volume] in Serum\n203    3022022                                                 QRS duration\n204    3022094           Tobramycin [Susceptibility] by Disk diffusion (KB)\n205    3022217             INR in Platelet poor plasma by Coagulation assay\n206    3022318                                            Heart rate rhythm\n207    3022509 Hyaline casts [#/area] in Urine sediment by Microscopy lo...\n208    3022548               Glucose [Mass/volume] in Cerebral spinal fluid\n209    3022621                                    pH of Urine by Test strip\n210    3022747          cefTRIAXone [Susceptibility] by Disk diffusion (KB)\n211    3022797                                 R wave amplitude in lead III\n212    3022875          Positive end expiratory pressure setting Ventilator\n213    3023103                  Potassium [Moles/volume] in Serum or Plasma\n214    3023307         Penicillin G [Susceptibility] by Disk diffusion (KB)\n215    3023314     Hematocrit [Volume Fraction] of Blood by Automated count\n216    3023520                            Reticulocytes [#/volume] in Blood\n217    3023539                 Ketones [Mass/volume] in Urine by Test strip\n218    3023547                Leukocytes other/100 leukocytes in Body fluid\n219    3023599                      MCV [Entitic volume] by Automated count\n220    3024128             Bilirubin.total [Mass/volume] in Serum or Plasma\n221    3024153            Promyelocytes [#/volume] in Blood by Manual count\n222    3024171                                             Respiratory rate\n223    3024561                     Albumin [Mass/volume] in Serum or Plasma\n224    3024629                 Glucose [Mass/volume] in Urine by Test strip\n225    3024882        Oxygen/Total gas setting [Volume Fraction] Ventilator\n226    3024929             Platelets [#/volume] in Blood by Automated count\n227    3025019                           Gas flow Respiratory system airway\n228    3025255 Bacteria [#/area] in Urine sediment by Microscopy high po...\n229    3025315                                                  Body weight\n230    3025439 Airway pressure Ventilator --at peak inspiratory flow max...\n231    3025478      Tricyclic antidepressants [Presence] in Serum or Plasma\n232    3025616         Target cells [Presence] in Blood by Light microscopy\n233    3025809                                                 Q-T interval\n234    3026256                            QRS initial amplitude in lead III\n235    3026258                                       Q-T interval corrected\n236    3026314         Anisocytosis [Presence] in Blood by Light microscopy\n237    3026400                        Ethanol [Presence] in Serum or Plasma\n238    3026611                               Left eye Pupil diameter Manual\n239    3026692                    Albumin [Mass/volume] in Peritoneal fluid\n240    3026729                             Phosphate [Mass/volume] in Urine\n241    3026782                                          Osmolality of Urine\n242    3026904 Basophilic stippling [Presence] in Blood by Light microscopy\n243    3026910 Gamma glutamyl transferase [Enzymatic activity/volume] in...\n244    3027008                                  Opiates [Presence] in Urine\n245    3027018                                                   Heart rate\n246    3027114                 Cholesterol [Mass/volume] in Serum or Plasma\n247    3027162                                               Color of Urine\n248    3027315                           Oxygen [Partial pressure] in Blood\n249    3027597            Bilirubin.direct [Mass/volume] in Serum or Plasma\n250    3027598                                          Mean blood pressure\n251    3027801                  Oxygen [Partial pressure] in Arterial blood\n252    3027920           Ovalocytes [Presence] in Blood by Light microscopy\n253    3027944                             Amphetamines [Presence] in Urine\n254    3027946          Carbon dioxide [Partial pressure] in Arterial blood\n255    3028026                         IgM [Mass/volume] in Serum or Plasma\n256    3028074                         Pulmonary artery Mean blood pressure\n257    3028308                     Erythrocytes [#/volume] in Pleural fluid\n258    3028437          Cholesterol in LDL [Mass/volume] in Serum or Plasma\n259    3028468            Fragments [Presence] in Blood by Light microscopy\n260    3028561                                  R wave duration in lead III\n261    3028615           Eosinophils [#/volume] in Blood by Automated count\n262    3028662 Hepatitis A virus Ab [Units/volume] in Serum or Plasma by...\n263    3029187 Natriuretic peptide.B prohormone N-Terminal [Mass/volume]...\n264    3031147 Carbon dioxide, total [Moles/volume] in Blood by calculation\n265    3031951                          Benzodiazepines [Presence] in Blood\n266    3033364                   Cholesterol [Mass/volume] in Pleural fluid\n267    3033483                 Monocytes/100 leukocytes in Peritoneal fluid\n268    3033575             Monocytes [#/volume] in Blood by Automated count\n269    3034426                                        Prothrombin time (PT)\n270    3035206                               Physical mobility Braden scale\n271    3035359                          ST amplitude.J point+60 ms Lead III\n272    3035583 Leukocytes [#/area] in Urine sediment by Microscopy high ...\n273    3035816                        Nutrition intake pattern Braden scale\n274    3035851 Transitional cells [#/area] in Urine sediment by Microsco...\n275    3035995 Alkaline phosphatase [Enzymatic activity/volume] in Serum...\n276    3036098                              Sensory perception Braden scale\n277    3036180                                Methadone [Presence] in Urine\n278    3036277                                                  Body height\n279    3036354         Leukocytes other [#/volume] in Blood by Manual count\n280    3036518                               Left ventricular Stroke volume\n281    3036987                      Folate [Mass/volume] in Serum or Plasma\n282    3037022                               Moisture exposure Braden scale\n283    3037153             rifAMPin [Susceptibility] by Disk diffusion (KB)\n284    3037185                                  Protein [Presence] in Urine\n285    3037244 Yeast [#/area] in Urine sediment by Microscopy high power...\n286    3037274    HIV 1 Ab [Units/volume] in Serum or Plasma by Immunoassay\n287    3037278                               Anion gap 4 in Serum or Plasma\n288    3037318                               Physical activity Braden scale\n289    3037347                              Friction and shear Braden scale\n290    3037426               Urobilinogen [Presence] in Urine by Test strip\n291    3037490                                               Color of Stool\n292    3037556                       Urate [Mass/volume] in Serum or Plasma\n293    3037577            Monocytes/100 leukocytes in Cerebral spinal fluid\n294    3037663 Carbon dioxide, total [Moles/volume] in Arterial blood by...\n295    3037871 Macrophages/100 leukocytes in Cerebral spinal fluid by Ma...\n296    3037885           Microcytes [Presence] in Blood by Light microscopy\n297    3038047       Nitrofurantoin [Susceptibility] by Disk diffusion (KB)\n298    3038086          cefTAZidime [Susceptibility] by Disk diffusion (KB)\n299    3038104                       Monocytes/100 leukocytes in Body fluid\n300    3038288 Influenza virus B RNA [Presence] in Specimen by NAA with ...\n301    3039000                                           Anion gap in Blood\n302    3040168                    Immature granulocytes [#/volume] in Blood\n303    3041079 Nucleated cells [#/volume] in Pleural fluid by Automated ...\n304    3041372 Nucleated cells [#/volume] in Cerebral spinal fluid by Au...\n305    3041408 Nucleated cells [#/volume] in Peritoneal fluid by Automat...\n306    3041635 Macrophages/100 leukocytes in Peritoneal fluid by Manual ...\n307    3042347                                           Dressing for Wound\n308    3043387                    Monocytes/100 leukocytes in Pleural fluid\n309    3043728   WBC casts [Presence] in Urine sediment by Light microscopy\n310    3043970                                                Color of Skin\n311    3044938 Influenza virus A RNA [Presence] in Specimen by NAA with ...\n312    3046838                                                   Edema site\n313    3047181                              Lactate [Moles/volume] in Blood\n314    3051714     Fibrin D-dimer FEU [Mass/volume] in Platelet poor plasma\n315    4024509                                                Urine culture\n316    4024510                                Microbial culture, body fluid\n317    4035228                                Respiratory microbial culture\n318    4036044                                  Anaerobic microbial culture\n319    4107893                                                Blood culture\n320    4165398                                             Mycology culture\n321    4189544                                            Microbial culture\n322    4247906                                  Clostridium difficile assay\n323    4265595                                  Creatine kinase measurement\n324    4300293                                               Tissue culture\n325   21490516                        Inspiration [Time] Respiratory system\n326   21490580       Carbon dioxide production (VCO2) in Respiratory system\n327   21490650  Pressure max Respiratory system airway --during inspiration\n328   21490675                                Central venous pressure (CVP)\n329   21490712                               Left ventricular Cardiac index\n330   21490753                 Volume expired per minute Respiratory system\n331   21490854                      Tidal volume Ventilator --on ventilator\n332   21490880                         Left ventricular Stroke volume index\n333   21490888                               PCA lockout time Infusion pump\n334   21490963                               Right pupil Pupillary response\n335   21491186                                   Endotracheal tube Diameter\n336   21491763                                Left pupil Pupillary response\n337   21492239                       Systolic blood pressure by Noninvasive\n338   21492240                      Diastolic blood pressure by Noninvasive\n339   21492241                           Mean blood pressure by Noninvasive\n340   21492838                                               Skin integrity\n341   21494965                                               Passing flatus\n342   21494966                    Physical findings of Abdomen by Palpation\n343   36203862                                              Color of Sputum\n344   36303946   Pressure.plateau Respiratory system airway --on ventilator\n345   36684829                            Richmond Agitation-Sedation Scale\n346   40760766       Tidal volume.inspired maximum setting Ventilator alarm\n347   40762499        Oxygen saturation in Arterial blood by Pulse oximetry\n348   40762903                              Apnea interval Ventilator alarm\n349   40763080 Lactate dehydrogenase [Enzymatic activity/volume] in Peri...\n350   42527086                                         Mean airway pressure\n351   42527140                                Total PEEP Respiratory system\n352   43055270                                           Wound closure type\n353   46236952 Glomerular filtration rate/1.73 sq M.predicted [Volume Ra...\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nobservation_list <- helper$concepts(\"observation\")\nobservation_list\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`opal-demo`\n   concept_id                                                 concept_name\n1      432789                            Opioid analgesic adverse reaction\n2      433942                 Accident while engaged in household activity\n3      435928                                         Abnormal weight loss\n4      436583                                                         Fall\n5      438046 Medical accident to patient during surgical and medical care\n6      439996                               Anticoagulant adverse reaction\n7      440279                                                     Accident\n8      440922                                          Diabetic on insulin\n9      440927                             High risk drug monitoring status\n10     441207                                     Adverse reaction to drug\n11     441749                              Fall on or from stairs or steps\n12    2617452                       Hospital observation service, per hour\n13    3001062                                      History of Past illness\n14    3007397                                              Ventilator type\n15    3012697                                       History of Tobacco use\n16    3024265                            Body temperature measurement site\n17    3034263                                     Pain severity - Reported\n18    3039006                                              Oral care given\n19    4005823                                                 Tobacco user\n20    4014023                                              Palliative care\n21    4019967                                 Dependence on renal dialysis\n22    4036936                                              Oxygen delivery\n23    4060705                           Body mass index 25-29 - overweight\n24    4060985                                Body mass index 30+ - obesity\n25    4119499                                        Not for resuscitation\n26    4127294                                         Resuscitation status\n27    4135421                               Body mass index 20-24 - normal\n28    4138763                                 Acceptable pain level status\n29    4139934                                                     Homeless\n30    4140830                                           Fall on same level\n31    4143274                           History of cerebrovascular disease\n32    4148407                                   FH: Cardiovascular disease\n33    4162219       Patient transfer to postoperative anesthesia care unit\n34    4167217                           Family history of clinical finding\n35    4179242                        History of malignant neoplasm of skin\n36    4180749                    History of malignant neoplasm of prostate\n37    4182335                     Family history of ischemic heart disease\n38    4192791                                  Pain management (specialty)\n39    4203722                                  Patient encounter procedure\n40    4214956                       History of clinical finding in subject\n41    4215685                                    Past history of procedure\n42    4233464                           Legal physical restraint performed\n43    4256640                         Body mass index 40+ - severely obese\n44    4265599                      Patient transfer to intensive care unit\n45    4276526                                             Cigarette smoker\n46    4279614                                                 Asphyxiation\n47    4296248                                             Cost containment\n48    4311079       Place of occurrence of accident or poisoning, hospital\n49    4314870                 Place of occurrence of accident or poisoning\n50    4323345                                              History of fall\n51    4324190                      History of malignant neoplasm of breast\n52    4337265                                                 Bowel sounds\n53   21492835                                           Respiratory effort\n54   36717001                             Long-term current use of aspirin\n55   37116693                                      Stroke volume variation\n56   40479553                                    Cardiac pacemaker in situ\n57   40757693                          Indicators of pain or possible pain\n58   40758030                                           Preferred language\n59   40766231                                      Marital status [NHANES]\n60   46235654                                            Primary insurance\n61   46272450                        Long-term current use of drug therapy\n62   46272451                             Long-term current use of insulin\n63   46272666                            Coordination of family conference\n64   46273928                                         Liaising with family\n65   46273937                       Long-term current use of anticoagulant\n66   46274064                       History of antineoplastic chemotherapy\n```\n\n\n:::\n:::\n\n\nThese serve as concept catalogs for each table. We can explore them to identify the concepts that are present in the database.\n\nFor example, as an exercise, let's find the concept IDs for: \n\n- Systolic blood pressure\n- Marital status\n\n**Note:** For convenience, we can save these concept catalogs as files for easy reference, sharing with collaborators, and future consultation. For example, we can save them as CSV files:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a data directory if it doesn't exist\ndir.create(\"data\", showWarnings = FALSE)\n\n# Save the concept catalogs as CSV files\nwrite.csv(condition_list, file = \"data/condition_list.csv\")\nwrite.csv(measurement_list, file = \"data/measurement_list.csv\")\nwrite.csv(observation_list, file = \"data/observation_list.csv\")\n```\n:::\n\n\n**Did you find the concepts that we are looking for?**\n\n::: {.callout-tip collapse=\"true\"}\n## Click to see the solution\n\nLet's search for these concepts in our catalogs:\n\n1. **Systolic blood pressure**: 3004249\n   - Found in Measurement\n   - Concept name: Systolic blood pressure\n\n2. **Marital status**: 40766231\n   - Found in Observation\n   - Concept name: Marital status [NHANES]\n:::\n\n# Data retrieval\n\nWe have identified the concepts that we are interested in. Now it is time to retrieve data from the OMOP database.\n\nBear in mind that we do not usually want to retrieve all the columns related to a concept. You should check the columns of the `condition_occurrence`, `measurement` and `observation` tables to identify the columns that are relevant to our analysis.\n\nFor example, let's say that we want to obtain the numerical value of the systolic blood pressure. We can check again the columns available in the `measurement` table:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhelper$columns(\"measurement\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`opal-demo`\n$`opal-demo`$measurement\n [1] \"measurement_id\"                \"person_id\"                    \n [3] \"measurement_concept_id\"        \"measurement_date\"             \n [5] \"measurement_datetime\"          \"measurement_time\"             \n [7] \"measurement_type_concept_id\"   \"operator_concept_id\"          \n [9] \"value_as_number\"               \"value_as_concept_id\"          \n[11] \"unit_concept_id\"               \"range_low\"                    \n[13] \"range_high\"                    \"provider_id\"                  \n[15] \"visit_occurrence_id\"           \"visit_detail_id\"              \n[17] \"measurement_source_value\"      \"measurement_source_concept_id\"\n[19] \"unit_source_value\"             \"value_source_value\"           \n```\n\n\n:::\n:::\n\n\nWe can see that the `measurement` table contains the `value_as_number` column, which contains the numerical value of the measurement.\n\nThis means that we want to:\n\n- From the `measurement` table,\n- get the systolic blood pressure (whose concept ID is `3004249`),\n- taking only the `value_as_number` column\n\nWe can retrieve this data using the `auto` method of the `helper` interface object. This method automates the process of retrieving the data from the database and storing it in the `mimiciv` table:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhelper$auto(\n    table = \"measurement\",\n    concepts = 3004249,\n    columns = \"value_as_number\"\n)\n```\n:::\n\n\nThe data should have been stored in the `mimiciv` table. `dsOMOP` automatically translantes the concept IDs to their designated textual names for readability. This means that the column name will be the concept name, followed by the column name of the table (`systolic_blood_pressure.value_as_number`). We can check the current state of the `mimiciv` table in the server side at any time using the `ds.summary` function:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds.summary(\"mimiciv\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`opal-demo`\n$`opal-demo`$class\n[1] \"data.frame\"\n\n$`opal-demo`$`number of rows`\n[1] 100\n\n$`opal-demo`$`number of columns`\n[1] 6\n\n$`opal-demo`$`variables held`\n[1] \"person_id\"                              \n[2] \"gender_concept_id\"                      \n[3] \"year_of_birth\"                          \n[4] \"race_concept_id\"                        \n[5] \"ethnicity_concept_id\"                   \n[6] \"systolic_blood_pressure.value_as_number\"\n```\n\n\n:::\n:::\n\n\nAs we can see, the `mimiciv` table now contains the `systolic_blood_pressure.value_as_number` column, which contains the numerical value of the systolic blood pressure. Let's check a summary of this data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds.summary(\"mimiciv$systolic_blood_pressure.value_as_number\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`opal-demo`\n$`opal-demo`$class\n[1] \"numeric\"\n\n$`opal-demo`$length\n[1] 100\n\n$`opal-demo`$`quantiles & mean`\n      5%      10%      25%      50%      75%      90%      95%     Mean \n 76.0000  94.4000 106.2500 116.5000 128.2500 143.9000 146.1500 116.0172 \n```\n\n\n:::\n:::\n\n\nLet's now use the `renameVars` from the `dsHelper` package, which we have seen before, to rename the variable to `sbp` for convenience:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndh.renameVars(\n\tdf = \"mimiciv\", \n  current_names = c(\"systolic_blood_pressure.value_as_number\"),\n  new_names = c(\"sbp\"))\n```\n:::\n\n\nLet's check whether the changes have been applied by listing the columns of the `mimiciv` table:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds.colnames(\"mimiciv\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`opal-demo`\n[1] \"person_id\"            \"gender_concept_id\"    \"year_of_birth\"       \n[4] \"race_concept_id\"      \"ethnicity_concept_id\" \"sbp\"                 \n```\n\n\n:::\n:::\n\n\nFrom this point, the data we have incorporated into the `mimiciv` table is ready to be used in our analysis as any other dataframe in DataSHIELD. To illustrate this, let's perform a `ds.histogram` to visualize the distribution of the systolic blood pressure:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds.histogram(\"mimiciv$sbp\")\n```\n\n::: {.cell-output-display}\n![](dsomop_files/figure-html/histogram_sbp-1.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$breaks\n [1]  68.13968  76.69465  85.24963  93.80460 102.35958 110.91455 119.46952\n [8] 128.02450 136.57947 145.13445 153.68942\n\n$counts\n [1]  4  0  0  5 11 14  7  5  4  6\n\n$density\n [1] 0.008061452 0.000000000 0.000000000 0.010076815 0.022168993 0.028215082\n [7] 0.014107541 0.010076815 0.008061452 0.012092178\n\n$mids\n [1]  72.41716  80.97214  89.52711  98.08209 106.63706 115.19204 123.74701\n [8] 132.30199 140.85696 149.41194\n\n$xname\n[1] \"xvect\"\n\n$equidist\n[1] TRUE\n\nattr(,\"class\")\n[1] \"histogram\"\n```\n\n\n:::\n:::\n\n\nLet's now retrieve the data for the concept `Marital status [NHANES]`. Let's start by checking the columns available in the `observation` table:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhelper$columns(\"observation\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`opal-demo`\n$`opal-demo`$observation\n [1] \"observation_id\"                \"person_id\"                    \n [3] \"observation_concept_id\"        \"observation_date\"             \n [5] \"observation_datetime\"          \"observation_type_concept_id\"  \n [7] \"value_as_number\"               \"value_as_string\"              \n [9] \"value_as_concept_id\"           \"qualifier_concept_id\"         \n[11] \"unit_concept_id\"               \"provider_id\"                  \n[13] \"visit_occurrence_id\"           \"visit_detail_id\"              \n[15] \"observation_source_value\"      \"observation_source_concept_id\"\n[17] \"unit_source_value\"             \"qualifier_source_value\"       \n```\n\n\n:::\n:::\n\n\nIn this case, the `observation` table contains the `value_as_concept_id` column, which contains the concept ID of the observation value (which will be translated to the textual concept name by `dsOMOP`).\n\nLet's use the `auto` method to retrieve it:\n\n- From the `observation` table,\n- get the marital status (whose concept ID is `40766231`),\n- taking only the `value_as_concept_id` column\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhelper$auto(\n    table = \"observation\",\n    concepts = 40766231,\n    columns = \"value_as_concept_id\"\n)\n```\n:::\n\n\nWe should now have the `marital_status_nhanes.value_as_concept_id` column in the `mimiciv` table. Let's check the current state of the `mimiciv` table in the server side at any time using the `ds.summary` function:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds.summary(\"mimiciv\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`opal-demo`\n$`opal-demo`$class\n[1] \"data.frame\"\n\n$`opal-demo`$`number of rows`\n[1] 100\n\n$`opal-demo`$`number of columns`\n[1] 7\n\n$`opal-demo`$`variables held`\n[1] \"person_id\"                                \n[2] \"gender_concept_id\"                        \n[3] \"year_of_birth\"                            \n[4] \"race_concept_id\"                          \n[5] \"ethnicity_concept_id\"                     \n[6] \"sbp\"                                      \n[7] \"marital_status_nhanes.value_as_concept_id\"\n```\n\n\n:::\n:::\n\n\nThe `mimiciv` table now contains the `marital_status_nhanes.value_as_concept_id` column. Let's see a summary of this data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds.summary(\"mimiciv$marital_status_nhanes.value_as_concept_id\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`opal-demo`\n$`opal-demo`$class\n[1] \"factor\"\n\n$`opal-demo`$length\n[1] 100\n\n$`opal-demo`$categories\n[1] \"divorced\"      \"married\"       \"never_married\" \"widowed\"      \n\n$`opal-demo`$`count of 'divorced'`\n[1] 10\n\n$`opal-demo`$`count of 'married'`\n[1] 36\n\n$`opal-demo`$`count of 'never_married'`\n[1] 30\n\n$`opal-demo`$`count of 'widowed'`\n[1] 12\n```\n\n\n:::\n:::\n\n\nAs we can observe, the `marital_status_nhanes.value_as_concept_id` column contains the following categories: \n\n- `divorced`\n- `married`\n- `never married`\n- `widowed`\n\nThose were originally numerical concept IDs in the database, but `dsOMOP` automatically translated them to their textual names.\n\n# Subsetting data\n\nAnother fundamental operation in the dataset construction process that may be required for specific research contexts is subsetting. It is used to filter tables based on specific criteria, such as gender, age, conditions, measurements, observations or other characteristics. This operation can be used to determine a specific cohort of individuals, since all the data that is going to be retrieved from the database from that point will be related to the remaining individuals in the `person` table.\n\nLets see with a simple example how we can filter, using the subset operation, a dataset to only include women patients. But first, **where do we find the gender data?**\n\n::: {.callout-tip collapse=\"true\"}\n## Click to see the solution\n\nThe gender data is part of the `person` table under the `gender_concept_id` column, which was automatically retrieved when we created the `helper` interface object. This means that it is already available in the `mimiciv` table under `mimiciv$gender_concept_id`.\n\n:::\n\nLet's first check that this variable is indeed available in the `mimiciv` table:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds.colnames(\"mimiciv\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`opal-demo`\n[1] \"person_id\"                                \n[2] \"gender_concept_id\"                        \n[3] \"year_of_birth\"                            \n[4] \"race_concept_id\"                          \n[5] \"ethnicity_concept_id\"                     \n[6] \"sbp\"                                      \n[7] \"marital_status_nhanes.value_as_concept_id\"\n```\n\n\n:::\n:::\n\n\nLet's also check a summary of this variable:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds.summary(\"mimiciv$gender_concept_id\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`opal-demo`\n$`opal-demo`$class\n[1] \"factor\"\n\n$`opal-demo`$length\n[1] 100\n\n$`opal-demo`$categories\n[1] \"female\" \"male\"  \n\n$`opal-demo`$`count of 'female'`\n[1] 43\n\n$`opal-demo`$`count of 'male'`\n[1] 57\n```\n\n\n:::\n:::\n\n\nAs we can observe, the `gender_concept_id` column contains the following categories: \n\n- `female`\n- `male`\n\nThose were also numerical concept IDs in the database that were matched to their corresponding concept names by `dsOMOP`.\n\nLet's start by renaming the `gender_concept_id` column to `gender` for convenience:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndh.renameVars(\n\tdf = \"mimiciv\", \n  current_names = c(\"gender_concept_id\"),\n  new_names = c(\"gender\"))\n```\n:::\n\n\nFrom this point on, all the data is already in the DataSHIELD environment, so we will use DataSHIELD's standard methods to perform the filtering. \n\nIn DataSHIELD, we first need to create a filter object in the server side that contains the value we want to filter by. Let's create a `gender_filter` object that contains the value `\"female\"`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds.make(newobj = \"gender_filter\", toAssign = \"c('female')\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$is.object.created\n[1] \"A data object <gender_filter> has been created in all specified data sources\"\n\n$validity.check\n[1] \"<gender_filter> appears valid in all sources\"\n```\n\n\n:::\n:::\n\n\nNow we can use the `ds.dataFrameSubset` function to filter the `mimiciv` table to only include female patients by passing the `gender_filter` object as a parameter with the `Boolean.operator` parameter set to `\"==\"`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds.dataFrameSubset(\n  df.name = \"mimiciv\",\n  V1.name = \"mimiciv$gender\",\n  V2.name = \"gender_filter\",\n  Boolean.operator = \"==\",\n  newobj = \"mimiciv\",\n  datasources = conns,\n  notify.of.progress = FALSE\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$is.object.created\n[1] \"A data object <mimiciv> has been created in all specified data sources\"\n\n$validity.check\n[1] \"<mimiciv> appears valid in all sources\"\n```\n\n\n:::\n:::\n\n\nThis will override the `mimiciv` table in the server side, which will now be the same table but only containing the female patients. Let's check if this is the case: \n\n\n::: {.cell}\n\n```{.r .cell-code}\nds.summary(\"mimiciv$gender\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`opal-demo`\n$`opal-demo`$class\n[1] \"factor\"\n\n$`opal-demo`$length\n[1] 43\n\n$`opal-demo`$categories\n[1] \"female\" \"male\"  \n\n$`opal-demo`$`count of 'female'`\n[1] 43\n\n$`opal-demo`$`count of 'male'`\n[1] 0\n```\n\n\n:::\n:::\n\n\nAs we can see, the `mimiciv` table contains only female patients now. If we were to retrieve any other data from the database with the `auto` method, it would only be related to the female patients from this point on.\n\n# More advanced operations\n\nLet's now perform a more advanced operation. We want to study the relationship between **chronic obstructive pulmonary disease (COPD)** and two key biomarkers: **tobacco use** and **asthma**, so we will perform a **generalized linear model (GLM)** to estimate the odds ratio (OR) of COPD for each biomarker. \n\nWe start by creating a new `helper` interface object where we will retrieve the specified data. Since we are not going to use the `helper` object and the `mimiciv` table from the previous section anymore, we will create new objects with the same name:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhelper <- ds.omop.helper(\n    connections = conns,\n    resource = \"omop_demo.mimiciv\", \n    symbol = \"mimiciv\"\n)\n```\n:::\n\n\nAs we can see, the `mimiciv` table now only contains the initial `person` table again:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds.summary(\"mimiciv\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`opal-demo`\n$`opal-demo`$class\n[1] \"data.frame\"\n\n$`opal-demo`$`number of rows`\n[1] 100\n\n$`opal-demo`$`number of columns`\n[1] 5\n\n$`opal-demo`$`variables held`\n[1] \"person_id\"            \"gender_concept_id\"    \"year_of_birth\"       \n[4] \"race_concept_id\"      \"ethnicity_concept_id\"\n```\n\n\n:::\n:::\n\n\nAnd we have restored all the patients that were in the `mimiciv` table from the previous section, not just the female patients:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds.summary(\"mimiciv$gender_concept_id\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`opal-demo`\n$`opal-demo`$class\n[1] \"factor\"\n\n$`opal-demo`$length\n[1] 100\n\n$`opal-demo`$categories\n[1] \"female\" \"male\"  \n\n$`opal-demo`$`count of 'female'`\n[1] 43\n\n$`opal-demo`$`count of 'male'`\n[1] 57\n```\n\n\n:::\n:::\n\n\nWe can now use the concept catalogs that we retrieved earlier to identify the concept IDs for COPD, tobacco use and asthma:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncondition_list\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`opal-demo`\n    concept_id                                                 concept_name\n1        27674                                          Nausea and vomiting\n2        29735                                         Candidiasis of mouth\n3        31317                                                    Dysphagia\n4        73553                                                  Arthropathy\n5        75576                                     Irritable bowel syndrome\n6        75860                                                 Constipation\n7        77670                                                   Chest pain\n8        78232                                          Shoulder joint pain\n9        79864                                           Hematuria syndrome\n10       80180                                               Osteoarthritis\n11       80502                                                 Osteoporosis\n12       80951                               Candidiasis of urogenital site\n13       81611                                Diverticular disease of colon\n14       81902                             Urinary tract infectious disease\n15      132736                                                   Bacteremia\n16      132797                                                       Sepsis\n17      134736                                                     Backache\n18      134765                                                     Cachexia\n19      138384                                      Acquired hypothyroidism\n20      140673                                               Hypothyroidism\n21      192357                                              Paralytic ileus\n22      192450                                           Retention of urine\n23      192671                                  Gastrointestinal hemorrhage\n24      192673                          Vascular insufficiency of intestine\n25      192680                                          Portal hypertension\n26      193688                           Clostridioides difficile infection\n27      193782                                      End-stage renal disease\n28      195306                                             Gastroduodenitis\n29      195562                                                  Hemorrhoids\n30      195581                                          Peritoneal adhesion\n31      196236                                                 Septic shock\n32      196463                                          Alcoholic cirrhosis\n33      196523                                                     Diarrhea\n34      197320                                          Acute kidney injury\n35      197444                        Vascular complication of medical care\n36      197494                                            Viral hepatitis C\n37      197672                                         Urinary incontinence\n38      197925                                Hemorrhage of rectum and anus\n39      197950                              Cellulitis and abscess of trunk\n40      198571                                            Cardiogenic shock\n41      198678                                Intestinal infectious disease\n42      198964                                          Chronic hepatitis C\n43      199074                                           Acute pancreatitis\n44      200219                                               Abdominal pain\n45      200451                          Chronic passive congestion of liver\n46      200528                                                      Ascites\n47      200618                                          Postoperative shock\n48      201061                                         Diaphragmatic hernia\n49      201826                                     Type 2 diabetes mellitus\n50      254061                                             Pleural effusion\n51      255573                             Chronic obstructive lung disease\n52      255848                                                    Pneumonia\n53      259992                              Ventilator associated pneumonia\n54      261600                                        Acute pulmonary edema\n55      261880                                                  Atelectasis\n56      313217                                          Atrial fibrillation\n57      314054                                        Aortic valve disorder\n58      314665                                               Atrial flutter\n59      314666                                    Old myocardial infarction\n60      315078                                                 Palpitations\n61      315286                               Chronic ischemic heart disease\n62      315831                              Chronic pulmonary heart disease\n63      316135                                       Atrioventricular block\n64      316139                                                Heart failure\n65      317002                                           Low blood pressure\n66      317003                                          Compression of vein\n67      317009                                                       Asthma\n68      317576                                    Coronary arteriosclerosis\n69      318736                                                     Migraine\n70      318772                                      Disorder of pericardium\n71      318800                              Gastroesophageal reflux disease\n72      319041                                      Orthostatic hypotension\n73      319049                                    Acute respiratory failure\n74      319835                                     Congestive heart failure\n75      319843                                        Mitral valve disorder\n76      319844                                 Acute ischemic heart disease\n77      320128                                       Essential hypertension\n78      321052                                  Peripheral vascular disease\n79      321462                                         Cardiac complication\n80      321887                                           Disorder of artery\n81      372448                                        Loss of consciousness\n82      372887                                            Disorder of brain\n83      372892                                     Metabolic encephalopathy\n84      373764                                         Toxic encephalopathy\n85      373995                                                     Delirium\n86      375519                                           Alcohol withdrawal\n87      376690                                               Cerebral edema\n88      376713                                          Cerebral hemorrhage\n89      377091                                                      Seizure\n90      378253                                                     Headache\n91      380378                                                     Epilepsy\n92      432545                                 Bacterial infectious disease\n93      432585                                   Blood coagulation disorder\n94      432867                                               Hyperlipidemia\n95      432870                                    Thrombocytopenic disorder\n96      432875                             Anemia due to chronic blood loss\n97      432881                                                 Pancytopenia\n98      433163                                 Deficiency of macronutrients\n99      433736                                                      Obesity\n100     433753                                                Alcohol abuse\n101     433968                                                  Candidiasis\n102     434004                                                 Hypervolemia\n103     434056                      Late effects of cerebrovascular disease\n104     434547                           Complication of surgical procedure\n105     434610                                                 Hyperkalemia\n106     434814        Late effect of medical and surgical care complication\n107     434894                                 Acute posthemorrhagic anemia\n108     435243                                           Alcohol dependence\n109     435515                          Hypo-osmolality and or hyponatremia\n110     435517                                                     Acidosis\n111     435788                            Disorder of phosphorus metabolism\n112     435796                                                  Dehydration\n113     435829                             Rheumatic disease of heart valve\n114     436073                                           Psychotic disorder\n115     436096                                                 Chronic pain\n116     436222                                        Altered mental status\n117     436238 Elevated level of transaminase and lactic acid dehydrogenase\n118     436659                                       Iron deficiency anemia\n119     436676                                Posttraumatic stress disorder\n120     436962                                                     Insomnia\n121     437233                                             Multiple myeloma\n122     437247                                    Anemia of chronic disease\n123     437264                                  Tobacco dependence syndrome\n124     437312                                                     Bleeding\n125     437382                                                Urine finding\n126     437390                                                    Hypoxemia\n127     437474                                      Postoperative infection\n128     437579                           Paroxysmal ventricular tachycardia\n129     437663                                                        Fever\n130     437779                             Streptococcal infectious disease\n131     437827                                    Pure hypercholesterolemia\n132     437833                                                  Hypokalemia\n133     438064                       Bacterial infection due to Pseudomonas\n134     438398                                                 Leukocytosis\n135     438725                             Disorder of magnesium metabolism\n136     438730                                                    Alkalosis\n137     439005                              Chronic alcoholism in remission\n138     439408                                          Graft complications\n139     439696 Hypertensive heart and renal disease with (congestive) he...\n140     439777                                                       Anemia\n141     440320                            Infection due to Escherichia coli\n142     440383                                          Depressive disorder\n143     440424                                                      Aphasia\n144     440530                                      Oropharyngeal dysphagia\n145     440674                                                         Gout\n146     440940        Methicillin resistant Staphylococcus aureus infection\n147     441258                                 Anemia in neoplastic disease\n148     441536                             Mixed acid-base balance disorder\n149     441829                         Hyperosmolality and or hypernatremia\n150     442019                                    Complication of procedure\n151     442077                                             Anxiety disorder\n152     442588                             Obstructive sleep apnea syndrome\n153     443211        Benign prostatic hyperplasia with outflow obstruction\n154     443238                                      Diabetic - poor control\n155     443344                                          Barrett's esophagus\n156     443447                                       Iatrogenic hypotension\n157     443530                                                 Hematochezia\n158     443597                               Chronic kidney disease stage 3\n159     443612                               Chronic kidney disease stage 4\n160     443734                 Ketoacidosis due to type 2 diabetes mellitus\n161     444044                                       Acute tubular necrosis\n162     444070                                                  Tachycardia\n163     444100                                                Mood disorder\n164     444101                                   Hypertensive heart failure\n165     444406                              Acute subendocardial infarction\n166     764123   Atherosclerosis of coronary artery without angina pectoris\n167    4008576                       Diabetes mellitus without complication\n168    4052648                                                   Disability\n169    4064161                                           Cirrhosis of liver\n170    4064452                                     ECG: atrial fibrillation\n171    4065288                                          EKG: atrial flutter\n172    4079687                                         Tumor lysis syndrome\n173    4088998                                 AV sequential pacing pattern\n174    4089488                                        Atrial pacing pattern\n175    4092038                                   Ventricular pacing pattern\n176    4094822                            Foreign body in respiratory tract\n177    4101362                                      Finding of urine output\n178    4126119                                            Toxic nephropathy\n179    4138456                                       ECG: sinus bradycardia\n180    4140598                                       ECG: sinus tachycardia\n181    4141820                                        ECG: sinus arrhythmia\n182    4144111          Gastroesophageal reflux disease without esophagitis\n183    4145510                            EKG: supraventricular tachycardia\n184    4145513                                            ECG: sinus rhythm\n185    4150981                                              Drug resistance\n186    4154290                               Paroxysmal atrial fibrillation\n187    4175154                    Disorder of the peripheral nervous system\n188    4182210                                                     Dementia\n189    4187218                         Pneumonitis due to inhaled substance\n190    4188331                                      Chronic pulmonary edema\n191    4193704                Type 2 diabetes mellitus without complication\n192    4209423                                          Nicotine dependence\n193    4229440                             Chronic congestive heart failure\n194    4232495                                       Primary cardiomyopathy\n195    4233565 Severe protein-calorie malnutrition (Gomez: less than 60 ...\n196    4245975                                              Hepatic failure\n197    4256228                                          Respiratory failure\n198    4268911                                                Disorientated\n199    4270024         Acute non-ST segment elevation myocardial infarction\n200    4282096                             Major depression, single episode\n201    4286201                                     Schizoaffective disorder\n202    4295261                                         Postmenopausal state\n203    4311499              Primary malignant neoplasm of respiratory tract\n204    4322175                    Late effect of complications of procedure\n205    4332246                                                     Aneurysm\n206    4339214                             Secondary pulmonary hypertension\n207    4353709                               Intracerebral vascular finding\n208   36712779                   Chronic total occlusion of coronary artery\n209   36712821                                     Postprocedural infection\n210   36712982 Unstable angina co-occurrent and due to coronary arterios...\n211   37016114               Acute on chronic hypoxemic respiratory failure\n212   37016349                Hyperglycemia due to type 2 diabetes mellitus\n213   37017432               Polyneuropathy due to type 2 diabetes mellitus\n214   37116361                            Accidental wound during procedure\n215   37311319                                                  Hypovolemia\n216   37394658                                                Severe sepsis\n217   37395564                                Hypoxemic respiratory failure\n218   40321716                                   Secondary thrombocytopenia\n219   40479192                               Chronic systolic heart failure\n220   40479576                              Chronic diastolic heart failure\n221   40480602                      Acute on chronic systolic heart failure\n222   40481043                     Acute on chronic diastolic heart failure\n223   40481762         Hemiplegia as late effect of cerebrovascular disease\n224   40481919                                     Coronary atherosclerosis\n225   40482801                       Type II diabetes mellitus uncontrolled\n226   40487064                               Sepsis due to Escherichia coli\n227   42537730                                Coronary artery graft present\n228   42537748                                    Acquired absence of organ\n229   42873170                            Dependence on supplemental oxygen\n230   43022062              Cardiovascular system complication of procedure\n231   43530681                                      Drug abuse in remission\n232   43530690                   Foot ulcer due to type 2 diabetes mellitus\n233   43530742 Paralytic syndrome on one side of the body as late effect...\n234   43531578       Chronic kidney disease due to type 2 diabetes mellitus\n235   44782421              Acute deep venous thrombosis of upper extremity\n236   44782429                   Chronic kidney disease due to hypertension\n237   44784217                                           Cardiac arrhythmia\n238   44784439         Benign hypertensive renal disease with renal failure\n239   44784631                               Pain due to neoplastic disease\n240   45757363                 Hypoglycemia due to type 2 diabetes mellitus\n241   45766207       Non-rheumatic mitral valve stenosis with regurgitation\n242   45768812                             Anemia in chronic kidney disease\n243   45768910                                         Uncomplicated asthma\n244   46271022                                       Chronic kidney disease\n245   46271075                          Acute hypoxemic respiratory failure\n246   46273390                                     Dependence on respirator\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nobservation_list\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`opal-demo`\n   concept_id                                                 concept_name\n1      432789                            Opioid analgesic adverse reaction\n2      433942                 Accident while engaged in household activity\n3      435928                                         Abnormal weight loss\n4      436583                                                         Fall\n5      438046 Medical accident to patient during surgical and medical care\n6      439996                               Anticoagulant adverse reaction\n7      440279                                                     Accident\n8      440922                                          Diabetic on insulin\n9      440927                             High risk drug monitoring status\n10     441207                                     Adverse reaction to drug\n11     441749                              Fall on or from stairs or steps\n12    2617452                       Hospital observation service, per hour\n13    3001062                                      History of Past illness\n14    3007397                                              Ventilator type\n15    3012697                                       History of Tobacco use\n16    3024265                            Body temperature measurement site\n17    3034263                                     Pain severity - Reported\n18    3039006                                              Oral care given\n19    4005823                                                 Tobacco user\n20    4014023                                              Palliative care\n21    4019967                                 Dependence on renal dialysis\n22    4036936                                              Oxygen delivery\n23    4060705                           Body mass index 25-29 - overweight\n24    4060985                                Body mass index 30+ - obesity\n25    4119499                                        Not for resuscitation\n26    4127294                                         Resuscitation status\n27    4135421                               Body mass index 20-24 - normal\n28    4138763                                 Acceptable pain level status\n29    4139934                                                     Homeless\n30    4140830                                           Fall on same level\n31    4143274                           History of cerebrovascular disease\n32    4148407                                   FH: Cardiovascular disease\n33    4162219       Patient transfer to postoperative anesthesia care unit\n34    4167217                           Family history of clinical finding\n35    4179242                        History of malignant neoplasm of skin\n36    4180749                    History of malignant neoplasm of prostate\n37    4182335                     Family history of ischemic heart disease\n38    4192791                                  Pain management (specialty)\n39    4203722                                  Patient encounter procedure\n40    4214956                       History of clinical finding in subject\n41    4215685                                    Past history of procedure\n42    4233464                           Legal physical restraint performed\n43    4256640                         Body mass index 40+ - severely obese\n44    4265599                      Patient transfer to intensive care unit\n45    4276526                                             Cigarette smoker\n46    4279614                                                 Asphyxiation\n47    4296248                                             Cost containment\n48    4311079       Place of occurrence of accident or poisoning, hospital\n49    4314870                 Place of occurrence of accident or poisoning\n50    4323345                                              History of fall\n51    4324190                      History of malignant neoplasm of breast\n52    4337265                                                 Bowel sounds\n53   21492835                                           Respiratory effort\n54   36717001                             Long-term current use of aspirin\n55   37116693                                      Stroke volume variation\n56   40479553                                    Cardiac pacemaker in situ\n57   40757693                          Indicators of pain or possible pain\n58   40758030                                           Preferred language\n59   40766231                                      Marital status [NHANES]\n60   46235654                                            Primary insurance\n61   46272450                        Long-term current use of drug therapy\n62   46272451                             Long-term current use of insulin\n63   46272666                            Coordination of family conference\n64   46273928                                         Liaising with family\n65   46273937                       Long-term current use of anticoagulant\n66   46274064                       History of antineoplastic chemotherapy\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmeasurement_list\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`opal-demo`\n    concept_id                                                 concept_name\n1            0                                          No matching concept\n2      1175625                                      Breath rate spontaneous\n3      3000067           Parathyrin.intact [Mass/volume] in Serum or Plasma\n4      3000068                                oxyCODONE [Presence] in Urine\n5      3000099            Nuclear Ab [Units/volume] in Serum by Immunoassay\n6      3000285                               Sodium [Moles/volume] in Blood\n7      3000330                      Specific gravity of Urine by Test strip\n8      3000348         Leukocyte esterase [Presence] in Urine by Test strip\n9      3000456           Dacrocytes [Presence] in Blood by Light microscopy\n10     3000461                          Pressure support setting Ventilator\n11     3000483                               Glucose [Mass/volume] in Blood\n12     3000593     Cobalamin (Vitamin B12) [Mass/volume] in Serum or Plasma\n13     3000764                          Benzodiazepines [Presence] in Urine\n14     3000941            Linezolid [Susceptibility] by Disk diffusion (KB)\n15     3000963                            Hemoglobin [Mass/volume] in Blood\n16     3001122                    Ferritin [Mass/volume] in Serum or Plasma\n17     3001308         Cholesterol in LDL [Moles/volume] in Serum or Plasma\n18     3001318            Cholesterol.total/Cholesterol in HDL [Percentile]\n19     3001494 Erythrocytes [#/volume] in Urine sediment by Microscopy h...\n20     3001582                     Protein/Creatinine [Mass Ratio] in Urine\n21     3001893                  Eosinophils/100 leukocytes in Pleural fluid\n22     3001950             Amikacin [Susceptibility] by Disk diffusion (KB)\n23     3002020                             Barbiturates [Presence] in Urine\n24     3002091         Choriogonadotropin [Moles/volume] in Serum or Plasma\n25     3002113  Variant lymphocytes [Presence] in Blood by Light microscopy\n26     3002179                       Metamyelocytes/100 leukocytes in Blood\n27     3002331                    Protein [Mass/volume] in Peritoneal fluid\n28     3002400                        Iron [Mass/volume] in Serum or Plasma\n29     3002827        Microalbumin/Creatinine [Mass Ratio] in 24 hour Urine\n30     3002850         Tetracycline [Susceptibility] by Disk diffusion (KB)\n31     3002888              Erythrocyte distribution width [Entitic volume]\n32     3003105           Gentamicin [Susceptibility] by Disk diffusion (KB)\n33     3003132            Barbiturates [Presence] in Serum, Plasma or Blood\n34     3003181                               Sodium [Moles/volume] in Urine\n35     3003282               Leukocytes [#/volume] in Blood by Manual count\n36     3003396                 Base excess in Arterial blood by calculation\n37     3003403                       Glucose [Mass/volume] in Pleural fluid\n38     3003434                       Protein [Mass/volume] in Pleural fluid\n39     3003709                  Acetaminophen [Presence] in Serum or Plasma\n40     3003785         Carcinoembryonic Ag [Mass/volume] in Serum or Plasma\n41     3003906            Oxacillin [Susceptibility] by Disk diffusion (KB)\n42     3004249                                      Systolic blood pressure\n43     3004295                         Urea nitrogen [Mass/volume] in Blood\n44     3004297                                      Temperature Inhaled gas\n45     3004327           Lymphocytes [#/volume] in Blood by Automated count\n46     3004354            ceFAZolin [Susceptibility] by Disk diffusion (KB)\n47     3004410                     Hemoglobin A1c/Hemoglobin.total in Blood\n48     3004501                     Glucose [Mass/volume] in Serum or Plasma\n49     3004588              Protein electrophoresis panel - Serum or Plasma\n50     3004698                                     QRS duration in lead III\n51     3004905        Lipase [Enzymatic activity/volume] in Serum or Plasma\n52     3004921                                  Ventilation mode Ventilator\n53     3005087     Macrophages/100 leukocytes in Body fluid by Manual count\n54     3005131 Glucose mean value [Mass/volume] in Blood Estimated from ...\n55     3005158          Clindamycin [Susceptibility] by Disk diffusion (KB)\n56     3005309                    Salicylates [Presence] in Serum or Plasma\n57     3005456                            Potassium [Moles/volume] in Blood\n58     3005481          Spherocytes [Presence] in Blood by Light microscopy\n59     3005555                              Left ventricular Cardiac output\n60     3005606                     Pulmonary artery Systolic blood pressure\n61     3005629                                     Inhaled oxygen flow rate\n62     3005686           Bite cells [Presence] in Blood by Light microscopy\n63     3005715                  Vancomycin [Mass/volume] in Serum or Plasma\n64     3005719                         IgG [Mass/volume] in Serum or Plasma\n65     3005854           Burr cells [Presence] in Blood by Light microscopy\n66     3005897                 Protein [Mass/volume] in Urine by Test strip\n67     3006122            Meropenem [Susceptibility] by Disk diffusion (KB)\n68     3006135   Nucleated erythrocytes [#/volume] in Blood by Manual count\n69     3006175       Mucus [Presence] in Urine sediment by Light microscopy\n70     3006490 Calcium oxalate crystals [Presence] in Urine sediment by ...\n71     3006923 Alanine aminotransferase [Enzymatic activity/volume] in S...\n72     3007070          Cholesterol in HDL [Mass/volume] in Serum or Plasma\n73     3007124   Reticulocytes/100 erythrocytes in Blood by Automated count\n74     3007164                         IgA [Mass/volume] in Serum or Plasma\n75     3007220 Creatine kinase [Enzymatic activity/volume] in Serum or P...\n76     3007350 Amorphous sediment [Presence] in Urine sediment by Light ...\n77     3007359          Bilirubin.indirect [Mass/volume] in Serum or Plasma\n78     3007469                               Breath rate setting Ventilator\n79     3007733                             Chloride [Moles/volume] in Urine\n80     3007794                                                 P-R Interval\n81     3007876                                          Appearance of Urine\n82     3007913         Alveolar-arterial oxygen Partial pressure difference\n83     3008223                                     Glasgow coma score motor\n84     3008251                          Bicarbonate [Moles/volume] in Urine\n85     3008295                                Osmolality of Serum or Plasma\n86     3008308         Erythromycin [Susceptibility] by Disk diffusion (KB)\n87     3008449                                 S wave amplitude in lead III\n88     3008504           Vancomycin [Susceptibility] by Disk diffusion (KB)\n89     3008598         Thyroxine (T4) free [Mass/volume] in Serum or Plasma\n90     3008691      Amylase [Enzymatic activity/volume] in Peritoneal fluid\n91     3008855          Leukocytes other/100 leukocytes in Peritoneal fluid\n92     3008939    Band form neutrophils [#/volume] in Blood by Manual count\n93     3009094                                    Glasgow coma score verbal\n94     3009201                Thyrotropin [Units/volume] in Serum or Plasma\n95     3009306         Alpha-1-Fetoprotein [Mass/volume] in Serum or Plasma\n96     3009314             Cefepime [Susceptibility] by Disk diffusion (KB)\n97     3009497                                              Type of GI tube\n98     3009542                        Hematocrit [Volume Fraction] of Blood\n99     3009613                  Erythrocytes [#/volume] in Peritoneal fluid\n100    3009682                    Cortisol [Mass/volume] in Serum or Plasma\n101    3009744                        MCHC [Mass/volume] by Automated count\n102    3010189 Epithelial cells [#/area] in Urine sediment by Microscopy...\n103    3010321                              Right eye Pupil diameter Manual\n104    3010340       Triiodothyronine (T3) [Mass/volume] in Serum or Plasma\n105    3010421                                                  pH of Blood\n106    3010834                Platelets [#/volume] in Blood by Manual count\n107    3011335                     Digoxin [Mass/volume] in Serum or Plasma\n108    3011368       Poikilocytosis [Presence] in Blood by Light microscopy\n109    3011397                 Hemoglobin [Presence] in Urine by Test strip\n110    3011483 Granular casts [#/area] in Urine sediment by Microscopy l...\n111    3011544                       Albumin [Mass/volume] in Pleural fluid\n112    3011589                                 T wave amplitude in lead III\n113    3011904                   Phosphate [Mass/volume] in Serum or Plasma\n114    3011965                         Urea nitrogen [Mass/volume] in Urine\n115    3011987        Polychromasia [Presence] in Blood by Light microscopy\n116    3012030                        MCH [Entitic mass] by Automated count\n117    3012095                  Magnesium [Moles/volume] in Serum or Plasma\n118    3012222 Trimethoprim+Sulfamethoxazole [Susceptibility] by Disk di...\n119    3012336                 Haptoglobin [Mass/volume] in Serum or Plasma\n120    3012410                              Tidal volume setting Ventilator\n121    3012501                          Base excess in Blood by calculation\n122    3012516                               Albumin [Mass/volume] in Urine\n123    3012888                                     Diastolic blood pressure\n124    3012986 Erythrocytes [#/volume] in Cerebral spinal fluid by Autom...\n125    3013290                   Carbon dioxide [Partial pressure] in Blood\n126    3013429             Basophils [#/volume] in Blood by Automated count\n127    3013466                           aPTT in Blood by Coagulation assay\n128    3013502                                   Oxygen saturation in Blood\n129    3013603        Prostate specific Ag [Mass/volume] in Serum or Plasma\n130    3013650           Neutrophils [#/volume] in Blood by Automated count\n131    3013678 Triglyceride [Mass/volume] in Serum or Plasma --12 hours ...\n132    3013682               Urea nitrogen [Mass/volume] in Serum or Plasma\n133    3013707          Erythrocyte sedimentation rate by Westergren method\n134    3013721 Aspartate aminotransferase [Enzymatic activity/volume] in...\n135    3013731 Hepatitis B virus surface Ab [Units/volume] in Serum or P...\n136    3014080                       Oxygen gas flow Oxygen delivery system\n137    3014576                   Chloride [Moles/volume] in Serum or Plasma\n138    3014886           Neutrophils [#/volume] in Urine by Automated count\n139    3015273                                         Consistency of Stool\n140    3015280                   Blasts [#/volume] in Blood by Manual count\n141    3015377                    Calcium [Moles/volume] in Serum or Plasma\n142    3015536                          ST amplitude.J point+80 ms Lead III\n143    3015862         levoFLOXacin [Susceptibility] by Disk diffusion (KB)\n144    3016038                            Potassium [Moles/volume] in Urine\n145    3016242 Piperacillin+Tazobactam [Susceptibility] by Disk diffusio...\n146    3016251              Hemoglobin.gastrointestinal [Presence] in Stool\n147    3016293                Bicarbonate [Moles/volume] in Serum or Plasma\n148    3016311  Creatine kinase.MB/Creatine kinase.total in Serum or Plasma\n149    3016335                               Glasgow coma score eye opening\n150    3016407 Fibrinogen [Mass/volume] in Platelet poor plasma by Coagu...\n151    3016502                          Oxygen saturation in Arterial blood\n152    3016557 Hepatitis B virus core Ab [Units/volume] in Serum by Immu...\n153    3016573 Ampicillin+Sulbactam [Susceptibility] by Disk diffusion (KB)\n154    3016723                  Creatinine [Mass/volume] in Serum or Plasma\n155    3016750                                 Collection duration of Urine\n156    3016771       Amylase [Enzymatic activity/volume] in Serum or Plasma\n157    3016879                                  Cocaine [Presence] in Urine\n158    3016991              Thyroxine (T4) [Mass/volume] in Serum or Plasma\n159    3017143                     Hepatitis C virus Ab [Presence] in Serum\n160    3017181                           Myelocytes/100 leukocytes in Blood\n161    3017188                    Pulmonary artery Diastolic blood pressure\n162    3017250                            Creatinine [Mass/volume] in Urine\n163    3017400                            Magnesium [Moles/volume] in Urine\n164    3017594                     Tidal volume.spontaneous --on ventilator\n165    3017595           Ampicillin [Susceptibility] by Disk diffusion (KB)\n166    3018053                                  S wave duration in lead III\n167    3018405                     Lactate [Moles/volume] in Arterial blood\n168    3018465                      Oxygen saturation in Mixed venous blood\n169    3018572                             Chloride [Moles/volume] in Blood\n170    3018672                                             pH of Body fluid\n171    3018760 Blood smear finding [Identifier] in Blood by Light micros...\n172    3018834            Bilirubin.total [Presence] in Urine by Test strip\n173    3018954      Choriogonadotropin (pregnancy test) [Presence] in Urine\n174    3019298               Eosinophils/100 leukocytes in Peritoneal fluid\n175    3019351                           QRS terminal amplitude in lead III\n176    3019416         Acanthocytes [Presence] in Blood by Light microscopy\n177    3019473               Protein [Mass/volume] in Cerebral spinal fluid\n178    3019510 Hepatitis B virus surface Ag [Presence] in Serum or Plasm...\n179    3019550                     Sodium [Moles/volume] in Serum or Plasma\n180    3019634 Microscopic observation [Identifier] in Tissue by Wright ...\n181    3019761  Pappenheimer bodies [Presence] in Blood by Light microscopy\n182    3019800          Troponin T.cardiac [Mass/volume] in Serum or Plasma\n183    3019880         Schistocytes [Presence] in Blood by Light microscopy\n184    3019897    Erythrocyte distribution width [Ratio] by Automated count\n185    3019977                                         pH of Arterial blood\n186    3020149        25-hydroxyvitamin D3 [Mass/volume] in Serum or Plasma\n187    3020153        Ciprofloxacin [Susceptibility] by Disk diffusion (KB)\n188    3020416          Erythrocytes [#/volume] in Blood by Automated count\n189    3020460          C reactive protein [Mass/volume] in Serum or Plasma\n190    3020481                                           Respiration rhythm\n191    3020630                     Protein [Mass/volume] in Serum or Plasma\n192    3020716                                 Inhaled oxygen concentration\n193    3020891                                             Body temperature\n194    3021044       Iron binding capacity [Mass/volume] in Serum or Plasma\n195    3021119                      Calcium.ionized [Moles/volume] in Blood\n196    3021200 Thyroglobulin Ab [Units/volume] in Serum by Radioimmunoas...\n197    3021303          Hypochromia [Presence] in Blood by Light microscopy\n198    3021453                     Eosinophils/100 leukocytes in Body fluid\n199    3021502           Macrocytes [Presence] in Blood by Light microscopy\n200    3021595                      Phenytoin [Presence] in Serum or Plasma\n201    3021601                    Nitrite [Presence] in Urine by Test strip\n202    3021886                              Globulin [Mass/volume] in Serum\n203    3022022                                                 QRS duration\n204    3022094           Tobramycin [Susceptibility] by Disk diffusion (KB)\n205    3022217             INR in Platelet poor plasma by Coagulation assay\n206    3022318                                            Heart rate rhythm\n207    3022509 Hyaline casts [#/area] in Urine sediment by Microscopy lo...\n208    3022548               Glucose [Mass/volume] in Cerebral spinal fluid\n209    3022621                                    pH of Urine by Test strip\n210    3022747          cefTRIAXone [Susceptibility] by Disk diffusion (KB)\n211    3022797                                 R wave amplitude in lead III\n212    3022875          Positive end expiratory pressure setting Ventilator\n213    3023103                  Potassium [Moles/volume] in Serum or Plasma\n214    3023307         Penicillin G [Susceptibility] by Disk diffusion (KB)\n215    3023314     Hematocrit [Volume Fraction] of Blood by Automated count\n216    3023520                            Reticulocytes [#/volume] in Blood\n217    3023539                 Ketones [Mass/volume] in Urine by Test strip\n218    3023547                Leukocytes other/100 leukocytes in Body fluid\n219    3023599                      MCV [Entitic volume] by Automated count\n220    3024128             Bilirubin.total [Mass/volume] in Serum or Plasma\n221    3024153            Promyelocytes [#/volume] in Blood by Manual count\n222    3024171                                             Respiratory rate\n223    3024561                     Albumin [Mass/volume] in Serum or Plasma\n224    3024629                 Glucose [Mass/volume] in Urine by Test strip\n225    3024882        Oxygen/Total gas setting [Volume Fraction] Ventilator\n226    3024929             Platelets [#/volume] in Blood by Automated count\n227    3025019                           Gas flow Respiratory system airway\n228    3025255 Bacteria [#/area] in Urine sediment by Microscopy high po...\n229    3025315                                                  Body weight\n230    3025439 Airway pressure Ventilator --at peak inspiratory flow max...\n231    3025478      Tricyclic antidepressants [Presence] in Serum or Plasma\n232    3025616         Target cells [Presence] in Blood by Light microscopy\n233    3025809                                                 Q-T interval\n234    3026256                            QRS initial amplitude in lead III\n235    3026258                                       Q-T interval corrected\n236    3026314         Anisocytosis [Presence] in Blood by Light microscopy\n237    3026400                        Ethanol [Presence] in Serum or Plasma\n238    3026611                               Left eye Pupil diameter Manual\n239    3026692                    Albumin [Mass/volume] in Peritoneal fluid\n240    3026729                             Phosphate [Mass/volume] in Urine\n241    3026782                                          Osmolality of Urine\n242    3026904 Basophilic stippling [Presence] in Blood by Light microscopy\n243    3026910 Gamma glutamyl transferase [Enzymatic activity/volume] in...\n244    3027008                                  Opiates [Presence] in Urine\n245    3027018                                                   Heart rate\n246    3027114                 Cholesterol [Mass/volume] in Serum or Plasma\n247    3027162                                               Color of Urine\n248    3027315                           Oxygen [Partial pressure] in Blood\n249    3027597            Bilirubin.direct [Mass/volume] in Serum or Plasma\n250    3027598                                          Mean blood pressure\n251    3027801                  Oxygen [Partial pressure] in Arterial blood\n252    3027920           Ovalocytes [Presence] in Blood by Light microscopy\n253    3027944                             Amphetamines [Presence] in Urine\n254    3027946          Carbon dioxide [Partial pressure] in Arterial blood\n255    3028026                         IgM [Mass/volume] in Serum or Plasma\n256    3028074                         Pulmonary artery Mean blood pressure\n257    3028308                     Erythrocytes [#/volume] in Pleural fluid\n258    3028437          Cholesterol in LDL [Mass/volume] in Serum or Plasma\n259    3028468            Fragments [Presence] in Blood by Light microscopy\n260    3028561                                  R wave duration in lead III\n261    3028615           Eosinophils [#/volume] in Blood by Automated count\n262    3028662 Hepatitis A virus Ab [Units/volume] in Serum or Plasma by...\n263    3029187 Natriuretic peptide.B prohormone N-Terminal [Mass/volume]...\n264    3031147 Carbon dioxide, total [Moles/volume] in Blood by calculation\n265    3031951                          Benzodiazepines [Presence] in Blood\n266    3033364                   Cholesterol [Mass/volume] in Pleural fluid\n267    3033483                 Monocytes/100 leukocytes in Peritoneal fluid\n268    3033575             Monocytes [#/volume] in Blood by Automated count\n269    3034426                                        Prothrombin time (PT)\n270    3035206                               Physical mobility Braden scale\n271    3035359                          ST amplitude.J point+60 ms Lead III\n272    3035583 Leukocytes [#/area] in Urine sediment by Microscopy high ...\n273    3035816                        Nutrition intake pattern Braden scale\n274    3035851 Transitional cells [#/area] in Urine sediment by Microsco...\n275    3035995 Alkaline phosphatase [Enzymatic activity/volume] in Serum...\n276    3036098                              Sensory perception Braden scale\n277    3036180                                Methadone [Presence] in Urine\n278    3036277                                                  Body height\n279    3036354         Leukocytes other [#/volume] in Blood by Manual count\n280    3036518                               Left ventricular Stroke volume\n281    3036987                      Folate [Mass/volume] in Serum or Plasma\n282    3037022                               Moisture exposure Braden scale\n283    3037153             rifAMPin [Susceptibility] by Disk diffusion (KB)\n284    3037185                                  Protein [Presence] in Urine\n285    3037244 Yeast [#/area] in Urine sediment by Microscopy high power...\n286    3037274    HIV 1 Ab [Units/volume] in Serum or Plasma by Immunoassay\n287    3037278                               Anion gap 4 in Serum or Plasma\n288    3037318                               Physical activity Braden scale\n289    3037347                              Friction and shear Braden scale\n290    3037426               Urobilinogen [Presence] in Urine by Test strip\n291    3037490                                               Color of Stool\n292    3037556                       Urate [Mass/volume] in Serum or Plasma\n293    3037577            Monocytes/100 leukocytes in Cerebral spinal fluid\n294    3037663 Carbon dioxide, total [Moles/volume] in Arterial blood by...\n295    3037871 Macrophages/100 leukocytes in Cerebral spinal fluid by Ma...\n296    3037885           Microcytes [Presence] in Blood by Light microscopy\n297    3038047       Nitrofurantoin [Susceptibility] by Disk diffusion (KB)\n298    3038086          cefTAZidime [Susceptibility] by Disk diffusion (KB)\n299    3038104                       Monocytes/100 leukocytes in Body fluid\n300    3038288 Influenza virus B RNA [Presence] in Specimen by NAA with ...\n301    3039000                                           Anion gap in Blood\n302    3040168                    Immature granulocytes [#/volume] in Blood\n303    3041079 Nucleated cells [#/volume] in Pleural fluid by Automated ...\n304    3041372 Nucleated cells [#/volume] in Cerebral spinal fluid by Au...\n305    3041408 Nucleated cells [#/volume] in Peritoneal fluid by Automat...\n306    3041635 Macrophages/100 leukocytes in Peritoneal fluid by Manual ...\n307    3042347                                           Dressing for Wound\n308    3043387                    Monocytes/100 leukocytes in Pleural fluid\n309    3043728   WBC casts [Presence] in Urine sediment by Light microscopy\n310    3043970                                                Color of Skin\n311    3044938 Influenza virus A RNA [Presence] in Specimen by NAA with ...\n312    3046838                                                   Edema site\n313    3047181                              Lactate [Moles/volume] in Blood\n314    3051714     Fibrin D-dimer FEU [Mass/volume] in Platelet poor plasma\n315    4024509                                                Urine culture\n316    4024510                                Microbial culture, body fluid\n317    4035228                                Respiratory microbial culture\n318    4036044                                  Anaerobic microbial culture\n319    4107893                                                Blood culture\n320    4165398                                             Mycology culture\n321    4189544                                            Microbial culture\n322    4247906                                  Clostridium difficile assay\n323    4265595                                  Creatine kinase measurement\n324    4300293                                               Tissue culture\n325   21490516                        Inspiration [Time] Respiratory system\n326   21490580       Carbon dioxide production (VCO2) in Respiratory system\n327   21490650  Pressure max Respiratory system airway --during inspiration\n328   21490675                                Central venous pressure (CVP)\n329   21490712                               Left ventricular Cardiac index\n330   21490753                 Volume expired per minute Respiratory system\n331   21490854                      Tidal volume Ventilator --on ventilator\n332   21490880                         Left ventricular Stroke volume index\n333   21490888                               PCA lockout time Infusion pump\n334   21490963                               Right pupil Pupillary response\n335   21491186                                   Endotracheal tube Diameter\n336   21491763                                Left pupil Pupillary response\n337   21492239                       Systolic blood pressure by Noninvasive\n338   21492240                      Diastolic blood pressure by Noninvasive\n339   21492241                           Mean blood pressure by Noninvasive\n340   21492838                                               Skin integrity\n341   21494965                                               Passing flatus\n342   21494966                    Physical findings of Abdomen by Palpation\n343   36203862                                              Color of Sputum\n344   36303946   Pressure.plateau Respiratory system airway --on ventilator\n345   36684829                            Richmond Agitation-Sedation Scale\n346   40760766       Tidal volume.inspired maximum setting Ventilator alarm\n347   40762499        Oxygen saturation in Arterial blood by Pulse oximetry\n348   40762903                              Apnea interval Ventilator alarm\n349   40763080 Lactate dehydrogenase [Enzymatic activity/volume] in Peri...\n350   42527086                                         Mean airway pressure\n351   42527140                                Total PEEP Respiratory system\n352   43055270                                           Wound closure type\n353   46236952 Glomerular filtration rate/1.73 sq M.predicted [Volume Ra...\n```\n\n\n:::\n:::\n\n\n**Can you identify the concept IDs for COPD, tobacco use and asthma?**\n\n::: {.callout-tip collapse=\"true\"}\n## Click to see the solution\n\n1. **Chronic obstructive pulmonary disease**: 255573\n   - Found in Condition occurrence\n   - Concept name: Chronic obstructive lung disease\n\n2. **Tobacco use**: 4005823\n   - Found in Observation\n   - Concept name: Tobacco user\n\n3. **Asthma**: 317009\n   - Found in Condition occurrence\n   - Concept name: Asthma\n:::\n\nLet's now retrieve these variables from the database. In this case, our strategy will be to retrieve any form of data related to the variables we are studying. OMOP CDM tables are designed to only register the presence of a concept in a patient, so we will have to retrieve those and create auxiliar boolean variables that indicate the presence of the concept in the patient. This means that we can just retrieve the basic identifiers for each concept:\n\n- From the `condition_occurrence` table,\n- get COPD (whose concept ID is `255573`) and asthma (whose concept ID is `317009`),\n- taking only the `condition_occurrence_id` column\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhelper$auto(\n    table = \"condition_occurrence\",\n    concepts = c(255573, 317009),\n    columns = \"condition_occurrence_id\"\n)\n```\n:::\n\n\n- From the `observation` table,\n- get tobacco use (whose concept ID is `4005823`),\n- taking only the `observation_id` column\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhelper$auto(\n    table = \"observation\",\n    concepts = 4005823,\n    columns = \"observation_id\"\n)\n```\n:::\n\n\nWe can now check the current state of the `mimiciv` table:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds.summary(\"mimiciv\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`opal-demo`\n$`opal-demo`$class\n[1] \"data.frame\"\n\n$`opal-demo`$`number of rows`\n[1] 100\n\n$`opal-demo`$`number of columns`\n[1] 8\n\n$`opal-demo`$`variables held`\n[1] \"person_id\"                                               \n[2] \"gender_concept_id\"                                       \n[3] \"year_of_birth\"                                           \n[4] \"race_concept_id\"                                         \n[5] \"ethnicity_concept_id\"                                    \n[6] \"chronic_obstructive_lung_disease.condition_occurrence_id\"\n[7] \"asthma.condition_occurrence_id\"                          \n[8] \"tobacco_user.observation_id\"                             \n```\n\n\n:::\n:::\n\n\nAs we can see, the `mimiciv` table now contains: \n\n- `chronic_obstructive_lung_disease.condition_occurrence_id`\n- `tobacco_user.observation_id`\n- `asthma.condition_occurrence_id`\n\nWe can now create boolean variables that indicate the presence of each concept in the patient. DataSHIELD will not transform an ID to a boolean if it is in a string format, so this process involves two steps:\n\n1. Transforming the ID to numeric\n2. Transforming the numeric ID to boolean\n\nLet's start by transforming the COPD variable: \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert COPD ID to numeric\nds.asNumeric(\n    x.name = \"mimiciv$chronic_obstructive_lung_disease.condition_occurrence_id\",\n    newobj = \"copd_numeric\",\n    datasources = conns\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$is.object.created\n[1] \"A data object <copd_numeric> has been created in all specified data sources\"\n\n$validity.check\n[1] \"<copd_numeric> appears valid in all sources\"\n```\n\n\n:::\n\n```{.r .cell-code}\n# Convert numeric COPD to boolean\nds.Boole(\n    V1 = \"copd_numeric\",\n    V2 = 0,\n    Boolean.operator = \"!=\",\n    numeric.output = TRUE,\n    na.assign = 0,\n    newobj = \"copd\",\n    datasources = conns\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$is.object.created\n[1] \"A data object <copd> has been created in all specified data sources\"\n\n$validity.check\n[1] \"<copd> appears valid in all sources\"\n```\n\n\n:::\n:::\n\n\nThis has created a `copd` object in the server that contains the boolean variables indicating the presence of COPD in the patient.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds.table(\"copd\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n Data in all studies were valid \n\nStudy 1 :  No errors reported from this study\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$output.list\n$output.list$TABLE_rvar.by.study_row.props\n    study\ncopd opal-demo\n  0          1\n  1          1\n  NA       NaN\n\n$output.list$TABLE_rvar.by.study_col.props\n    study\ncopd opal-demo\n  0       0.87\n  1       0.13\n  NA      0.00\n\n$output.list$TABLE_rvar.by.study_counts\n    study\ncopd opal-demo\n  0         87\n  1         13\n  NA         0\n\n$output.list$TABLES.COMBINED_all.sources_proportions\ncopd\n   0    1   NA \n0.87 0.13 0.00 \n\n$output.list$TABLES.COMBINED_all.sources_counts\ncopd\n 0  1 NA \n87 13  0 \n\n\n$validity.message\n[1] \"Data in all studies were valid\"\n```\n\n\n:::\n:::\n\n\nLet's now repeat the same process for the tobacco use variable:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert tobacco ID to numeric\nds.asNumeric(\n    x.name = \"mimiciv$tobacco_user.observation_id\",\n    newobj = \"tobacco_numeric\",\n    datasources = conns\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$is.object.created\n[1] \"A data object <tobacco_numeric> has been created in all specified data sources\"\n\n$validity.check\n[1] \"<tobacco_numeric> appears valid in all sources\"\n```\n\n\n:::\n\n```{.r .cell-code}\n# Convert numeric tobacco to boolean \nds.Boole(\n    V1 = \"tobacco_numeric\",\n    V2 = 0,\n    Boolean.operator = \"!=\",\n    numeric.output = TRUE,\n    na.assign = 0,\n    newobj = \"tobacco\",\n    datasources = conns\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$is.object.created\n[1] \"A data object <tobacco> has been created in all specified data sources\"\n\n$validity.check\n[1] \"<tobacco> appears valid in all sources\"\n```\n\n\n:::\n:::\n\n\nand for the asthma variable:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert asthma ID to numeric \nds.asNumeric(\n    x.name = \"mimiciv$asthma.condition_occurrence_id\",\n    newobj = \"asthma_numeric\", \n    datasources = conns\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$is.object.created\n[1] \"A data object <asthma_numeric> has been created in all specified data sources\"\n\n$validity.check\n[1] \"<asthma_numeric> appears valid in all sources\"\n```\n\n\n:::\n\n```{.r .cell-code}\n# Convert numeric asthma to boolean\nds.Boole(\n    V1 = \"asthma_numeric\",\n    V2 = 0,\n    Boolean.operator = \"!=\", \n    numeric.output = TRUE,\n    na.assign = 0,\n    newobj = \"asthma\",\n    datasources = conns\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$is.object.created\n[1] \"A data object <asthma> has been created in all specified data sources\"\n\n$validity.check\n[1] \"<asthma> appears valid in all sources\"\n```\n\n\n:::\n:::\n\n\nWe can now check the presence of the `tobacco` and `asthma` objects in the server side:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds.table(\"tobacco\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n Data in all studies were valid \n\nStudy 1 :  No errors reported from this study\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$output.list\n$output.list$TABLE_rvar.by.study_row.props\n       study\ntobacco opal-demo\n     0          1\n     1          1\n     NA       NaN\n\n$output.list$TABLE_rvar.by.study_col.props\n       study\ntobacco opal-demo\n     0       0.96\n     1       0.04\n     NA      0.00\n\n$output.list$TABLE_rvar.by.study_counts\n       study\ntobacco opal-demo\n     0         96\n     1          4\n     NA         0\n\n$output.list$TABLES.COMBINED_all.sources_proportions\ntobacco\n   0    1   NA \n0.96 0.04 0.00 \n\n$output.list$TABLES.COMBINED_all.sources_counts\ntobacco\n 0  1 NA \n96  4  0 \n\n\n$validity.message\n[1] \"Data in all studies were valid\"\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds.table(\"asthma\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n Data in all studies were valid \n\nStudy 1 :  No errors reported from this study\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$output.list\n$output.list$TABLE_rvar.by.study_row.props\n      study\nasthma opal-demo\n    0          1\n    1          1\n    NA       NaN\n\n$output.list$TABLE_rvar.by.study_col.props\n      study\nasthma opal-demo\n    0       0.91\n    1       0.09\n    NA      0.00\n\n$output.list$TABLE_rvar.by.study_counts\n      study\nasthma opal-demo\n    0         91\n    1          9\n    NA         0\n\n$output.list$TABLES.COMBINED_all.sources_proportions\nasthma\n   0    1   NA \n0.91 0.09 0.00 \n\n$output.list$TABLES.COMBINED_all.sources_counts\nasthma\n 0  1 NA \n91  9  0 \n\n\n$validity.message\n[1] \"Data in all studies were valid\"\n```\n\n\n:::\n:::\n\n\nWe can now perform the GLM analysis using the `ds.glm` function from DataSHIELD:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nds.glm(\n    formula = \"copd ~ tobacco + asthma\",\n    family = \"binomial\",\n    datasources = conns\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$Nvalid\n[1] 100\n\n$Nmissing\n[1] 0\n\n$Ntotal\n[1] 100\n\n$disclosure.risk\n          RISK OF DISCLOSURE\nopal-demo                  0\n\n$errorMessage\n          ERROR MESSAGES\nopal-demo \"No errors\"   \n\n$nsubs\n[1] 100\n\n$iter\n[1] 18\n\n$family\n\nFamily: binomial \nLink function: logit \n\n\n$formula\n[1] \"copd ~ tobacco + asthma\"\n\n$coefficients\n              Estimate   Std. Error      z-value      p-value low0.95CI.LP\n(Intercept)  -1.845827    0.3106304 -5.942196444 2.812281e-09    -2.454651\ntobacco       1.152680    1.2635233  0.912274032 3.616245e-01    -1.323781\nasthma      -17.548914 2953.9650106 -0.005940799 9.952600e-01 -5807.213946\n            high0.95CI.LP         P_OR low0.95CI.P_OR high0.95CI.P_OR\n(Intercept)     -1.237002 1.363636e-01     0.07909909       0.2249582\ntobacco          3.629140 3.166667e+00     0.26612726      37.6803863\nasthma        5772.116119 2.391132e-08     0.00000000             Inf\n\n$dev\n[1] 73.92114\n\n$df\n[1] 97\n\n$output.information\n[1] \"SEE TOP OF OUTPUT FOR INFORMATION ON MISSING DATA AND ERROR MESSAGES\"\n```\n\n\n:::\n:::\n\n\n**Note:** Our dataset is very small, so the GLM analysis is not very reliable. This is just an example of how to perform a GLM analysis in DataSHIELD with data imported from an OMOP database.\n\n# Logout\n\nDo not forget to logout from the DataSHIELD server after finishing the exercise:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndatashield.logout(conns)\n```\n:::\n\n",
    "supporting": [
      "dsomop_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}