<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>dsOMOP Workshop – DataSHIELD Workshop</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-8ef56b68f8fa1e9d2ba328e99e439f80.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-b515dea5baab39ffcfcd4bae179e3bdb.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-195886546b2eb1f67ede645fd062ce19.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-b515dea5baab39ffcfcd4bae179e3bdb.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">DataSHIELD Workshop</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./setup.html"> 
<span class="menu-text">Setup</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-datashield" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">DataSHIELD</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-datashield">    
        <li>
    <a class="dropdown-item" href="./datashield_slides.html">
 <span class="dropdown-text">Slides</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./datashield_tables.html">
 <span class="dropdown-text">Working with Tables</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./datashield_resources.html">
 <span class="dropdown-text">Working with Resources</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-dsomop" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">dsOMOP</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-dsomop">    
        <li>
    <a class="dropdown-item" href="./dsomop_slides.html">
 <span class="dropdown-text">Slides</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./dsomop.html">
 <span class="dropdown-text">Practical Exercise</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./resources.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./contact.html"> 
<span class="menu-text">Contact</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#recommended-background-knowledge" id="toc-recommended-background-knowledge" class="nav-link active" data-scroll-target="#recommended-background-knowledge">Recommended background knowledge</a></li>
  <li><a href="#initial-setup" id="toc-initial-setup" class="nav-link" data-scroll-target="#initial-setup">Initial setup</a></li>
  <li><a href="#creating-an-omop-database-interface-object" id="toc-creating-an-omop-database-interface-object" class="nav-link" data-scroll-target="#creating-an-omop-database-interface-object">Creating an OMOP database interface object</a></li>
  <li><a href="#data-exploration" id="toc-data-exploration" class="nav-link" data-scroll-target="#data-exploration">Data exploration</a></li>
  <li><a href="#data-retrieval" id="toc-data-retrieval" class="nav-link" data-scroll-target="#data-retrieval">Data retrieval</a></li>
  <li><a href="#subsetting-data" id="toc-subsetting-data" class="nav-link" data-scroll-target="#subsetting-data">Subsetting data</a></li>
  <li><a href="#more-advanced-operations" id="toc-more-advanced-operations" class="nav-link" data-scroll-target="#more-advanced-operations">More advanced operations</a></li>
  <li><a href="#logout" id="toc-logout" class="nav-link" data-scroll-target="#logout">Logout</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">dsOMOP Workshop</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><a href="https://github.com/isglobal-brge/workshop_datashield/raw/main/dsomop.R" class="btn btn-primary btn-sm" download=""> <i class="bi bi-download"></i> Download R Script </a></p>
<p>In this lesson, we will learn how to:</p>
<ul>
<li>Set up the required dependencies and connect to a DataSHIELD server</li>
<li>Create an interface object to interact with an OMOP database</li>
<li>Explore the available data and identify the concepts of interest</li>
<li>Retrieve data from the OMOP database using the interface object</li>
<li>Explore the retrieved data and manipulate it using DataSHIELD functions</li>
<li>Create cohort definitions using DataSHIELD functions to filter the data</li>
<li>Perform a practical example of an analysis integrating the retrieved data into the DataSHIELD workflow</li>
</ul>
<section id="recommended-background-knowledge" class="level1">
<h1>Recommended background knowledge</h1>
<p>Before using <code>dsOMOP</code>, it is recommended to have a basic understanding of:</p>
<ul>
<li><p>The OMOP CDM structure and its standardized clinical data format. You can learn more about OMOP CDM in the <a href="https://ohdsi.github.io/TheBookOfOhdsi/CommonDataModel.html">OHDSI Book chapter ‘The Common Data Model’</a>.</p></li>
<li><p>OMOP Vocabularies and how they standardize medical concepts (like diagnoses, medications, procedures) across different coding systems (ICD-9, ICD-10, SNOMED CT, etc.) into a common representation. The <a href="https://ohdsi.github.io/TheBookOfOhdsi/StandardizedVocabularies.html">OHDSI Book chapter ‘Standardized Vocabularies’</a> provides a comprehensive overview of this standardization process.</p></li>
<li><p>Basic DataSHIELD concepts and workflow. The <a href="https://data2knowledge.atlassian.net/wiki/spaces/DSDEV/pages/931069953/Beginners+Tutorial+DataSHIELD+v6.1">DataSHIELD Beginner’s Tutorial</a> is a good starting point.</p></li>
<li><p>For more information about the <code>dsOMOP</code> framework, you can visit the <a href="https://isglobal-brge.github.io/dsOMOP/">dsOMOP website</a>.</p></li>
</ul>
<p>This knowledge will help you better understand how to effectively query and work with OMOP CDM data through the DataSHIELD infrastructure.</p>
</section>
<section id="initial-setup" class="level1">
<h1>Initial setup</h1>
<p>For this exercise, we will use the following libraries:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DSI)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DSOpal)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dsBaseClient)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dsOMOPClient)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dsOMOPHelper)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dsHelper)</span></code></pre></div>
</div>
<p>We will establish a connection to the demo Opal server. In order to use the OMOP packages and have access to the OMOP database resources, we need to specify the <code>profile = "omop"</code> parameter in the login builder:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>builder <span class="ot">&lt;-</span> <span class="fu">newDSLoginBuilder</span>()</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>builder<span class="sc">$</span><span class="fu">append</span>(<span class="at">server=</span><span class="st">"opal-demo"</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">url=</span><span class="st">"https://opal-demo.obiba.org/"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">user=</span><span class="st">"dsuser"</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">password=</span><span class="st">"P@ssw0rd"</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">driver =</span> <span class="st">"OpalDriver"</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">profile =</span> <span class="st">"omop"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>logindata <span class="ot">&lt;-</span> builder<span class="sc">$</span><span class="fu">build</span>()</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>conns <span class="ot">&lt;-</span> <span class="fu">datashield.login</span>(<span class="at">logins=</span>logindata)</span></code></pre></div>
</div>
</section>
<section id="creating-an-omop-database-interface-object" class="level1">
<h1>Creating an OMOP database interface object</h1>
<p>We will create an OMOP database interface object using the <code>ds.omop.helper</code> function. This interface object provides a set of methods for easily interacting with an OMOP database.</p>
<p>In our case, we will use the <code>mimiciv</code> resource inside the <code>omop_demo</code> project, which points to a small sample database formatted in OMOP CDM:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>helper <span class="ot">&lt;-</span> <span class="fu">ds.omop.helper</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">connections =</span> conns,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">resource =</span> <span class="st">"omop_demo.mimiciv"</span>, </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">symbol =</span> <span class="st">"mimiciv"</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<p>This will create both the object <code>helper</code> which will assist us in the creation of our desired dataset, and parallely a table in the server side called <code>mimiciv</code> (since this is the name we specified in the <code>symbol</code> parameter) which will contain the data that we import from the OMOP database.</p>
<p>We can check the list of objects available in the server side using the <code>ds.ls</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.ls</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`opal-demo`
$`opal-demo`$environment.searched
[1] "R_GlobalEnv"

$`opal-demo`$objects.found
[1] "mimiciv"</code></pre>
</div>
</div>
<p>As we can observe, <code>mimiciv</code> has been successfully created in the server side. We can check the current state of the <code>mimiciv</code> table in the server side at any time using the <code>ds.summary</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.summary</span>(<span class="st">"mimiciv"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`opal-demo`
$`opal-demo`$class
[1] "data.frame"

$`opal-demo`$`number of rows`
[1] 100

$`opal-demo`$`number of columns`
[1] 5

$`opal-demo`$`variables held`
[1] "person_id"            "gender_concept_id"    "year_of_birth"       
[4] "race_concept_id"      "ethnicity_concept_id"</code></pre>
</div>
</div>
<p>The <code>mimiciv</code> table initially contains only the <code>person</code> table, as that is the nexus table in the OMOP CDM. This allows us to append data from other tables since all pieces of information are linked to the <code>person</code> table, since it is the table that contains the patient identifiers.</p>
<p>Now it is time to retrieve more data and add it to the <code>mimiciv</code> object using the <code>helper</code> interface object! But first, we need to explore our database to plan the data retrieval.</p>
</section>
<section id="data-exploration" class="level1">
<h1>Data exploration</h1>
<p>The first step is to identify the data that is available in the OMOP database. We can check the available tables using the <code>tables</code> method. The table structure should usually one that matches one version of the OMOP CDM (in our case, the <code>mimiciv</code> database is formatted in the <a href="https://ohdsi.github.io/CommonDataModel/cdm54.html">OMOP CDM 5.4</a>. This commonly provides a good starting point to understand the structure of our data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>helper<span class="sc">$</span><span class="fu">tables</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`opal-demo`
 [1] "attribute_definition" "care_site"            "cdm_source"          
 [4] "cohort"               "cohort_attribute"     "cohort_definition"   
 [7] "concept"              "concept_relationship" "condition_era"       
[10] "condition_occurrence" "cost"                 "death"               
[13] "device_exposure"      "dose_era"             "drug_era"            
[16] "drug_exposure"        "fact_relationship"    "location"            
[19] "measurement"          "metadata"             "note"                
[22] "note_nlp"             "observation"          "observation_period"  
[25] "payer_plan_period"    "person"               "procedure_occurrence"
[28] "provider"             "specimen"             "visit_detail"        
[31] "visit_occurrence"     "vocabulary"          </code></pre>
</div>
</div>
<p>As expected, the <code>mimiciv</code> database presents the structure of the OMOP CDM 5.4:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/cdm54.png" class="img-fluid figure-img"></p>
<figcaption>OMOP CDM v5.4 schema</figcaption>
</figure>
</div>
<p>We can also check the columns available in each table using the <code>columns</code> method. These should match the columns available in the OMOP CDM documentation for the specific version of the CDM that the database is formatted in. This information is also available in the <a href="https://ohdsi.github.io/CommonDataModel/cdm54.html">OMOP CDM documentation</a>, but is a good reminder of the structure of the data.</p>
<p>Let’s check the columns available in the <code>condition_occurrence</code>, <code>measurement</code> and <code>observation</code> tables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>helper<span class="sc">$</span><span class="fu">columns</span>(<span class="st">"condition_occurrence"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`opal-demo`
$`opal-demo`$condition_occurrence
 [1] "condition_occurrence_id"       "person_id"                    
 [3] "condition_concept_id"          "condition_start_date"         
 [5] "condition_start_datetime"      "condition_end_date"           
 [7] "condition_end_datetime"        "condition_type_concept_id"    
 [9] "stop_reason"                   "provider_id"                  
[11] "visit_occurrence_id"           "visit_detail_id"              
[13] "condition_source_value"        "condition_source_concept_id"  
[15] "condition_status_source_value" "condition_status_concept_id"  </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>helper<span class="sc">$</span><span class="fu">columns</span>(<span class="st">"measurement"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`opal-demo`
$`opal-demo`$measurement
 [1] "measurement_id"                "person_id"                    
 [3] "measurement_concept_id"        "measurement_date"             
 [5] "measurement_datetime"          "measurement_time"             
 [7] "measurement_type_concept_id"   "operator_concept_id"          
 [9] "value_as_number"               "value_as_concept_id"          
[11] "unit_concept_id"               "range_low"                    
[13] "range_high"                    "provider_id"                  
[15] "visit_occurrence_id"           "visit_detail_id"              
[17] "measurement_source_value"      "measurement_source_concept_id"
[19] "unit_source_value"             "value_source_value"           </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>helper<span class="sc">$</span><span class="fu">columns</span>(<span class="st">"observation"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`opal-demo`
$`opal-demo`$observation
 [1] "observation_id"                "person_id"                    
 [3] "observation_concept_id"        "observation_date"             
 [5] "observation_datetime"          "observation_type_concept_id"  
 [7] "value_as_number"               "value_as_string"              
 [9] "value_as_concept_id"           "qualifier_concept_id"         
[11] "unit_concept_id"               "provider_id"                  
[13] "visit_occurrence_id"           "visit_detail_id"              
[15] "observation_source_value"      "observation_source_concept_id"
[17] "unit_source_value"             "qualifier_source_value"       </code></pre>
</div>
</div>
<p>Now that we have a good understanding of the structure of the data we are working with, we should identify the concepts that we are interested in. Bear in mind that the OMOP CDM is designed to be used in a wide range of contexts, and therefore the concepts that are present in a database will be specific to the context of the database.</p>
<p>Concepts are the building blocks of the OMOP CDM. They are used to represent the entities that are present in the database, and are based on clinical vocabularies. For the sake of standardization, concepts are represented by numerical IDs matched to terms in clinical vocabularies. For example, the concept “Chronic obstructive lung disease” is stored as concept ID 255573 in the OMOP CDM, and it is represented by this identifier across the whole database.</p>
<p>We can explore the concepts available in the OMOP CDM through <a href="https://athena.ohdsi.org/">Athena</a>, the central repository of standardized clinical vocabularies used in the OMOP CDM. Athena provides a web interface to search and browse concepts across different vocabularies and domains.</p>
<p>However, we can also use the <code>concepts</code> method to retrieve the concepts available in the database. This method will return a list of concept IDs present in a table, linked to the official concept name designed to it.</p>
<p>Let’s check the concepts available in the <code>condition_occurrence</code>, <code>measurement</code> and <code>observation</code> tables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>condition_list <span class="ot">&lt;-</span> helper<span class="sc">$</span><span class="fu">concepts</span>(<span class="st">"condition_occurrence"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>condition_list</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`opal-demo`
    concept_id                                                 concept_name
1        27674                                          Nausea and vomiting
2        29735                                         Candidiasis of mouth
3        31317                                                    Dysphagia
4        73553                                                  Arthropathy
5        75576                                     Irritable bowel syndrome
6        75860                                                 Constipation
7        77670                                                   Chest pain
8        78232                                          Shoulder joint pain
9        79864                                           Hematuria syndrome
10       80180                                               Osteoarthritis
11       80502                                                 Osteoporosis
12       80951                               Candidiasis of urogenital site
13       81611                                Diverticular disease of colon
14       81902                             Urinary tract infectious disease
15      132736                                                   Bacteremia
16      132797                                                       Sepsis
17      134736                                                     Backache
18      134765                                                     Cachexia
19      138384                                      Acquired hypothyroidism
20      140673                                               Hypothyroidism
21      192357                                              Paralytic ileus
22      192450                                           Retention of urine
23      192671                                  Gastrointestinal hemorrhage
24      192673                          Vascular insufficiency of intestine
25      192680                                          Portal hypertension
26      193688                           Clostridioides difficile infection
27      193782                                      End-stage renal disease
28      195306                                             Gastroduodenitis
29      195562                                                  Hemorrhoids
30      195581                                          Peritoneal adhesion
31      196236                                                 Septic shock
32      196463                                          Alcoholic cirrhosis
33      196523                                                     Diarrhea
34      197320                                          Acute kidney injury
35      197444                        Vascular complication of medical care
36      197494                                            Viral hepatitis C
37      197672                                         Urinary incontinence
38      197925                                Hemorrhage of rectum and anus
39      197950                              Cellulitis and abscess of trunk
40      198571                                            Cardiogenic shock
41      198678                                Intestinal infectious disease
42      198964                                          Chronic hepatitis C
43      199074                                           Acute pancreatitis
44      200219                                               Abdominal pain
45      200451                          Chronic passive congestion of liver
46      200528                                                      Ascites
47      200618                                          Postoperative shock
48      201061                                         Diaphragmatic hernia
49      201826                                     Type 2 diabetes mellitus
50      254061                                             Pleural effusion
51      255573                             Chronic obstructive lung disease
52      255848                                                    Pneumonia
53      259992                              Ventilator associated pneumonia
54      261600                                        Acute pulmonary edema
55      261880                                                  Atelectasis
56      313217                                          Atrial fibrillation
57      314054                                        Aortic valve disorder
58      314665                                               Atrial flutter
59      314666                                    Old myocardial infarction
60      315078                                                 Palpitations
61      315286                               Chronic ischemic heart disease
62      315831                              Chronic pulmonary heart disease
63      316135                                       Atrioventricular block
64      316139                                                Heart failure
65      317002                                           Low blood pressure
66      317003                                          Compression of vein
67      317009                                                       Asthma
68      317576                                    Coronary arteriosclerosis
69      318736                                                     Migraine
70      318772                                      Disorder of pericardium
71      318800                              Gastroesophageal reflux disease
72      319041                                      Orthostatic hypotension
73      319049                                    Acute respiratory failure
74      319835                                     Congestive heart failure
75      319843                                        Mitral valve disorder
76      319844                                 Acute ischemic heart disease
77      320128                                       Essential hypertension
78      321052                                  Peripheral vascular disease
79      321462                                         Cardiac complication
80      321887                                           Disorder of artery
81      372448                                        Loss of consciousness
82      372887                                            Disorder of brain
83      372892                                     Metabolic encephalopathy
84      373764                                         Toxic encephalopathy
85      373995                                                     Delirium
86      375519                                           Alcohol withdrawal
87      376690                                               Cerebral edema
88      376713                                          Cerebral hemorrhage
89      377091                                                      Seizure
90      378253                                                     Headache
91      380378                                                     Epilepsy
92      432545                                 Bacterial infectious disease
93      432585                                   Blood coagulation disorder
94      432867                                               Hyperlipidemia
95      432870                                    Thrombocytopenic disorder
96      432875                             Anemia due to chronic blood loss
97      432881                                                 Pancytopenia
98      433163                                 Deficiency of macronutrients
99      433736                                                      Obesity
100     433753                                                Alcohol abuse
101     433968                                                  Candidiasis
102     434004                                                 Hypervolemia
103     434056                      Late effects of cerebrovascular disease
104     434547                           Complication of surgical procedure
105     434610                                                 Hyperkalemia
106     434814        Late effect of medical and surgical care complication
107     434894                                 Acute posthemorrhagic anemia
108     435243                                           Alcohol dependence
109     435515                          Hypo-osmolality and or hyponatremia
110     435517                                                     Acidosis
111     435788                            Disorder of phosphorus metabolism
112     435796                                                  Dehydration
113     435829                             Rheumatic disease of heart valve
114     436073                                           Psychotic disorder
115     436096                                                 Chronic pain
116     436222                                        Altered mental status
117     436238 Elevated level of transaminase and lactic acid dehydrogenase
118     436659                                       Iron deficiency anemia
119     436676                                Posttraumatic stress disorder
120     436962                                                     Insomnia
121     437233                                             Multiple myeloma
122     437247                                    Anemia of chronic disease
123     437264                                  Tobacco dependence syndrome
124     437312                                                     Bleeding
125     437382                                                Urine finding
126     437390                                                    Hypoxemia
127     437474                                      Postoperative infection
128     437579                           Paroxysmal ventricular tachycardia
129     437663                                                        Fever
130     437779                             Streptococcal infectious disease
131     437827                                    Pure hypercholesterolemia
132     437833                                                  Hypokalemia
133     438064                       Bacterial infection due to Pseudomonas
134     438398                                                 Leukocytosis
135     438725                             Disorder of magnesium metabolism
136     438730                                                    Alkalosis
137     439005                              Chronic alcoholism in remission
138     439408                                          Graft complications
139     439696 Hypertensive heart and renal disease with (congestive) he...
140     439777                                                       Anemia
141     440320                            Infection due to Escherichia coli
142     440383                                          Depressive disorder
143     440424                                                      Aphasia
144     440530                                      Oropharyngeal dysphagia
145     440674                                                         Gout
146     440940        Methicillin resistant Staphylococcus aureus infection
147     441258                                 Anemia in neoplastic disease
148     441536                             Mixed acid-base balance disorder
149     441829                         Hyperosmolality and or hypernatremia
150     442019                                    Complication of procedure
151     442077                                             Anxiety disorder
152     442588                             Obstructive sleep apnea syndrome
153     443211        Benign prostatic hyperplasia with outflow obstruction
154     443238                                      Diabetic - poor control
155     443344                                          Barrett's esophagus
156     443447                                       Iatrogenic hypotension
157     443530                                                 Hematochezia
158     443597                               Chronic kidney disease stage 3
159     443612                               Chronic kidney disease stage 4
160     443734                 Ketoacidosis due to type 2 diabetes mellitus
161     444044                                       Acute tubular necrosis
162     444070                                                  Tachycardia
163     444100                                                Mood disorder
164     444101                                   Hypertensive heart failure
165     444406                              Acute subendocardial infarction
166     764123   Atherosclerosis of coronary artery without angina pectoris
167    4008576                       Diabetes mellitus without complication
168    4052648                                                   Disability
169    4064161                                           Cirrhosis of liver
170    4064452                                     ECG: atrial fibrillation
171    4065288                                          EKG: atrial flutter
172    4079687                                         Tumor lysis syndrome
173    4088998                                 AV sequential pacing pattern
174    4089488                                        Atrial pacing pattern
175    4092038                                   Ventricular pacing pattern
176    4094822                            Foreign body in respiratory tract
177    4101362                                      Finding of urine output
178    4126119                                            Toxic nephropathy
179    4138456                                       ECG: sinus bradycardia
180    4140598                                       ECG: sinus tachycardia
181    4141820                                        ECG: sinus arrhythmia
182    4144111          Gastroesophageal reflux disease without esophagitis
183    4145510                            EKG: supraventricular tachycardia
184    4145513                                            ECG: sinus rhythm
185    4150981                                              Drug resistance
186    4154290                               Paroxysmal atrial fibrillation
187    4175154                    Disorder of the peripheral nervous system
188    4182210                                                     Dementia
189    4187218                         Pneumonitis due to inhaled substance
190    4188331                                      Chronic pulmonary edema
191    4193704                Type 2 diabetes mellitus without complication
192    4209423                                          Nicotine dependence
193    4229440                             Chronic congestive heart failure
194    4232495                                       Primary cardiomyopathy
195    4233565 Severe protein-calorie malnutrition (Gomez: less than 60 ...
196    4245975                                              Hepatic failure
197    4256228                                          Respiratory failure
198    4268911                                                Disorientated
199    4270024         Acute non-ST segment elevation myocardial infarction
200    4282096                             Major depression, single episode
201    4286201                                     Schizoaffective disorder
202    4295261                                         Postmenopausal state
203    4311499              Primary malignant neoplasm of respiratory tract
204    4322175                    Late effect of complications of procedure
205    4332246                                                     Aneurysm
206    4339214                             Secondary pulmonary hypertension
207    4353709                               Intracerebral vascular finding
208   36712779                   Chronic total occlusion of coronary artery
209   36712821                                     Postprocedural infection
210   36712982 Unstable angina co-occurrent and due to coronary arterios...
211   37016114               Acute on chronic hypoxemic respiratory failure
212   37016349                Hyperglycemia due to type 2 diabetes mellitus
213   37017432               Polyneuropathy due to type 2 diabetes mellitus
214   37116361                            Accidental wound during procedure
215   37311319                                                  Hypovolemia
216   37394658                                                Severe sepsis
217   37395564                                Hypoxemic respiratory failure
218   40321716                                   Secondary thrombocytopenia
219   40479192                               Chronic systolic heart failure
220   40479576                              Chronic diastolic heart failure
221   40480602                      Acute on chronic systolic heart failure
222   40481043                     Acute on chronic diastolic heart failure
223   40481762         Hemiplegia as late effect of cerebrovascular disease
224   40481919                                     Coronary atherosclerosis
225   40482801                       Type II diabetes mellitus uncontrolled
226   40487064                               Sepsis due to Escherichia coli
227   42537730                                Coronary artery graft present
228   42537748                                    Acquired absence of organ
229   42873170                            Dependence on supplemental oxygen
230   43022062              Cardiovascular system complication of procedure
231   43530681                                      Drug abuse in remission
232   43530690                   Foot ulcer due to type 2 diabetes mellitus
233   43530742 Paralytic syndrome on one side of the body as late effect...
234   43531578       Chronic kidney disease due to type 2 diabetes mellitus
235   44782421              Acute deep venous thrombosis of upper extremity
236   44782429                   Chronic kidney disease due to hypertension
237   44784217                                           Cardiac arrhythmia
238   44784439         Benign hypertensive renal disease with renal failure
239   44784631                               Pain due to neoplastic disease
240   45757363                 Hypoglycemia due to type 2 diabetes mellitus
241   45766207       Non-rheumatic mitral valve stenosis with regurgitation
242   45768812                             Anemia in chronic kidney disease
243   45768910                                         Uncomplicated asthma
244   46271022                                       Chronic kidney disease
245   46271075                          Acute hypoxemic respiratory failure
246   46273390                                     Dependence on respirator</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>measurement_list <span class="ot">&lt;-</span> helper<span class="sc">$</span><span class="fu">concepts</span>(<span class="st">"measurement"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>measurement_list</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`opal-demo`
    concept_id                                                 concept_name
1            0                                          No matching concept
2      1175625                                      Breath rate spontaneous
3      3000067           Parathyrin.intact [Mass/volume] in Serum or Plasma
4      3000068                                oxyCODONE [Presence] in Urine
5      3000099            Nuclear Ab [Units/volume] in Serum by Immunoassay
6      3000285                               Sodium [Moles/volume] in Blood
7      3000330                      Specific gravity of Urine by Test strip
8      3000348         Leukocyte esterase [Presence] in Urine by Test strip
9      3000456           Dacrocytes [Presence] in Blood by Light microscopy
10     3000461                          Pressure support setting Ventilator
11     3000483                               Glucose [Mass/volume] in Blood
12     3000593     Cobalamin (Vitamin B12) [Mass/volume] in Serum or Plasma
13     3000764                          Benzodiazepines [Presence] in Urine
14     3000941            Linezolid [Susceptibility] by Disk diffusion (KB)
15     3000963                            Hemoglobin [Mass/volume] in Blood
16     3001122                    Ferritin [Mass/volume] in Serum or Plasma
17     3001308         Cholesterol in LDL [Moles/volume] in Serum or Plasma
18     3001318            Cholesterol.total/Cholesterol in HDL [Percentile]
19     3001494 Erythrocytes [#/volume] in Urine sediment by Microscopy h...
20     3001582                     Protein/Creatinine [Mass Ratio] in Urine
21     3001893                  Eosinophils/100 leukocytes in Pleural fluid
22     3001950             Amikacin [Susceptibility] by Disk diffusion (KB)
23     3002020                             Barbiturates [Presence] in Urine
24     3002091         Choriogonadotropin [Moles/volume] in Serum or Plasma
25     3002113  Variant lymphocytes [Presence] in Blood by Light microscopy
26     3002179                       Metamyelocytes/100 leukocytes in Blood
27     3002331                    Protein [Mass/volume] in Peritoneal fluid
28     3002400                        Iron [Mass/volume] in Serum or Plasma
29     3002827        Microalbumin/Creatinine [Mass Ratio] in 24 hour Urine
30     3002850         Tetracycline [Susceptibility] by Disk diffusion (KB)
31     3002888              Erythrocyte distribution width [Entitic volume]
32     3003105           Gentamicin [Susceptibility] by Disk diffusion (KB)
33     3003132            Barbiturates [Presence] in Serum, Plasma or Blood
34     3003181                               Sodium [Moles/volume] in Urine
35     3003282               Leukocytes [#/volume] in Blood by Manual count
36     3003396                 Base excess in Arterial blood by calculation
37     3003403                       Glucose [Mass/volume] in Pleural fluid
38     3003434                       Protein [Mass/volume] in Pleural fluid
39     3003709                  Acetaminophen [Presence] in Serum or Plasma
40     3003785         Carcinoembryonic Ag [Mass/volume] in Serum or Plasma
41     3003906            Oxacillin [Susceptibility] by Disk diffusion (KB)
42     3004249                                      Systolic blood pressure
43     3004295                         Urea nitrogen [Mass/volume] in Blood
44     3004297                                      Temperature Inhaled gas
45     3004327           Lymphocytes [#/volume] in Blood by Automated count
46     3004354            ceFAZolin [Susceptibility] by Disk diffusion (KB)
47     3004410                     Hemoglobin A1c/Hemoglobin.total in Blood
48     3004501                     Glucose [Mass/volume] in Serum or Plasma
49     3004588              Protein electrophoresis panel - Serum or Plasma
50     3004698                                     QRS duration in lead III
51     3004905        Lipase [Enzymatic activity/volume] in Serum or Plasma
52     3004921                                  Ventilation mode Ventilator
53     3005087     Macrophages/100 leukocytes in Body fluid by Manual count
54     3005131 Glucose mean value [Mass/volume] in Blood Estimated from ...
55     3005158          Clindamycin [Susceptibility] by Disk diffusion (KB)
56     3005309                    Salicylates [Presence] in Serum or Plasma
57     3005456                            Potassium [Moles/volume] in Blood
58     3005481          Spherocytes [Presence] in Blood by Light microscopy
59     3005555                              Left ventricular Cardiac output
60     3005606                     Pulmonary artery Systolic blood pressure
61     3005629                                     Inhaled oxygen flow rate
62     3005686           Bite cells [Presence] in Blood by Light microscopy
63     3005715                  Vancomycin [Mass/volume] in Serum or Plasma
64     3005719                         IgG [Mass/volume] in Serum or Plasma
65     3005854           Burr cells [Presence] in Blood by Light microscopy
66     3005897                 Protein [Mass/volume] in Urine by Test strip
67     3006122            Meropenem [Susceptibility] by Disk diffusion (KB)
68     3006135   Nucleated erythrocytes [#/volume] in Blood by Manual count
69     3006175       Mucus [Presence] in Urine sediment by Light microscopy
70     3006490 Calcium oxalate crystals [Presence] in Urine sediment by ...
71     3006923 Alanine aminotransferase [Enzymatic activity/volume] in S...
72     3007070          Cholesterol in HDL [Mass/volume] in Serum or Plasma
73     3007124   Reticulocytes/100 erythrocytes in Blood by Automated count
74     3007164                         IgA [Mass/volume] in Serum or Plasma
75     3007220 Creatine kinase [Enzymatic activity/volume] in Serum or P...
76     3007350 Amorphous sediment [Presence] in Urine sediment by Light ...
77     3007359          Bilirubin.indirect [Mass/volume] in Serum or Plasma
78     3007469                               Breath rate setting Ventilator
79     3007733                             Chloride [Moles/volume] in Urine
80     3007794                                                 P-R Interval
81     3007876                                          Appearance of Urine
82     3007913         Alveolar-arterial oxygen Partial pressure difference
83     3008223                                     Glasgow coma score motor
84     3008251                          Bicarbonate [Moles/volume] in Urine
85     3008295                                Osmolality of Serum or Plasma
86     3008308         Erythromycin [Susceptibility] by Disk diffusion (KB)
87     3008449                                 S wave amplitude in lead III
88     3008504           Vancomycin [Susceptibility] by Disk diffusion (KB)
89     3008598         Thyroxine (T4) free [Mass/volume] in Serum or Plasma
90     3008691      Amylase [Enzymatic activity/volume] in Peritoneal fluid
91     3008855          Leukocytes other/100 leukocytes in Peritoneal fluid
92     3008939    Band form neutrophils [#/volume] in Blood by Manual count
93     3009094                                    Glasgow coma score verbal
94     3009201                Thyrotropin [Units/volume] in Serum or Plasma
95     3009306         Alpha-1-Fetoprotein [Mass/volume] in Serum or Plasma
96     3009314             Cefepime [Susceptibility] by Disk diffusion (KB)
97     3009497                                              Type of GI tube
98     3009542                        Hematocrit [Volume Fraction] of Blood
99     3009613                  Erythrocytes [#/volume] in Peritoneal fluid
100    3009682                    Cortisol [Mass/volume] in Serum or Plasma
101    3009744                        MCHC [Mass/volume] by Automated count
102    3010189 Epithelial cells [#/area] in Urine sediment by Microscopy...
103    3010321                              Right eye Pupil diameter Manual
104    3010340       Triiodothyronine (T3) [Mass/volume] in Serum or Plasma
105    3010421                                                  pH of Blood
106    3010834                Platelets [#/volume] in Blood by Manual count
107    3011335                     Digoxin [Mass/volume] in Serum or Plasma
108    3011368       Poikilocytosis [Presence] in Blood by Light microscopy
109    3011397                 Hemoglobin [Presence] in Urine by Test strip
110    3011483 Granular casts [#/area] in Urine sediment by Microscopy l...
111    3011544                       Albumin [Mass/volume] in Pleural fluid
112    3011589                                 T wave amplitude in lead III
113    3011904                   Phosphate [Mass/volume] in Serum or Plasma
114    3011965                         Urea nitrogen [Mass/volume] in Urine
115    3011987        Polychromasia [Presence] in Blood by Light microscopy
116    3012030                        MCH [Entitic mass] by Automated count
117    3012095                  Magnesium [Moles/volume] in Serum or Plasma
118    3012222 Trimethoprim+Sulfamethoxazole [Susceptibility] by Disk di...
119    3012336                 Haptoglobin [Mass/volume] in Serum or Plasma
120    3012410                              Tidal volume setting Ventilator
121    3012501                          Base excess in Blood by calculation
122    3012516                               Albumin [Mass/volume] in Urine
123    3012888                                     Diastolic blood pressure
124    3012986 Erythrocytes [#/volume] in Cerebral spinal fluid by Autom...
125    3013290                   Carbon dioxide [Partial pressure] in Blood
126    3013429             Basophils [#/volume] in Blood by Automated count
127    3013466                           aPTT in Blood by Coagulation assay
128    3013502                                   Oxygen saturation in Blood
129    3013603        Prostate specific Ag [Mass/volume] in Serum or Plasma
130    3013650           Neutrophils [#/volume] in Blood by Automated count
131    3013678 Triglyceride [Mass/volume] in Serum or Plasma --12 hours ...
132    3013682               Urea nitrogen [Mass/volume] in Serum or Plasma
133    3013707          Erythrocyte sedimentation rate by Westergren method
134    3013721 Aspartate aminotransferase [Enzymatic activity/volume] in...
135    3013731 Hepatitis B virus surface Ab [Units/volume] in Serum or P...
136    3014080                       Oxygen gas flow Oxygen delivery system
137    3014576                   Chloride [Moles/volume] in Serum or Plasma
138    3014886           Neutrophils [#/volume] in Urine by Automated count
139    3015273                                         Consistency of Stool
140    3015280                   Blasts [#/volume] in Blood by Manual count
141    3015377                    Calcium [Moles/volume] in Serum or Plasma
142    3015536                          ST amplitude.J point+80 ms Lead III
143    3015862         levoFLOXacin [Susceptibility] by Disk diffusion (KB)
144    3016038                            Potassium [Moles/volume] in Urine
145    3016242 Piperacillin+Tazobactam [Susceptibility] by Disk diffusio...
146    3016251              Hemoglobin.gastrointestinal [Presence] in Stool
147    3016293                Bicarbonate [Moles/volume] in Serum or Plasma
148    3016311  Creatine kinase.MB/Creatine kinase.total in Serum or Plasma
149    3016335                               Glasgow coma score eye opening
150    3016407 Fibrinogen [Mass/volume] in Platelet poor plasma by Coagu...
151    3016502                          Oxygen saturation in Arterial blood
152    3016557 Hepatitis B virus core Ab [Units/volume] in Serum by Immu...
153    3016573 Ampicillin+Sulbactam [Susceptibility] by Disk diffusion (KB)
154    3016723                  Creatinine [Mass/volume] in Serum or Plasma
155    3016750                                 Collection duration of Urine
156    3016771       Amylase [Enzymatic activity/volume] in Serum or Plasma
157    3016879                                  Cocaine [Presence] in Urine
158    3016991              Thyroxine (T4) [Mass/volume] in Serum or Plasma
159    3017143                     Hepatitis C virus Ab [Presence] in Serum
160    3017181                           Myelocytes/100 leukocytes in Blood
161    3017188                    Pulmonary artery Diastolic blood pressure
162    3017250                            Creatinine [Mass/volume] in Urine
163    3017400                            Magnesium [Moles/volume] in Urine
164    3017594                     Tidal volume.spontaneous --on ventilator
165    3017595           Ampicillin [Susceptibility] by Disk diffusion (KB)
166    3018053                                  S wave duration in lead III
167    3018405                     Lactate [Moles/volume] in Arterial blood
168    3018465                      Oxygen saturation in Mixed venous blood
169    3018572                             Chloride [Moles/volume] in Blood
170    3018672                                             pH of Body fluid
171    3018760 Blood smear finding [Identifier] in Blood by Light micros...
172    3018834            Bilirubin.total [Presence] in Urine by Test strip
173    3018954      Choriogonadotropin (pregnancy test) [Presence] in Urine
174    3019298               Eosinophils/100 leukocytes in Peritoneal fluid
175    3019351                           QRS terminal amplitude in lead III
176    3019416         Acanthocytes [Presence] in Blood by Light microscopy
177    3019473               Protein [Mass/volume] in Cerebral spinal fluid
178    3019510 Hepatitis B virus surface Ag [Presence] in Serum or Plasm...
179    3019550                     Sodium [Moles/volume] in Serum or Plasma
180    3019634 Microscopic observation [Identifier] in Tissue by Wright ...
181    3019761  Pappenheimer bodies [Presence] in Blood by Light microscopy
182    3019800          Troponin T.cardiac [Mass/volume] in Serum or Plasma
183    3019880         Schistocytes [Presence] in Blood by Light microscopy
184    3019897    Erythrocyte distribution width [Ratio] by Automated count
185    3019977                                         pH of Arterial blood
186    3020149        25-hydroxyvitamin D3 [Mass/volume] in Serum or Plasma
187    3020153        Ciprofloxacin [Susceptibility] by Disk diffusion (KB)
188    3020416          Erythrocytes [#/volume] in Blood by Automated count
189    3020460          C reactive protein [Mass/volume] in Serum or Plasma
190    3020481                                           Respiration rhythm
191    3020630                     Protein [Mass/volume] in Serum or Plasma
192    3020716                                 Inhaled oxygen concentration
193    3020891                                             Body temperature
194    3021044       Iron binding capacity [Mass/volume] in Serum or Plasma
195    3021119                      Calcium.ionized [Moles/volume] in Blood
196    3021200 Thyroglobulin Ab [Units/volume] in Serum by Radioimmunoas...
197    3021303          Hypochromia [Presence] in Blood by Light microscopy
198    3021453                     Eosinophils/100 leukocytes in Body fluid
199    3021502           Macrocytes [Presence] in Blood by Light microscopy
200    3021595                      Phenytoin [Presence] in Serum or Plasma
201    3021601                    Nitrite [Presence] in Urine by Test strip
202    3021886                              Globulin [Mass/volume] in Serum
203    3022022                                                 QRS duration
204    3022094           Tobramycin [Susceptibility] by Disk diffusion (KB)
205    3022217             INR in Platelet poor plasma by Coagulation assay
206    3022318                                            Heart rate rhythm
207    3022509 Hyaline casts [#/area] in Urine sediment by Microscopy lo...
208    3022548               Glucose [Mass/volume] in Cerebral spinal fluid
209    3022621                                    pH of Urine by Test strip
210    3022747          cefTRIAXone [Susceptibility] by Disk diffusion (KB)
211    3022797                                 R wave amplitude in lead III
212    3022875          Positive end expiratory pressure setting Ventilator
213    3023103                  Potassium [Moles/volume] in Serum or Plasma
214    3023307         Penicillin G [Susceptibility] by Disk diffusion (KB)
215    3023314     Hematocrit [Volume Fraction] of Blood by Automated count
216    3023520                            Reticulocytes [#/volume] in Blood
217    3023539                 Ketones [Mass/volume] in Urine by Test strip
218    3023547                Leukocytes other/100 leukocytes in Body fluid
219    3023599                      MCV [Entitic volume] by Automated count
220    3024128             Bilirubin.total [Mass/volume] in Serum or Plasma
221    3024153            Promyelocytes [#/volume] in Blood by Manual count
222    3024171                                             Respiratory rate
223    3024561                     Albumin [Mass/volume] in Serum or Plasma
224    3024629                 Glucose [Mass/volume] in Urine by Test strip
225    3024882        Oxygen/Total gas setting [Volume Fraction] Ventilator
226    3024929             Platelets [#/volume] in Blood by Automated count
227    3025019                           Gas flow Respiratory system airway
228    3025255 Bacteria [#/area] in Urine sediment by Microscopy high po...
229    3025315                                                  Body weight
230    3025439 Airway pressure Ventilator --at peak inspiratory flow max...
231    3025478      Tricyclic antidepressants [Presence] in Serum or Plasma
232    3025616         Target cells [Presence] in Blood by Light microscopy
233    3025809                                                 Q-T interval
234    3026256                            QRS initial amplitude in lead III
235    3026258                                       Q-T interval corrected
236    3026314         Anisocytosis [Presence] in Blood by Light microscopy
237    3026400                        Ethanol [Presence] in Serum or Plasma
238    3026611                               Left eye Pupil diameter Manual
239    3026692                    Albumin [Mass/volume] in Peritoneal fluid
240    3026729                             Phosphate [Mass/volume] in Urine
241    3026782                                          Osmolality of Urine
242    3026904 Basophilic stippling [Presence] in Blood by Light microscopy
243    3026910 Gamma glutamyl transferase [Enzymatic activity/volume] in...
244    3027008                                  Opiates [Presence] in Urine
245    3027018                                                   Heart rate
246    3027114                 Cholesterol [Mass/volume] in Serum or Plasma
247    3027162                                               Color of Urine
248    3027315                           Oxygen [Partial pressure] in Blood
249    3027597            Bilirubin.direct [Mass/volume] in Serum or Plasma
250    3027598                                          Mean blood pressure
251    3027801                  Oxygen [Partial pressure] in Arterial blood
252    3027920           Ovalocytes [Presence] in Blood by Light microscopy
253    3027944                             Amphetamines [Presence] in Urine
254    3027946          Carbon dioxide [Partial pressure] in Arterial blood
255    3028026                         IgM [Mass/volume] in Serum or Plasma
256    3028074                         Pulmonary artery Mean blood pressure
257    3028308                     Erythrocytes [#/volume] in Pleural fluid
258    3028437          Cholesterol in LDL [Mass/volume] in Serum or Plasma
259    3028468            Fragments [Presence] in Blood by Light microscopy
260    3028561                                  R wave duration in lead III
261    3028615           Eosinophils [#/volume] in Blood by Automated count
262    3028662 Hepatitis A virus Ab [Units/volume] in Serum or Plasma by...
263    3029187 Natriuretic peptide.B prohormone N-Terminal [Mass/volume]...
264    3031147 Carbon dioxide, total [Moles/volume] in Blood by calculation
265    3031951                          Benzodiazepines [Presence] in Blood
266    3033364                   Cholesterol [Mass/volume] in Pleural fluid
267    3033483                 Monocytes/100 leukocytes in Peritoneal fluid
268    3033575             Monocytes [#/volume] in Blood by Automated count
269    3034426                                        Prothrombin time (PT)
270    3035206                               Physical mobility Braden scale
271    3035359                          ST amplitude.J point+60 ms Lead III
272    3035583 Leukocytes [#/area] in Urine sediment by Microscopy high ...
273    3035816                        Nutrition intake pattern Braden scale
274    3035851 Transitional cells [#/area] in Urine sediment by Microsco...
275    3035995 Alkaline phosphatase [Enzymatic activity/volume] in Serum...
276    3036098                              Sensory perception Braden scale
277    3036180                                Methadone [Presence] in Urine
278    3036277                                                  Body height
279    3036354         Leukocytes other [#/volume] in Blood by Manual count
280    3036518                               Left ventricular Stroke volume
281    3036987                      Folate [Mass/volume] in Serum or Plasma
282    3037022                               Moisture exposure Braden scale
283    3037153             rifAMPin [Susceptibility] by Disk diffusion (KB)
284    3037185                                  Protein [Presence] in Urine
285    3037244 Yeast [#/area] in Urine sediment by Microscopy high power...
286    3037274    HIV 1 Ab [Units/volume] in Serum or Plasma by Immunoassay
287    3037278                               Anion gap 4 in Serum or Plasma
288    3037318                               Physical activity Braden scale
289    3037347                              Friction and shear Braden scale
290    3037426               Urobilinogen [Presence] in Urine by Test strip
291    3037490                                               Color of Stool
292    3037556                       Urate [Mass/volume] in Serum or Plasma
293    3037577            Monocytes/100 leukocytes in Cerebral spinal fluid
294    3037663 Carbon dioxide, total [Moles/volume] in Arterial blood by...
295    3037871 Macrophages/100 leukocytes in Cerebral spinal fluid by Ma...
296    3037885           Microcytes [Presence] in Blood by Light microscopy
297    3038047       Nitrofurantoin [Susceptibility] by Disk diffusion (KB)
298    3038086          cefTAZidime [Susceptibility] by Disk diffusion (KB)
299    3038104                       Monocytes/100 leukocytes in Body fluid
300    3038288 Influenza virus B RNA [Presence] in Specimen by NAA with ...
301    3039000                                           Anion gap in Blood
302    3040168                    Immature granulocytes [#/volume] in Blood
303    3041079 Nucleated cells [#/volume] in Pleural fluid by Automated ...
304    3041372 Nucleated cells [#/volume] in Cerebral spinal fluid by Au...
305    3041408 Nucleated cells [#/volume] in Peritoneal fluid by Automat...
306    3041635 Macrophages/100 leukocytes in Peritoneal fluid by Manual ...
307    3042347                                           Dressing for Wound
308    3043387                    Monocytes/100 leukocytes in Pleural fluid
309    3043728   WBC casts [Presence] in Urine sediment by Light microscopy
310    3043970                                                Color of Skin
311    3044938 Influenza virus A RNA [Presence] in Specimen by NAA with ...
312    3046838                                                   Edema site
313    3047181                              Lactate [Moles/volume] in Blood
314    3051714     Fibrin D-dimer FEU [Mass/volume] in Platelet poor plasma
315    4024509                                                Urine culture
316    4024510                                Microbial culture, body fluid
317    4035228                                Respiratory microbial culture
318    4036044                                  Anaerobic microbial culture
319    4107893                                                Blood culture
320    4165398                                             Mycology culture
321    4189544                                            Microbial culture
322    4247906                                  Clostridium difficile assay
323    4265595                                  Creatine kinase measurement
324    4300293                                               Tissue culture
325   21490516                        Inspiration [Time] Respiratory system
326   21490580       Carbon dioxide production (VCO2) in Respiratory system
327   21490650  Pressure max Respiratory system airway --during inspiration
328   21490675                                Central venous pressure (CVP)
329   21490712                               Left ventricular Cardiac index
330   21490753                 Volume expired per minute Respiratory system
331   21490854                      Tidal volume Ventilator --on ventilator
332   21490880                         Left ventricular Stroke volume index
333   21490888                               PCA lockout time Infusion pump
334   21490963                               Right pupil Pupillary response
335   21491186                                   Endotracheal tube Diameter
336   21491763                                Left pupil Pupillary response
337   21492239                       Systolic blood pressure by Noninvasive
338   21492240                      Diastolic blood pressure by Noninvasive
339   21492241                           Mean blood pressure by Noninvasive
340   21492838                                               Skin integrity
341   21494965                                               Passing flatus
342   21494966                    Physical findings of Abdomen by Palpation
343   36203862                                              Color of Sputum
344   36303946   Pressure.plateau Respiratory system airway --on ventilator
345   36684829                            Richmond Agitation-Sedation Scale
346   40760766       Tidal volume.inspired maximum setting Ventilator alarm
347   40762499        Oxygen saturation in Arterial blood by Pulse oximetry
348   40762903                              Apnea interval Ventilator alarm
349   40763080 Lactate dehydrogenase [Enzymatic activity/volume] in Peri...
350   42527086                                         Mean airway pressure
351   42527140                                Total PEEP Respiratory system
352   43055270                                           Wound closure type
353   46236952 Glomerular filtration rate/1.73 sq M.predicted [Volume Ra...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>observation_list <span class="ot">&lt;-</span> helper<span class="sc">$</span><span class="fu">concepts</span>(<span class="st">"observation"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>observation_list</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`opal-demo`
   concept_id                                                 concept_name
1      432789                            Opioid analgesic adverse reaction
2      433942                 Accident while engaged in household activity
3      435928                                         Abnormal weight loss
4      436583                                                         Fall
5      438046 Medical accident to patient during surgical and medical care
6      439996                               Anticoagulant adverse reaction
7      440279                                                     Accident
8      440922                                          Diabetic on insulin
9      440927                             High risk drug monitoring status
10     441207                                     Adverse reaction to drug
11     441749                              Fall on or from stairs or steps
12    2617452                       Hospital observation service, per hour
13    3001062                                      History of Past illness
14    3007397                                              Ventilator type
15    3012697                                       History of Tobacco use
16    3024265                            Body temperature measurement site
17    3034263                                     Pain severity - Reported
18    3039006                                              Oral care given
19    4005823                                                 Tobacco user
20    4014023                                              Palliative care
21    4019967                                 Dependence on renal dialysis
22    4036936                                              Oxygen delivery
23    4060705                           Body mass index 25-29 - overweight
24    4060985                                Body mass index 30+ - obesity
25    4119499                                        Not for resuscitation
26    4127294                                         Resuscitation status
27    4135421                               Body mass index 20-24 - normal
28    4138763                                 Acceptable pain level status
29    4139934                                                     Homeless
30    4140830                                           Fall on same level
31    4143274                           History of cerebrovascular disease
32    4148407                                   FH: Cardiovascular disease
33    4162219       Patient transfer to postoperative anesthesia care unit
34    4167217                           Family history of clinical finding
35    4179242                        History of malignant neoplasm of skin
36    4180749                    History of malignant neoplasm of prostate
37    4182335                     Family history of ischemic heart disease
38    4192791                                  Pain management (specialty)
39    4203722                                  Patient encounter procedure
40    4214956                       History of clinical finding in subject
41    4215685                                    Past history of procedure
42    4233464                           Legal physical restraint performed
43    4256640                         Body mass index 40+ - severely obese
44    4265599                      Patient transfer to intensive care unit
45    4276526                                             Cigarette smoker
46    4279614                                                 Asphyxiation
47    4296248                                             Cost containment
48    4311079       Place of occurrence of accident or poisoning, hospital
49    4314870                 Place of occurrence of accident or poisoning
50    4323345                                              History of fall
51    4324190                      History of malignant neoplasm of breast
52    4337265                                                 Bowel sounds
53   21492835                                           Respiratory effort
54   36717001                             Long-term current use of aspirin
55   37116693                                      Stroke volume variation
56   40479553                                    Cardiac pacemaker in situ
57   40757693                          Indicators of pain or possible pain
58   40758030                                           Preferred language
59   40766231                                      Marital status [NHANES]
60   46235654                                            Primary insurance
61   46272450                        Long-term current use of drug therapy
62   46272451                             Long-term current use of insulin
63   46272666                            Coordination of family conference
64   46273928                                         Liaising with family
65   46273937                       Long-term current use of anticoagulant
66   46274064                       History of antineoplastic chemotherapy</code></pre>
</div>
</div>
<p>These serve as concept catalogs for each table. We can explore them to identify the concepts that are present in the database.</p>
<p>For example, as an exercise, let’s find the concept IDs for:</p>
<ul>
<li>Systolic blood pressure</li>
<li>Marital status</li>
</ul>
<p><strong>Note:</strong> For convenience, we can save these concept catalogs as files for easy reference, sharing with collaborators, and future consultation. For example, we can save them as CSV files:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data directory if it doesn't exist</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">"data"</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the concept catalogs as CSV files</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(condition_list, <span class="at">file =</span> <span class="st">"data/condition_list.csv"</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(measurement_list, <span class="at">file =</span> <span class="st">"data/measurement_list.csv"</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(observation_list, <span class="at">file =</span> <span class="st">"data/observation_list.csv"</span>)</span></code></pre></div>
</div>
<p><strong>Did you find the concepts that we are looking for?</strong></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Let’s search for these concepts in our catalogs:</p>
<ol type="1">
<li><strong>Systolic blood pressure</strong>: 3004249
<ul>
<li>Found in Measurement</li>
<li>Concept name: Systolic blood pressure</li>
</ul></li>
<li><strong>Marital status</strong>: 40766231
<ul>
<li>Found in Observation</li>
<li>Concept name: Marital status [NHANES]</li>
</ul></li>
</ol>
</div>
</div>
</div>
</section>
<section id="data-retrieval" class="level1">
<h1>Data retrieval</h1>
<p>We have identified the concepts that we are interested in. Now it is time to retrieve data from the OMOP database.</p>
<p>Bear in mind that we do not usually want to retrieve all the columns related to a concept. You should check the columns of the <code>condition_occurrence</code>, <code>measurement</code> and <code>observation</code> tables to identify the columns that are relevant to our analysis.</p>
<p>For example, let’s say that we want to obtain the numerical value of the systolic blood pressure. We can check again the columns available in the <code>measurement</code> table:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>helper<span class="sc">$</span><span class="fu">columns</span>(<span class="st">"measurement"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`opal-demo`
$`opal-demo`$measurement
 [1] "measurement_id"                "person_id"                    
 [3] "measurement_concept_id"        "measurement_date"             
 [5] "measurement_datetime"          "measurement_time"             
 [7] "measurement_type_concept_id"   "operator_concept_id"          
 [9] "value_as_number"               "value_as_concept_id"          
[11] "unit_concept_id"               "range_low"                    
[13] "range_high"                    "provider_id"                  
[15] "visit_occurrence_id"           "visit_detail_id"              
[17] "measurement_source_value"      "measurement_source_concept_id"
[19] "unit_source_value"             "value_source_value"           </code></pre>
</div>
</div>
<p>We can see that the <code>measurement</code> table contains the <code>value_as_number</code> column, which contains the numerical value of the measurement.</p>
<p>This means that we want to:</p>
<ul>
<li>From the <code>measurement</code> table,</li>
<li>get the systolic blood pressure (whose concept ID is <code>3004249</code>),</li>
<li>taking only the <code>value_as_number</code> column</li>
</ul>
<p>We can retrieve this data using the <code>auto</code> method of the <code>helper</code> interface object. This method automates the process of retrieving the data from the database and storing it in the <code>mimiciv</code> table:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>helper<span class="sc">$</span><span class="fu">auto</span>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">table =</span> <span class="st">"measurement"</span>,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">concepts =</span> <span class="dv">3004249</span>,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="st">"value_as_number"</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<p>The data should have been stored in the <code>mimiciv</code> table. <code>dsOMOP</code> automatically translantes the concept IDs to their designated textual names for readability. This means that the column name will be the concept name, followed by the column name of the table (<code>systolic_blood_pressure.value_as_number</code>). We can check the current state of the <code>mimiciv</code> table in the server side at any time using the <code>ds.summary</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.summary</span>(<span class="st">"mimiciv"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`opal-demo`
$`opal-demo`$class
[1] "data.frame"

$`opal-demo`$`number of rows`
[1] 100

$`opal-demo`$`number of columns`
[1] 6

$`opal-demo`$`variables held`
[1] "person_id"                              
[2] "gender_concept_id"                      
[3] "year_of_birth"                          
[4] "race_concept_id"                        
[5] "ethnicity_concept_id"                   
[6] "systolic_blood_pressure.value_as_number"</code></pre>
</div>
</div>
<p>As we can see, the <code>mimiciv</code> table now contains the <code>systolic_blood_pressure.value_as_number</code> column, which contains the numerical value of the systolic blood pressure. Let’s check a summary of this data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.summary</span>(<span class="st">"mimiciv$systolic_blood_pressure.value_as_number"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`opal-demo`
$`opal-demo`$class
[1] "numeric"

$`opal-demo`$length
[1] 100

$`opal-demo`$`quantiles &amp; mean`
      5%      10%      25%      50%      75%      90%      95%     Mean 
 76.0000  94.4000 106.2500 116.5000 128.2500 143.9000 146.1500 116.0172 </code></pre>
</div>
</div>
<p>Let’s now use the <code>renameVars</code> from the <code>dsHelper</code> package, which we have seen before, to rename the variable to <code>sbp</code> for convenience:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dh.renameVars</span>(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">df =</span> <span class="st">"mimiciv"</span>, </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">current_names =</span> <span class="fu">c</span>(<span class="st">"systolic_blood_pressure.value_as_number"</span>),</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">new_names =</span> <span class="fu">c</span>(<span class="st">"sbp"</span>))</span></code></pre></div>
</div>
<p>Let’s check whether the changes have been applied by listing the columns of the <code>mimiciv</code> table:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.colnames</span>(<span class="st">"mimiciv"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`opal-demo`
[1] "person_id"            "gender_concept_id"    "year_of_birth"       
[4] "race_concept_id"      "ethnicity_concept_id" "sbp"                 </code></pre>
</div>
</div>
<p>From this point, the data we have incorporated into the <code>mimiciv</code> table is ready to be used in our analysis as any other dataframe in DataSHIELD. To illustrate this, let’s perform a <code>ds.histogram</code> to visualize the distribution of the systolic blood pressure:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.histogram</span>(<span class="st">"mimiciv$sbp"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="dsomop_files/figure-html/histogram_sbp-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$breaks
 [1]  68.13968  76.69465  85.24963  93.80460 102.35958 110.91455 119.46952
 [8] 128.02450 136.57947 145.13445 153.68942

$counts
 [1]  4  0  0  5 11 14  7  5  4  6

$density
 [1] 0.008061452 0.000000000 0.000000000 0.010076815 0.022168993 0.028215082
 [7] 0.014107541 0.010076815 0.008061452 0.012092178

$mids
 [1]  72.41716  80.97214  89.52711  98.08209 106.63706 115.19204 123.74701
 [8] 132.30199 140.85696 149.41194

$xname
[1] "xvect"

$equidist
[1] TRUE

attr(,"class")
[1] "histogram"</code></pre>
</div>
</div>
<p>Let’s now retrieve the data for the concept <code>Marital status [NHANES]</code>. Let’s start by checking the columns available in the <code>observation</code> table:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>helper<span class="sc">$</span><span class="fu">columns</span>(<span class="st">"observation"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`opal-demo`
$`opal-demo`$observation
 [1] "observation_id"                "person_id"                    
 [3] "observation_concept_id"        "observation_date"             
 [5] "observation_datetime"          "observation_type_concept_id"  
 [7] "value_as_number"               "value_as_string"              
 [9] "value_as_concept_id"           "qualifier_concept_id"         
[11] "unit_concept_id"               "provider_id"                  
[13] "visit_occurrence_id"           "visit_detail_id"              
[15] "observation_source_value"      "observation_source_concept_id"
[17] "unit_source_value"             "qualifier_source_value"       </code></pre>
</div>
</div>
<p>In this case, the <code>observation</code> table contains the <code>value_as_concept_id</code> column, which contains the concept ID of the observation value (which will be translated to the textual concept name by <code>dsOMOP</code>).</p>
<p>Let’s use the <code>auto</code> method to retrieve it:</p>
<ul>
<li>From the <code>observation</code> table,</li>
<li>get the marital status (whose concept ID is <code>40766231</code>),</li>
<li>taking only the <code>value_as_concept_id</code> column</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>helper<span class="sc">$</span><span class="fu">auto</span>(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">table =</span> <span class="st">"observation"</span>,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">concepts =</span> <span class="dv">40766231</span>,</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="st">"value_as_concept_id"</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<p>We should now have the <code>marital_status_nhanes.value_as_concept_id</code> column in the <code>mimiciv</code> table. Let’s check the current state of the <code>mimiciv</code> table in the server side at any time using the <code>ds.summary</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.summary</span>(<span class="st">"mimiciv"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`opal-demo`
$`opal-demo`$class
[1] "data.frame"

$`opal-demo`$`number of rows`
[1] 100

$`opal-demo`$`number of columns`
[1] 7

$`opal-demo`$`variables held`
[1] "person_id"                                
[2] "gender_concept_id"                        
[3] "year_of_birth"                            
[4] "race_concept_id"                          
[5] "ethnicity_concept_id"                     
[6] "sbp"                                      
[7] "marital_status_nhanes.value_as_concept_id"</code></pre>
</div>
</div>
<p>The <code>mimiciv</code> table now contains the <code>marital_status_nhanes.value_as_concept_id</code> column. Let’s see a summary of this data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.summary</span>(<span class="st">"mimiciv$marital_status_nhanes.value_as_concept_id"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`opal-demo`
$`opal-demo`$class
[1] "factor"

$`opal-demo`$length
[1] 100

$`opal-demo`$categories
[1] "divorced"      "married"       "never_married" "widowed"      

$`opal-demo`$`count of 'divorced'`
[1] 10

$`opal-demo`$`count of 'married'`
[1] 36

$`opal-demo`$`count of 'never_married'`
[1] 30

$`opal-demo`$`count of 'widowed'`
[1] 12</code></pre>
</div>
</div>
<p>As we can observe, the <code>marital_status_nhanes.value_as_concept_id</code> column contains the following categories:</p>
<ul>
<li><code>divorced</code></li>
<li><code>married</code></li>
<li><code>never married</code></li>
<li><code>widowed</code></li>
</ul>
<p>Those were originally numerical concept IDs in the database, but <code>dsOMOP</code> automatically translated them to their textual names.</p>
</section>
<section id="subsetting-data" class="level1">
<h1>Subsetting data</h1>
<p>Another fundamental operation in the dataset construction process that may be required for specific research contexts is subsetting. It is used to filter tables based on specific criteria, such as gender, age, conditions, measurements, observations or other characteristics. This operation can be used to determine a specific cohort of individuals, since all the data that is going to be retrieved from the database from that point will be related to the remaining individuals in the <code>person</code> table.</p>
<p>Let’s see with a simple example how we can filter, using the subset operation, a dataset to only include women patients. But first, <strong>where do we find the gender data?</strong></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The gender data is part of the <code>person</code> table under the <code>gender_concept_id</code> column, which was automatically retrieved when we created the <code>helper</code> interface object. This means that it is already available in the <code>mimiciv</code> table under <code>mimiciv$gender_concept_id</code>.</p>
</div>
</div>
</div>
<p>Let’s first check that this variable is indeed available in the <code>mimiciv</code> table:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.colnames</span>(<span class="st">"mimiciv"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`opal-demo`
[1] "person_id"                                
[2] "gender_concept_id"                        
[3] "year_of_birth"                            
[4] "race_concept_id"                          
[5] "ethnicity_concept_id"                     
[6] "sbp"                                      
[7] "marital_status_nhanes.value_as_concept_id"</code></pre>
</div>
</div>
<p>Let’s also check a summary of this variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.summary</span>(<span class="st">"mimiciv$gender_concept_id"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`opal-demo`
$`opal-demo`$class
[1] "factor"

$`opal-demo`$length
[1] 100

$`opal-demo`$categories
[1] "female" "male"  

$`opal-demo`$`count of 'female'`
[1] 43

$`opal-demo`$`count of 'male'`
[1] 57</code></pre>
</div>
</div>
<p>As we can observe, the <code>gender_concept_id</code> column contains the following categories:</p>
<ul>
<li><code>female</code></li>
<li><code>male</code></li>
</ul>
<p>Those were also numerical concept IDs in the database that were matched to their corresponding concept names by <code>dsOMOP</code>.</p>
<p>Let’s start by renaming the <code>gender_concept_id</code> column to <code>gender</code> for convenience:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dh.renameVars</span>(</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">df =</span> <span class="st">"mimiciv"</span>, </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">current_names =</span> <span class="fu">c</span>(<span class="st">"gender_concept_id"</span>),</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">new_names =</span> <span class="fu">c</span>(<span class="st">"gender"</span>))</span></code></pre></div>
</div>
<p>From this point on, all the data is already in the DataSHIELD environment, so we will use DataSHIELD’s standard methods to perform the filtering.</p>
<p>In DataSHIELD, we first need to create a filter object in the server side that contains the value we want to filter by. Let’s create a <code>gender_filter</code> object that contains the value <code>"female"</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.make</span>(<span class="at">newobj =</span> <span class="st">"gender_filter"</span>, <span class="at">toAssign =</span> <span class="st">"c('female')"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$is.object.created
[1] "A data object &lt;gender_filter&gt; has been created in all specified data sources"

$validity.check
[1] "&lt;gender_filter&gt; appears valid in all sources"</code></pre>
</div>
</div>
<p>Now we can use the <code>ds.dataFrameSubset</code> function to filter the <code>mimiciv</code> table to only include female patients by passing the <code>gender_filter</code> object as a parameter with the <code>Boolean.operator</code> parameter set to <code>"=="</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.dataFrameSubset</span>(</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">df.name =</span> <span class="st">"mimiciv"</span>,</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">V1.name =</span> <span class="st">"mimiciv$gender"</span>,</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">V2.name =</span> <span class="st">"gender_filter"</span>,</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Boolean.operator =</span> <span class="st">"=="</span>,</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">newobj =</span> <span class="st">"mimiciv"</span>,</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">datasources =</span> conns,</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">notify.of.progress =</span> <span class="cn">FALSE</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$is.object.created
[1] "A data object &lt;mimiciv&gt; has been created in all specified data sources"

$validity.check
[1] "&lt;mimiciv&gt; appears valid in all sources"</code></pre>
</div>
</div>
<p>This will override the <code>mimiciv</code> table in the server side, which will now be the same table but only containing the female patients. Let’s check if this is the case:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.summary</span>(<span class="st">"mimiciv$gender"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`opal-demo`
$`opal-demo`$class
[1] "factor"

$`opal-demo`$length
[1] 43

$`opal-demo`$categories
[1] "female" "male"  

$`opal-demo`$`count of 'female'`
[1] 43

$`opal-demo`$`count of 'male'`
[1] 0</code></pre>
</div>
</div>
<p>As we can see, the <code>mimiciv</code> table contains only female patients now. If we were to retrieve any other data from the database with the <code>auto</code> method, it would only be related to the female patients from this point on.</p>
</section>
<section id="more-advanced-operations" class="level1">
<h1>More advanced operations</h1>
<p>Let’s now perform a more advanced operation. We want to study the relationship between <strong>chronic obstructive pulmonary disease (COPD)</strong> and two key biomarkers: <strong>tobacco use</strong> and <strong>asthma</strong>, so we will perform a <strong>generalized linear model (GLM)</strong> to estimate the odds ratio (OR) of COPD for each biomarker.</p>
<p>We start by creating a new <code>helper</code> interface object where we will retrieve the specified data. Since we are not going to use the <code>helper</code> object and the <code>mimiciv</code> table from the previous section anymore, we will create new objects with the same name:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>helper <span class="ot">&lt;-</span> <span class="fu">ds.omop.helper</span>(</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">connections =</span> conns,</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">resource =</span> <span class="st">"omop_demo.mimiciv"</span>, </span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">symbol =</span> <span class="st">"mimiciv"</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<p>As we can see, the <code>mimiciv</code> table now only contains the initial <code>person</code> table again:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.summary</span>(<span class="st">"mimiciv"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`opal-demo`
$`opal-demo`$class
[1] "data.frame"

$`opal-demo`$`number of rows`
[1] 100

$`opal-demo`$`number of columns`
[1] 5

$`opal-demo`$`variables held`
[1] "person_id"            "gender_concept_id"    "year_of_birth"       
[4] "race_concept_id"      "ethnicity_concept_id"</code></pre>
</div>
</div>
<p>And we have restored all the patients that were in the <code>mimiciv</code> table from the previous section, not just the female patients:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.summary</span>(<span class="st">"mimiciv$gender_concept_id"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`opal-demo`
$`opal-demo`$class
[1] "factor"

$`opal-demo`$length
[1] 100

$`opal-demo`$categories
[1] "female" "male"  

$`opal-demo`$`count of 'female'`
[1] 43

$`opal-demo`$`count of 'male'`
[1] 57</code></pre>
</div>
</div>
<p>We can now use the concept catalogs that we retrieved earlier to identify the concept IDs for COPD, tobacco use and asthma:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>condition_list</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`opal-demo`
    concept_id                                                 concept_name
1        27674                                          Nausea and vomiting
2        29735                                         Candidiasis of mouth
3        31317                                                    Dysphagia
4        73553                                                  Arthropathy
5        75576                                     Irritable bowel syndrome
6        75860                                                 Constipation
7        77670                                                   Chest pain
8        78232                                          Shoulder joint pain
9        79864                                           Hematuria syndrome
10       80180                                               Osteoarthritis
11       80502                                                 Osteoporosis
12       80951                               Candidiasis of urogenital site
13       81611                                Diverticular disease of colon
14       81902                             Urinary tract infectious disease
15      132736                                                   Bacteremia
16      132797                                                       Sepsis
17      134736                                                     Backache
18      134765                                                     Cachexia
19      138384                                      Acquired hypothyroidism
20      140673                                               Hypothyroidism
21      192357                                              Paralytic ileus
22      192450                                           Retention of urine
23      192671                                  Gastrointestinal hemorrhage
24      192673                          Vascular insufficiency of intestine
25      192680                                          Portal hypertension
26      193688                           Clostridioides difficile infection
27      193782                                      End-stage renal disease
28      195306                                             Gastroduodenitis
29      195562                                                  Hemorrhoids
30      195581                                          Peritoneal adhesion
31      196236                                                 Septic shock
32      196463                                          Alcoholic cirrhosis
33      196523                                                     Diarrhea
34      197320                                          Acute kidney injury
35      197444                        Vascular complication of medical care
36      197494                                            Viral hepatitis C
37      197672                                         Urinary incontinence
38      197925                                Hemorrhage of rectum and anus
39      197950                              Cellulitis and abscess of trunk
40      198571                                            Cardiogenic shock
41      198678                                Intestinal infectious disease
42      198964                                          Chronic hepatitis C
43      199074                                           Acute pancreatitis
44      200219                                               Abdominal pain
45      200451                          Chronic passive congestion of liver
46      200528                                                      Ascites
47      200618                                          Postoperative shock
48      201061                                         Diaphragmatic hernia
49      201826                                     Type 2 diabetes mellitus
50      254061                                             Pleural effusion
51      255573                             Chronic obstructive lung disease
52      255848                                                    Pneumonia
53      259992                              Ventilator associated pneumonia
54      261600                                        Acute pulmonary edema
55      261880                                                  Atelectasis
56      313217                                          Atrial fibrillation
57      314054                                        Aortic valve disorder
58      314665                                               Atrial flutter
59      314666                                    Old myocardial infarction
60      315078                                                 Palpitations
61      315286                               Chronic ischemic heart disease
62      315831                              Chronic pulmonary heart disease
63      316135                                       Atrioventricular block
64      316139                                                Heart failure
65      317002                                           Low blood pressure
66      317003                                          Compression of vein
67      317009                                                       Asthma
68      317576                                    Coronary arteriosclerosis
69      318736                                                     Migraine
70      318772                                      Disorder of pericardium
71      318800                              Gastroesophageal reflux disease
72      319041                                      Orthostatic hypotension
73      319049                                    Acute respiratory failure
74      319835                                     Congestive heart failure
75      319843                                        Mitral valve disorder
76      319844                                 Acute ischemic heart disease
77      320128                                       Essential hypertension
78      321052                                  Peripheral vascular disease
79      321462                                         Cardiac complication
80      321887                                           Disorder of artery
81      372448                                        Loss of consciousness
82      372887                                            Disorder of brain
83      372892                                     Metabolic encephalopathy
84      373764                                         Toxic encephalopathy
85      373995                                                     Delirium
86      375519                                           Alcohol withdrawal
87      376690                                               Cerebral edema
88      376713                                          Cerebral hemorrhage
89      377091                                                      Seizure
90      378253                                                     Headache
91      380378                                                     Epilepsy
92      432545                                 Bacterial infectious disease
93      432585                                   Blood coagulation disorder
94      432867                                               Hyperlipidemia
95      432870                                    Thrombocytopenic disorder
96      432875                             Anemia due to chronic blood loss
97      432881                                                 Pancytopenia
98      433163                                 Deficiency of macronutrients
99      433736                                                      Obesity
100     433753                                                Alcohol abuse
101     433968                                                  Candidiasis
102     434004                                                 Hypervolemia
103     434056                      Late effects of cerebrovascular disease
104     434547                           Complication of surgical procedure
105     434610                                                 Hyperkalemia
106     434814        Late effect of medical and surgical care complication
107     434894                                 Acute posthemorrhagic anemia
108     435243                                           Alcohol dependence
109     435515                          Hypo-osmolality and or hyponatremia
110     435517                                                     Acidosis
111     435788                            Disorder of phosphorus metabolism
112     435796                                                  Dehydration
113     435829                             Rheumatic disease of heart valve
114     436073                                           Psychotic disorder
115     436096                                                 Chronic pain
116     436222                                        Altered mental status
117     436238 Elevated level of transaminase and lactic acid dehydrogenase
118     436659                                       Iron deficiency anemia
119     436676                                Posttraumatic stress disorder
120     436962                                                     Insomnia
121     437233                                             Multiple myeloma
122     437247                                    Anemia of chronic disease
123     437264                                  Tobacco dependence syndrome
124     437312                                                     Bleeding
125     437382                                                Urine finding
126     437390                                                    Hypoxemia
127     437474                                      Postoperative infection
128     437579                           Paroxysmal ventricular tachycardia
129     437663                                                        Fever
130     437779                             Streptococcal infectious disease
131     437827                                    Pure hypercholesterolemia
132     437833                                                  Hypokalemia
133     438064                       Bacterial infection due to Pseudomonas
134     438398                                                 Leukocytosis
135     438725                             Disorder of magnesium metabolism
136     438730                                                    Alkalosis
137     439005                              Chronic alcoholism in remission
138     439408                                          Graft complications
139     439696 Hypertensive heart and renal disease with (congestive) he...
140     439777                                                       Anemia
141     440320                            Infection due to Escherichia coli
142     440383                                          Depressive disorder
143     440424                                                      Aphasia
144     440530                                      Oropharyngeal dysphagia
145     440674                                                         Gout
146     440940        Methicillin resistant Staphylococcus aureus infection
147     441258                                 Anemia in neoplastic disease
148     441536                             Mixed acid-base balance disorder
149     441829                         Hyperosmolality and or hypernatremia
150     442019                                    Complication of procedure
151     442077                                             Anxiety disorder
152     442588                             Obstructive sleep apnea syndrome
153     443211        Benign prostatic hyperplasia with outflow obstruction
154     443238                                      Diabetic - poor control
155     443344                                          Barrett's esophagus
156     443447                                       Iatrogenic hypotension
157     443530                                                 Hematochezia
158     443597                               Chronic kidney disease stage 3
159     443612                               Chronic kidney disease stage 4
160     443734                 Ketoacidosis due to type 2 diabetes mellitus
161     444044                                       Acute tubular necrosis
162     444070                                                  Tachycardia
163     444100                                                Mood disorder
164     444101                                   Hypertensive heart failure
165     444406                              Acute subendocardial infarction
166     764123   Atherosclerosis of coronary artery without angina pectoris
167    4008576                       Diabetes mellitus without complication
168    4052648                                                   Disability
169    4064161                                           Cirrhosis of liver
170    4064452                                     ECG: atrial fibrillation
171    4065288                                          EKG: atrial flutter
172    4079687                                         Tumor lysis syndrome
173    4088998                                 AV sequential pacing pattern
174    4089488                                        Atrial pacing pattern
175    4092038                                   Ventricular pacing pattern
176    4094822                            Foreign body in respiratory tract
177    4101362                                      Finding of urine output
178    4126119                                            Toxic nephropathy
179    4138456                                       ECG: sinus bradycardia
180    4140598                                       ECG: sinus tachycardia
181    4141820                                        ECG: sinus arrhythmia
182    4144111          Gastroesophageal reflux disease without esophagitis
183    4145510                            EKG: supraventricular tachycardia
184    4145513                                            ECG: sinus rhythm
185    4150981                                              Drug resistance
186    4154290                               Paroxysmal atrial fibrillation
187    4175154                    Disorder of the peripheral nervous system
188    4182210                                                     Dementia
189    4187218                         Pneumonitis due to inhaled substance
190    4188331                                      Chronic pulmonary edema
191    4193704                Type 2 diabetes mellitus without complication
192    4209423                                          Nicotine dependence
193    4229440                             Chronic congestive heart failure
194    4232495                                       Primary cardiomyopathy
195    4233565 Severe protein-calorie malnutrition (Gomez: less than 60 ...
196    4245975                                              Hepatic failure
197    4256228                                          Respiratory failure
198    4268911                                                Disorientated
199    4270024         Acute non-ST segment elevation myocardial infarction
200    4282096                             Major depression, single episode
201    4286201                                     Schizoaffective disorder
202    4295261                                         Postmenopausal state
203    4311499              Primary malignant neoplasm of respiratory tract
204    4322175                    Late effect of complications of procedure
205    4332246                                                     Aneurysm
206    4339214                             Secondary pulmonary hypertension
207    4353709                               Intracerebral vascular finding
208   36712779                   Chronic total occlusion of coronary artery
209   36712821                                     Postprocedural infection
210   36712982 Unstable angina co-occurrent and due to coronary arterios...
211   37016114               Acute on chronic hypoxemic respiratory failure
212   37016349                Hyperglycemia due to type 2 diabetes mellitus
213   37017432               Polyneuropathy due to type 2 diabetes mellitus
214   37116361                            Accidental wound during procedure
215   37311319                                                  Hypovolemia
216   37394658                                                Severe sepsis
217   37395564                                Hypoxemic respiratory failure
218   40321716                                   Secondary thrombocytopenia
219   40479192                               Chronic systolic heart failure
220   40479576                              Chronic diastolic heart failure
221   40480602                      Acute on chronic systolic heart failure
222   40481043                     Acute on chronic diastolic heart failure
223   40481762         Hemiplegia as late effect of cerebrovascular disease
224   40481919                                     Coronary atherosclerosis
225   40482801                       Type II diabetes mellitus uncontrolled
226   40487064                               Sepsis due to Escherichia coli
227   42537730                                Coronary artery graft present
228   42537748                                    Acquired absence of organ
229   42873170                            Dependence on supplemental oxygen
230   43022062              Cardiovascular system complication of procedure
231   43530681                                      Drug abuse in remission
232   43530690                   Foot ulcer due to type 2 diabetes mellitus
233   43530742 Paralytic syndrome on one side of the body as late effect...
234   43531578       Chronic kidney disease due to type 2 diabetes mellitus
235   44782421              Acute deep venous thrombosis of upper extremity
236   44782429                   Chronic kidney disease due to hypertension
237   44784217                                           Cardiac arrhythmia
238   44784439         Benign hypertensive renal disease with renal failure
239   44784631                               Pain due to neoplastic disease
240   45757363                 Hypoglycemia due to type 2 diabetes mellitus
241   45766207       Non-rheumatic mitral valve stenosis with regurgitation
242   45768812                             Anemia in chronic kidney disease
243   45768910                                         Uncomplicated asthma
244   46271022                                       Chronic kidney disease
245   46271075                          Acute hypoxemic respiratory failure
246   46273390                                     Dependence on respirator</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>observation_list</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`opal-demo`
   concept_id                                                 concept_name
1      432789                            Opioid analgesic adverse reaction
2      433942                 Accident while engaged in household activity
3      435928                                         Abnormal weight loss
4      436583                                                         Fall
5      438046 Medical accident to patient during surgical and medical care
6      439996                               Anticoagulant adverse reaction
7      440279                                                     Accident
8      440922                                          Diabetic on insulin
9      440927                             High risk drug monitoring status
10     441207                                     Adverse reaction to drug
11     441749                              Fall on or from stairs or steps
12    2617452                       Hospital observation service, per hour
13    3001062                                      History of Past illness
14    3007397                                              Ventilator type
15    3012697                                       History of Tobacco use
16    3024265                            Body temperature measurement site
17    3034263                                     Pain severity - Reported
18    3039006                                              Oral care given
19    4005823                                                 Tobacco user
20    4014023                                              Palliative care
21    4019967                                 Dependence on renal dialysis
22    4036936                                              Oxygen delivery
23    4060705                           Body mass index 25-29 - overweight
24    4060985                                Body mass index 30+ - obesity
25    4119499                                        Not for resuscitation
26    4127294                                         Resuscitation status
27    4135421                               Body mass index 20-24 - normal
28    4138763                                 Acceptable pain level status
29    4139934                                                     Homeless
30    4140830                                           Fall on same level
31    4143274                           History of cerebrovascular disease
32    4148407                                   FH: Cardiovascular disease
33    4162219       Patient transfer to postoperative anesthesia care unit
34    4167217                           Family history of clinical finding
35    4179242                        History of malignant neoplasm of skin
36    4180749                    History of malignant neoplasm of prostate
37    4182335                     Family history of ischemic heart disease
38    4192791                                  Pain management (specialty)
39    4203722                                  Patient encounter procedure
40    4214956                       History of clinical finding in subject
41    4215685                                    Past history of procedure
42    4233464                           Legal physical restraint performed
43    4256640                         Body mass index 40+ - severely obese
44    4265599                      Patient transfer to intensive care unit
45    4276526                                             Cigarette smoker
46    4279614                                                 Asphyxiation
47    4296248                                             Cost containment
48    4311079       Place of occurrence of accident or poisoning, hospital
49    4314870                 Place of occurrence of accident or poisoning
50    4323345                                              History of fall
51    4324190                      History of malignant neoplasm of breast
52    4337265                                                 Bowel sounds
53   21492835                                           Respiratory effort
54   36717001                             Long-term current use of aspirin
55   37116693                                      Stroke volume variation
56   40479553                                    Cardiac pacemaker in situ
57   40757693                          Indicators of pain or possible pain
58   40758030                                           Preferred language
59   40766231                                      Marital status [NHANES]
60   46235654                                            Primary insurance
61   46272450                        Long-term current use of drug therapy
62   46272451                             Long-term current use of insulin
63   46272666                            Coordination of family conference
64   46273928                                         Liaising with family
65   46273937                       Long-term current use of anticoagulant
66   46274064                       History of antineoplastic chemotherapy</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>measurement_list</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`opal-demo`
    concept_id                                                 concept_name
1            0                                          No matching concept
2      1175625                                      Breath rate spontaneous
3      3000067           Parathyrin.intact [Mass/volume] in Serum or Plasma
4      3000068                                oxyCODONE [Presence] in Urine
5      3000099            Nuclear Ab [Units/volume] in Serum by Immunoassay
6      3000285                               Sodium [Moles/volume] in Blood
7      3000330                      Specific gravity of Urine by Test strip
8      3000348         Leukocyte esterase [Presence] in Urine by Test strip
9      3000456           Dacrocytes [Presence] in Blood by Light microscopy
10     3000461                          Pressure support setting Ventilator
11     3000483                               Glucose [Mass/volume] in Blood
12     3000593     Cobalamin (Vitamin B12) [Mass/volume] in Serum or Plasma
13     3000764                          Benzodiazepines [Presence] in Urine
14     3000941            Linezolid [Susceptibility] by Disk diffusion (KB)
15     3000963                            Hemoglobin [Mass/volume] in Blood
16     3001122                    Ferritin [Mass/volume] in Serum or Plasma
17     3001308         Cholesterol in LDL [Moles/volume] in Serum or Plasma
18     3001318            Cholesterol.total/Cholesterol in HDL [Percentile]
19     3001494 Erythrocytes [#/volume] in Urine sediment by Microscopy h...
20     3001582                     Protein/Creatinine [Mass Ratio] in Urine
21     3001893                  Eosinophils/100 leukocytes in Pleural fluid
22     3001950             Amikacin [Susceptibility] by Disk diffusion (KB)
23     3002020                             Barbiturates [Presence] in Urine
24     3002091         Choriogonadotropin [Moles/volume] in Serum or Plasma
25     3002113  Variant lymphocytes [Presence] in Blood by Light microscopy
26     3002179                       Metamyelocytes/100 leukocytes in Blood
27     3002331                    Protein [Mass/volume] in Peritoneal fluid
28     3002400                        Iron [Mass/volume] in Serum or Plasma
29     3002827        Microalbumin/Creatinine [Mass Ratio] in 24 hour Urine
30     3002850         Tetracycline [Susceptibility] by Disk diffusion (KB)
31     3002888              Erythrocyte distribution width [Entitic volume]
32     3003105           Gentamicin [Susceptibility] by Disk diffusion (KB)
33     3003132            Barbiturates [Presence] in Serum, Plasma or Blood
34     3003181                               Sodium [Moles/volume] in Urine
35     3003282               Leukocytes [#/volume] in Blood by Manual count
36     3003396                 Base excess in Arterial blood by calculation
37     3003403                       Glucose [Mass/volume] in Pleural fluid
38     3003434                       Protein [Mass/volume] in Pleural fluid
39     3003709                  Acetaminophen [Presence] in Serum or Plasma
40     3003785         Carcinoembryonic Ag [Mass/volume] in Serum or Plasma
41     3003906            Oxacillin [Susceptibility] by Disk diffusion (KB)
42     3004249                                      Systolic blood pressure
43     3004295                         Urea nitrogen [Mass/volume] in Blood
44     3004297                                      Temperature Inhaled gas
45     3004327           Lymphocytes [#/volume] in Blood by Automated count
46     3004354            ceFAZolin [Susceptibility] by Disk diffusion (KB)
47     3004410                     Hemoglobin A1c/Hemoglobin.total in Blood
48     3004501                     Glucose [Mass/volume] in Serum or Plasma
49     3004588              Protein electrophoresis panel - Serum or Plasma
50     3004698                                     QRS duration in lead III
51     3004905        Lipase [Enzymatic activity/volume] in Serum or Plasma
52     3004921                                  Ventilation mode Ventilator
53     3005087     Macrophages/100 leukocytes in Body fluid by Manual count
54     3005131 Glucose mean value [Mass/volume] in Blood Estimated from ...
55     3005158          Clindamycin [Susceptibility] by Disk diffusion (KB)
56     3005309                    Salicylates [Presence] in Serum or Plasma
57     3005456                            Potassium [Moles/volume] in Blood
58     3005481          Spherocytes [Presence] in Blood by Light microscopy
59     3005555                              Left ventricular Cardiac output
60     3005606                     Pulmonary artery Systolic blood pressure
61     3005629                                     Inhaled oxygen flow rate
62     3005686           Bite cells [Presence] in Blood by Light microscopy
63     3005715                  Vancomycin [Mass/volume] in Serum or Plasma
64     3005719                         IgG [Mass/volume] in Serum or Plasma
65     3005854           Burr cells [Presence] in Blood by Light microscopy
66     3005897                 Protein [Mass/volume] in Urine by Test strip
67     3006122            Meropenem [Susceptibility] by Disk diffusion (KB)
68     3006135   Nucleated erythrocytes [#/volume] in Blood by Manual count
69     3006175       Mucus [Presence] in Urine sediment by Light microscopy
70     3006490 Calcium oxalate crystals [Presence] in Urine sediment by ...
71     3006923 Alanine aminotransferase [Enzymatic activity/volume] in S...
72     3007070          Cholesterol in HDL [Mass/volume] in Serum or Plasma
73     3007124   Reticulocytes/100 erythrocytes in Blood by Automated count
74     3007164                         IgA [Mass/volume] in Serum or Plasma
75     3007220 Creatine kinase [Enzymatic activity/volume] in Serum or P...
76     3007350 Amorphous sediment [Presence] in Urine sediment by Light ...
77     3007359          Bilirubin.indirect [Mass/volume] in Serum or Plasma
78     3007469                               Breath rate setting Ventilator
79     3007733                             Chloride [Moles/volume] in Urine
80     3007794                                                 P-R Interval
81     3007876                                          Appearance of Urine
82     3007913         Alveolar-arterial oxygen Partial pressure difference
83     3008223                                     Glasgow coma score motor
84     3008251                          Bicarbonate [Moles/volume] in Urine
85     3008295                                Osmolality of Serum or Plasma
86     3008308         Erythromycin [Susceptibility] by Disk diffusion (KB)
87     3008449                                 S wave amplitude in lead III
88     3008504           Vancomycin [Susceptibility] by Disk diffusion (KB)
89     3008598         Thyroxine (T4) free [Mass/volume] in Serum or Plasma
90     3008691      Amylase [Enzymatic activity/volume] in Peritoneal fluid
91     3008855          Leukocytes other/100 leukocytes in Peritoneal fluid
92     3008939    Band form neutrophils [#/volume] in Blood by Manual count
93     3009094                                    Glasgow coma score verbal
94     3009201                Thyrotropin [Units/volume] in Serum or Plasma
95     3009306         Alpha-1-Fetoprotein [Mass/volume] in Serum or Plasma
96     3009314             Cefepime [Susceptibility] by Disk diffusion (KB)
97     3009497                                              Type of GI tube
98     3009542                        Hematocrit [Volume Fraction] of Blood
99     3009613                  Erythrocytes [#/volume] in Peritoneal fluid
100    3009682                    Cortisol [Mass/volume] in Serum or Plasma
101    3009744                        MCHC [Mass/volume] by Automated count
102    3010189 Epithelial cells [#/area] in Urine sediment by Microscopy...
103    3010321                              Right eye Pupil diameter Manual
104    3010340       Triiodothyronine (T3) [Mass/volume] in Serum or Plasma
105    3010421                                                  pH of Blood
106    3010834                Platelets [#/volume] in Blood by Manual count
107    3011335                     Digoxin [Mass/volume] in Serum or Plasma
108    3011368       Poikilocytosis [Presence] in Blood by Light microscopy
109    3011397                 Hemoglobin [Presence] in Urine by Test strip
110    3011483 Granular casts [#/area] in Urine sediment by Microscopy l...
111    3011544                       Albumin [Mass/volume] in Pleural fluid
112    3011589                                 T wave amplitude in lead III
113    3011904                   Phosphate [Mass/volume] in Serum or Plasma
114    3011965                         Urea nitrogen [Mass/volume] in Urine
115    3011987        Polychromasia [Presence] in Blood by Light microscopy
116    3012030                        MCH [Entitic mass] by Automated count
117    3012095                  Magnesium [Moles/volume] in Serum or Plasma
118    3012222 Trimethoprim+Sulfamethoxazole [Susceptibility] by Disk di...
119    3012336                 Haptoglobin [Mass/volume] in Serum or Plasma
120    3012410                              Tidal volume setting Ventilator
121    3012501                          Base excess in Blood by calculation
122    3012516                               Albumin [Mass/volume] in Urine
123    3012888                                     Diastolic blood pressure
124    3012986 Erythrocytes [#/volume] in Cerebral spinal fluid by Autom...
125    3013290                   Carbon dioxide [Partial pressure] in Blood
126    3013429             Basophils [#/volume] in Blood by Automated count
127    3013466                           aPTT in Blood by Coagulation assay
128    3013502                                   Oxygen saturation in Blood
129    3013603        Prostate specific Ag [Mass/volume] in Serum or Plasma
130    3013650           Neutrophils [#/volume] in Blood by Automated count
131    3013678 Triglyceride [Mass/volume] in Serum or Plasma --12 hours ...
132    3013682               Urea nitrogen [Mass/volume] in Serum or Plasma
133    3013707          Erythrocyte sedimentation rate by Westergren method
134    3013721 Aspartate aminotransferase [Enzymatic activity/volume] in...
135    3013731 Hepatitis B virus surface Ab [Units/volume] in Serum or P...
136    3014080                       Oxygen gas flow Oxygen delivery system
137    3014576                   Chloride [Moles/volume] in Serum or Plasma
138    3014886           Neutrophils [#/volume] in Urine by Automated count
139    3015273                                         Consistency of Stool
140    3015280                   Blasts [#/volume] in Blood by Manual count
141    3015377                    Calcium [Moles/volume] in Serum or Plasma
142    3015536                          ST amplitude.J point+80 ms Lead III
143    3015862         levoFLOXacin [Susceptibility] by Disk diffusion (KB)
144    3016038                            Potassium [Moles/volume] in Urine
145    3016242 Piperacillin+Tazobactam [Susceptibility] by Disk diffusio...
146    3016251              Hemoglobin.gastrointestinal [Presence] in Stool
147    3016293                Bicarbonate [Moles/volume] in Serum or Plasma
148    3016311  Creatine kinase.MB/Creatine kinase.total in Serum or Plasma
149    3016335                               Glasgow coma score eye opening
150    3016407 Fibrinogen [Mass/volume] in Platelet poor plasma by Coagu...
151    3016502                          Oxygen saturation in Arterial blood
152    3016557 Hepatitis B virus core Ab [Units/volume] in Serum by Immu...
153    3016573 Ampicillin+Sulbactam [Susceptibility] by Disk diffusion (KB)
154    3016723                  Creatinine [Mass/volume] in Serum or Plasma
155    3016750                                 Collection duration of Urine
156    3016771       Amylase [Enzymatic activity/volume] in Serum or Plasma
157    3016879                                  Cocaine [Presence] in Urine
158    3016991              Thyroxine (T4) [Mass/volume] in Serum or Plasma
159    3017143                     Hepatitis C virus Ab [Presence] in Serum
160    3017181                           Myelocytes/100 leukocytes in Blood
161    3017188                    Pulmonary artery Diastolic blood pressure
162    3017250                            Creatinine [Mass/volume] in Urine
163    3017400                            Magnesium [Moles/volume] in Urine
164    3017594                     Tidal volume.spontaneous --on ventilator
165    3017595           Ampicillin [Susceptibility] by Disk diffusion (KB)
166    3018053                                  S wave duration in lead III
167    3018405                     Lactate [Moles/volume] in Arterial blood
168    3018465                      Oxygen saturation in Mixed venous blood
169    3018572                             Chloride [Moles/volume] in Blood
170    3018672                                             pH of Body fluid
171    3018760 Blood smear finding [Identifier] in Blood by Light micros...
172    3018834            Bilirubin.total [Presence] in Urine by Test strip
173    3018954      Choriogonadotropin (pregnancy test) [Presence] in Urine
174    3019298               Eosinophils/100 leukocytes in Peritoneal fluid
175    3019351                           QRS terminal amplitude in lead III
176    3019416         Acanthocytes [Presence] in Blood by Light microscopy
177    3019473               Protein [Mass/volume] in Cerebral spinal fluid
178    3019510 Hepatitis B virus surface Ag [Presence] in Serum or Plasm...
179    3019550                     Sodium [Moles/volume] in Serum or Plasma
180    3019634 Microscopic observation [Identifier] in Tissue by Wright ...
181    3019761  Pappenheimer bodies [Presence] in Blood by Light microscopy
182    3019800          Troponin T.cardiac [Mass/volume] in Serum or Plasma
183    3019880         Schistocytes [Presence] in Blood by Light microscopy
184    3019897    Erythrocyte distribution width [Ratio] by Automated count
185    3019977                                         pH of Arterial blood
186    3020149        25-hydroxyvitamin D3 [Mass/volume] in Serum or Plasma
187    3020153        Ciprofloxacin [Susceptibility] by Disk diffusion (KB)
188    3020416          Erythrocytes [#/volume] in Blood by Automated count
189    3020460          C reactive protein [Mass/volume] in Serum or Plasma
190    3020481                                           Respiration rhythm
191    3020630                     Protein [Mass/volume] in Serum or Plasma
192    3020716                                 Inhaled oxygen concentration
193    3020891                                             Body temperature
194    3021044       Iron binding capacity [Mass/volume] in Serum or Plasma
195    3021119                      Calcium.ionized [Moles/volume] in Blood
196    3021200 Thyroglobulin Ab [Units/volume] in Serum by Radioimmunoas...
197    3021303          Hypochromia [Presence] in Blood by Light microscopy
198    3021453                     Eosinophils/100 leukocytes in Body fluid
199    3021502           Macrocytes [Presence] in Blood by Light microscopy
200    3021595                      Phenytoin [Presence] in Serum or Plasma
201    3021601                    Nitrite [Presence] in Urine by Test strip
202    3021886                              Globulin [Mass/volume] in Serum
203    3022022                                                 QRS duration
204    3022094           Tobramycin [Susceptibility] by Disk diffusion (KB)
205    3022217             INR in Platelet poor plasma by Coagulation assay
206    3022318                                            Heart rate rhythm
207    3022509 Hyaline casts [#/area] in Urine sediment by Microscopy lo...
208    3022548               Glucose [Mass/volume] in Cerebral spinal fluid
209    3022621                                    pH of Urine by Test strip
210    3022747          cefTRIAXone [Susceptibility] by Disk diffusion (KB)
211    3022797                                 R wave amplitude in lead III
212    3022875          Positive end expiratory pressure setting Ventilator
213    3023103                  Potassium [Moles/volume] in Serum or Plasma
214    3023307         Penicillin G [Susceptibility] by Disk diffusion (KB)
215    3023314     Hematocrit [Volume Fraction] of Blood by Automated count
216    3023520                            Reticulocytes [#/volume] in Blood
217    3023539                 Ketones [Mass/volume] in Urine by Test strip
218    3023547                Leukocytes other/100 leukocytes in Body fluid
219    3023599                      MCV [Entitic volume] by Automated count
220    3024128             Bilirubin.total [Mass/volume] in Serum or Plasma
221    3024153            Promyelocytes [#/volume] in Blood by Manual count
222    3024171                                             Respiratory rate
223    3024561                     Albumin [Mass/volume] in Serum or Plasma
224    3024629                 Glucose [Mass/volume] in Urine by Test strip
225    3024882        Oxygen/Total gas setting [Volume Fraction] Ventilator
226    3024929             Platelets [#/volume] in Blood by Automated count
227    3025019                           Gas flow Respiratory system airway
228    3025255 Bacteria [#/area] in Urine sediment by Microscopy high po...
229    3025315                                                  Body weight
230    3025439 Airway pressure Ventilator --at peak inspiratory flow max...
231    3025478      Tricyclic antidepressants [Presence] in Serum or Plasma
232    3025616         Target cells [Presence] in Blood by Light microscopy
233    3025809                                                 Q-T interval
234    3026256                            QRS initial amplitude in lead III
235    3026258                                       Q-T interval corrected
236    3026314         Anisocytosis [Presence] in Blood by Light microscopy
237    3026400                        Ethanol [Presence] in Serum or Plasma
238    3026611                               Left eye Pupil diameter Manual
239    3026692                    Albumin [Mass/volume] in Peritoneal fluid
240    3026729                             Phosphate [Mass/volume] in Urine
241    3026782                                          Osmolality of Urine
242    3026904 Basophilic stippling [Presence] in Blood by Light microscopy
243    3026910 Gamma glutamyl transferase [Enzymatic activity/volume] in...
244    3027008                                  Opiates [Presence] in Urine
245    3027018                                                   Heart rate
246    3027114                 Cholesterol [Mass/volume] in Serum or Plasma
247    3027162                                               Color of Urine
248    3027315                           Oxygen [Partial pressure] in Blood
249    3027597            Bilirubin.direct [Mass/volume] in Serum or Plasma
250    3027598                                          Mean blood pressure
251    3027801                  Oxygen [Partial pressure] in Arterial blood
252    3027920           Ovalocytes [Presence] in Blood by Light microscopy
253    3027944                             Amphetamines [Presence] in Urine
254    3027946          Carbon dioxide [Partial pressure] in Arterial blood
255    3028026                         IgM [Mass/volume] in Serum or Plasma
256    3028074                         Pulmonary artery Mean blood pressure
257    3028308                     Erythrocytes [#/volume] in Pleural fluid
258    3028437          Cholesterol in LDL [Mass/volume] in Serum or Plasma
259    3028468            Fragments [Presence] in Blood by Light microscopy
260    3028561                                  R wave duration in lead III
261    3028615           Eosinophils [#/volume] in Blood by Automated count
262    3028662 Hepatitis A virus Ab [Units/volume] in Serum or Plasma by...
263    3029187 Natriuretic peptide.B prohormone N-Terminal [Mass/volume]...
264    3031147 Carbon dioxide, total [Moles/volume] in Blood by calculation
265    3031951                          Benzodiazepines [Presence] in Blood
266    3033364                   Cholesterol [Mass/volume] in Pleural fluid
267    3033483                 Monocytes/100 leukocytes in Peritoneal fluid
268    3033575             Monocytes [#/volume] in Blood by Automated count
269    3034426                                        Prothrombin time (PT)
270    3035206                               Physical mobility Braden scale
271    3035359                          ST amplitude.J point+60 ms Lead III
272    3035583 Leukocytes [#/area] in Urine sediment by Microscopy high ...
273    3035816                        Nutrition intake pattern Braden scale
274    3035851 Transitional cells [#/area] in Urine sediment by Microsco...
275    3035995 Alkaline phosphatase [Enzymatic activity/volume] in Serum...
276    3036098                              Sensory perception Braden scale
277    3036180                                Methadone [Presence] in Urine
278    3036277                                                  Body height
279    3036354         Leukocytes other [#/volume] in Blood by Manual count
280    3036518                               Left ventricular Stroke volume
281    3036987                      Folate [Mass/volume] in Serum or Plasma
282    3037022                               Moisture exposure Braden scale
283    3037153             rifAMPin [Susceptibility] by Disk diffusion (KB)
284    3037185                                  Protein [Presence] in Urine
285    3037244 Yeast [#/area] in Urine sediment by Microscopy high power...
286    3037274    HIV 1 Ab [Units/volume] in Serum or Plasma by Immunoassay
287    3037278                               Anion gap 4 in Serum or Plasma
288    3037318                               Physical activity Braden scale
289    3037347                              Friction and shear Braden scale
290    3037426               Urobilinogen [Presence] in Urine by Test strip
291    3037490                                               Color of Stool
292    3037556                       Urate [Mass/volume] in Serum or Plasma
293    3037577            Monocytes/100 leukocytes in Cerebral spinal fluid
294    3037663 Carbon dioxide, total [Moles/volume] in Arterial blood by...
295    3037871 Macrophages/100 leukocytes in Cerebral spinal fluid by Ma...
296    3037885           Microcytes [Presence] in Blood by Light microscopy
297    3038047       Nitrofurantoin [Susceptibility] by Disk diffusion (KB)
298    3038086          cefTAZidime [Susceptibility] by Disk diffusion (KB)
299    3038104                       Monocytes/100 leukocytes in Body fluid
300    3038288 Influenza virus B RNA [Presence] in Specimen by NAA with ...
301    3039000                                           Anion gap in Blood
302    3040168                    Immature granulocytes [#/volume] in Blood
303    3041079 Nucleated cells [#/volume] in Pleural fluid by Automated ...
304    3041372 Nucleated cells [#/volume] in Cerebral spinal fluid by Au...
305    3041408 Nucleated cells [#/volume] in Peritoneal fluid by Automat...
306    3041635 Macrophages/100 leukocytes in Peritoneal fluid by Manual ...
307    3042347                                           Dressing for Wound
308    3043387                    Monocytes/100 leukocytes in Pleural fluid
309    3043728   WBC casts [Presence] in Urine sediment by Light microscopy
310    3043970                                                Color of Skin
311    3044938 Influenza virus A RNA [Presence] in Specimen by NAA with ...
312    3046838                                                   Edema site
313    3047181                              Lactate [Moles/volume] in Blood
314    3051714     Fibrin D-dimer FEU [Mass/volume] in Platelet poor plasma
315    4024509                                                Urine culture
316    4024510                                Microbial culture, body fluid
317    4035228                                Respiratory microbial culture
318    4036044                                  Anaerobic microbial culture
319    4107893                                                Blood culture
320    4165398                                             Mycology culture
321    4189544                                            Microbial culture
322    4247906                                  Clostridium difficile assay
323    4265595                                  Creatine kinase measurement
324    4300293                                               Tissue culture
325   21490516                        Inspiration [Time] Respiratory system
326   21490580       Carbon dioxide production (VCO2) in Respiratory system
327   21490650  Pressure max Respiratory system airway --during inspiration
328   21490675                                Central venous pressure (CVP)
329   21490712                               Left ventricular Cardiac index
330   21490753                 Volume expired per minute Respiratory system
331   21490854                      Tidal volume Ventilator --on ventilator
332   21490880                         Left ventricular Stroke volume index
333   21490888                               PCA lockout time Infusion pump
334   21490963                               Right pupil Pupillary response
335   21491186                                   Endotracheal tube Diameter
336   21491763                                Left pupil Pupillary response
337   21492239                       Systolic blood pressure by Noninvasive
338   21492240                      Diastolic blood pressure by Noninvasive
339   21492241                           Mean blood pressure by Noninvasive
340   21492838                                               Skin integrity
341   21494965                                               Passing flatus
342   21494966                    Physical findings of Abdomen by Palpation
343   36203862                                              Color of Sputum
344   36303946   Pressure.plateau Respiratory system airway --on ventilator
345   36684829                            Richmond Agitation-Sedation Scale
346   40760766       Tidal volume.inspired maximum setting Ventilator alarm
347   40762499        Oxygen saturation in Arterial blood by Pulse oximetry
348   40762903                              Apnea interval Ventilator alarm
349   40763080 Lactate dehydrogenase [Enzymatic activity/volume] in Peri...
350   42527086                                         Mean airway pressure
351   42527140                                Total PEEP Respiratory system
352   43055270                                           Wound closure type
353   46236952 Glomerular filtration rate/1.73 sq M.predicted [Volume Ra...</code></pre>
</div>
</div>
<p><strong>Can you identify the concept IDs for COPD, tobacco use and asthma?</strong></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ol type="1">
<li><strong>Chronic obstructive pulmonary disease</strong>: 255573
<ul>
<li>Found in Condition occurrence</li>
<li>Concept name: Chronic obstructive lung disease</li>
</ul></li>
<li><strong>Tobacco use</strong>: 4005823
<ul>
<li>Found in Observation</li>
<li>Concept name: Tobacco user</li>
</ul></li>
<li><strong>Asthma</strong>: 317009
<ul>
<li>Found in Condition occurrence</li>
<li>Concept name: Asthma</li>
</ul></li>
</ol>
</div>
</div>
</div>
<p>Let’s now retrieve these variables from the database. In this case, our strategy will be to retrieve any form of data related to the variables we are studying. OMOP CDM tables are designed to only register the presence of a concept in a patient, so we will have to retrieve those and create auxiliar boolean variables that indicate the presence of the concept in the patient. This means that we can just retrieve the basic identifiers for each concept:</p>
<ul>
<li>From the <code>condition_occurrence</code> table,</li>
<li>get COPD (whose concept ID is <code>255573</code>) and asthma (whose concept ID is <code>317009</code>),</li>
<li>taking only the <code>condition_occurrence_id</code> column</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>helper<span class="sc">$</span><span class="fu">auto</span>(</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">table =</span> <span class="st">"condition_occurrence"</span>,</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">concepts =</span> <span class="fu">c</span>(<span class="dv">255573</span>, <span class="dv">317009</span>),</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="st">"condition_occurrence_id"</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<ul>
<li>From the <code>observation</code> table,</li>
<li>get tobacco use (whose concept ID is <code>4005823</code>),</li>
<li>taking only the <code>observation_id</code> column</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>helper<span class="sc">$</span><span class="fu">auto</span>(</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">table =</span> <span class="st">"observation"</span>,</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">concepts =</span> <span class="dv">4005823</span>,</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns =</span> <span class="st">"observation_id"</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<p>We can now check the current state of the <code>mimiciv</code> table:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.summary</span>(<span class="st">"mimiciv"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`opal-demo`
$`opal-demo`$class
[1] "data.frame"

$`opal-demo`$`number of rows`
[1] 100

$`opal-demo`$`number of columns`
[1] 8

$`opal-demo`$`variables held`
[1] "person_id"                                               
[2] "gender_concept_id"                                       
[3] "year_of_birth"                                           
[4] "race_concept_id"                                         
[5] "ethnicity_concept_id"                                    
[6] "chronic_obstructive_lung_disease.condition_occurrence_id"
[7] "asthma.condition_occurrence_id"                          
[8] "tobacco_user.observation_id"                             </code></pre>
</div>
</div>
<p>As we can see, the <code>mimiciv</code> table now contains:</p>
<ul>
<li><code>chronic_obstructive_lung_disease.condition_occurrence_id</code></li>
<li><code>tobacco_user.observation_id</code></li>
<li><code>asthma.condition_occurrence_id</code></li>
</ul>
<p>We can now create boolean variables that indicate the presence of each concept in the patient. DataSHIELD will not transform an ID to a boolean if it is in a string format, so this process involves two steps:</p>
<ol type="1">
<li>Transforming the ID to numeric</li>
<li>Transforming the numeric ID to boolean</li>
</ol>
<p>Let’s start by transforming the COPD variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert COPD ID to numeric</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.asNumeric</span>(</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">x.name =</span> <span class="st">"mimiciv$chronic_obstructive_lung_disease.condition_occurrence_id"</span>,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">newobj =</span> <span class="st">"copd_numeric"</span>,</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">datasources =</span> conns</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$is.object.created
[1] "A data object &lt;copd_numeric&gt; has been created in all specified data sources"

$validity.check
[1] "&lt;copd_numeric&gt; appears valid in all sources"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert numeric COPD to boolean</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.Boole</span>(</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">V1 =</span> <span class="st">"copd_numeric"</span>,</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">V2 =</span> <span class="dv">0</span>,</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Boolean.operator =</span> <span class="st">"!="</span>,</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">numeric.output =</span> <span class="cn">TRUE</span>,</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.assign =</span> <span class="dv">0</span>,</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">newobj =</span> <span class="st">"copd"</span>,</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">datasources =</span> conns</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$is.object.created
[1] "A data object &lt;copd&gt; has been created in all specified data sources"

$validity.check
[1] "&lt;copd&gt; appears valid in all sources"</code></pre>
</div>
</div>
<p>This has created a <code>copd</code> object in the server that contains the boolean variables indicating the presence of COPD in the patient.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.table</span>(<span class="st">"copd"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Data in all studies were valid 

Study 1 :  No errors reported from this study</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$output.list
$output.list$TABLE_rvar.by.study_row.props
    study
copd opal-demo
  0          1
  1          1
  NA       NaN

$output.list$TABLE_rvar.by.study_col.props
    study
copd opal-demo
  0       0.87
  1       0.13
  NA      0.00

$output.list$TABLE_rvar.by.study_counts
    study
copd opal-demo
  0         87
  1         13
  NA         0

$output.list$TABLES.COMBINED_all.sources_proportions
copd
   0    1   NA 
0.87 0.13 0.00 

$output.list$TABLES.COMBINED_all.sources_counts
copd
 0  1 NA 
87 13  0 


$validity.message
[1] "Data in all studies were valid"</code></pre>
</div>
</div>
<p>Let’s now repeat the same process for the tobacco use variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert tobacco ID to numeric</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.asNumeric</span>(</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">x.name =</span> <span class="st">"mimiciv$tobacco_user.observation_id"</span>,</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">newobj =</span> <span class="st">"tobacco_numeric"</span>,</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">datasources =</span> conns</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$is.object.created
[1] "A data object &lt;tobacco_numeric&gt; has been created in all specified data sources"

$validity.check
[1] "&lt;tobacco_numeric&gt; appears valid in all sources"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert numeric tobacco to boolean </span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.Boole</span>(</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">V1 =</span> <span class="st">"tobacco_numeric"</span>,</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">V2 =</span> <span class="dv">0</span>,</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Boolean.operator =</span> <span class="st">"!="</span>,</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">numeric.output =</span> <span class="cn">TRUE</span>,</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.assign =</span> <span class="dv">0</span>,</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">newobj =</span> <span class="st">"tobacco"</span>,</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">datasources =</span> conns</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$is.object.created
[1] "A data object &lt;tobacco&gt; has been created in all specified data sources"

$validity.check
[1] "&lt;tobacco&gt; appears valid in all sources"</code></pre>
</div>
</div>
<p>and for the asthma variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert asthma ID to numeric </span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.asNumeric</span>(</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">x.name =</span> <span class="st">"mimiciv$asthma.condition_occurrence_id"</span>,</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">newobj =</span> <span class="st">"asthma_numeric"</span>, </span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">datasources =</span> conns</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$is.object.created
[1] "A data object &lt;asthma_numeric&gt; has been created in all specified data sources"

$validity.check
[1] "&lt;asthma_numeric&gt; appears valid in all sources"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert numeric asthma to boolean</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.Boole</span>(</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">V1 =</span> <span class="st">"asthma_numeric"</span>,</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">V2 =</span> <span class="dv">0</span>,</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Boolean.operator =</span> <span class="st">"!="</span>, </span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">numeric.output =</span> <span class="cn">TRUE</span>,</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.assign =</span> <span class="dv">0</span>,</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">newobj =</span> <span class="st">"asthma"</span>,</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">datasources =</span> conns</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$is.object.created
[1] "A data object &lt;asthma&gt; has been created in all specified data sources"

$validity.check
[1] "&lt;asthma&gt; appears valid in all sources"</code></pre>
</div>
</div>
<p>We can now check the presence of the <code>tobacco</code> and <code>asthma</code> objects in the server side:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.table</span>(<span class="st">"tobacco"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Data in all studies were valid 

Study 1 :  No errors reported from this study</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$output.list
$output.list$TABLE_rvar.by.study_row.props
       study
tobacco opal-demo
     0          1
     1          1
     NA       NaN

$output.list$TABLE_rvar.by.study_col.props
       study
tobacco opal-demo
     0       0.96
     1       0.04
     NA      0.00

$output.list$TABLE_rvar.by.study_counts
       study
tobacco opal-demo
     0         96
     1          4
     NA         0

$output.list$TABLES.COMBINED_all.sources_proportions
tobacco
   0    1   NA 
0.96 0.04 0.00 

$output.list$TABLES.COMBINED_all.sources_counts
tobacco
 0  1 NA 
96  4  0 


$validity.message
[1] "Data in all studies were valid"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.table</span>(<span class="st">"asthma"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Data in all studies were valid 

Study 1 :  No errors reported from this study</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$output.list
$output.list$TABLE_rvar.by.study_row.props
      study
asthma opal-demo
    0          1
    1          1
    NA       NaN

$output.list$TABLE_rvar.by.study_col.props
      study
asthma opal-demo
    0       0.91
    1       0.09
    NA      0.00

$output.list$TABLE_rvar.by.study_counts
      study
asthma opal-demo
    0         91
    1          9
    NA         0

$output.list$TABLES.COMBINED_all.sources_proportions
asthma
   0    1   NA 
0.91 0.09 0.00 

$output.list$TABLES.COMBINED_all.sources_counts
asthma
 0  1 NA 
91  9  0 


$validity.message
[1] "Data in all studies were valid"</code></pre>
</div>
</div>
<p>We can now perform the GLM analysis using the <code>ds.glm</code> function from DataSHIELD:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ds.glm</span>(</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> <span class="st">"copd ~ tobacco + asthma"</span>,</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">datasources =</span> conns</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$Nvalid
[1] 100

$Nmissing
[1] 0

$Ntotal
[1] 100

$disclosure.risk
          RISK OF DISCLOSURE
opal-demo                  0

$errorMessage
          ERROR MESSAGES
opal-demo "No errors"   

$nsubs
[1] 100

$iter
[1] 18

$family

Family: binomial 
Link function: logit 


$formula
[1] "copd ~ tobacco + asthma"

$coefficients
              Estimate   Std. Error      z-value      p-value low0.95CI.LP
(Intercept)  -1.845827    0.3106304 -5.942196444 2.812281e-09    -2.454651
tobacco       1.152680    1.2635233  0.912274032 3.616245e-01    -1.323781
asthma      -17.548914 2953.9650106 -0.005940799 9.952600e-01 -5807.213946
            high0.95CI.LP         P_OR low0.95CI.P_OR high0.95CI.P_OR
(Intercept)     -1.237002 1.363636e-01     0.07909909       0.2249582
tobacco          3.629140 3.166667e+00     0.26612726      37.6803863
asthma        5772.116119 2.391132e-08     0.00000000             Inf

$dev
[1] 73.92114

$df
[1] 97

$output.information
[1] "SEE TOP OF OUTPUT FOR INFORMATION ON MISSING DATA AND ERROR MESSAGES"</code></pre>
</div>
</div>
<p><strong>Note:</strong> Our dataset is very small, so the GLM analysis is not very reliable. This is just an example of how to perform a GLM analysis in DataSHIELD with data imported from an OMOP database.</p>
</section>
<section id="logout" class="level1">
<h1>Logout</h1>
<p>Do not forget to logout from the DataSHIELD server after finishing the exercise:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">datashield.logout</span>(conns)</span></code></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>